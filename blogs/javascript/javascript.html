<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ccy&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/ccyblog/favicon.ico">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/UsernameFull/l2d@0.2/js/frame/live2dcubismcore.min.js"></script>
    <script src="https://pixijs.download/v4.8.4/pixi.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/litstronger/live2d-moc3@master/js/live2dcubismframework.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/litstronger/live2d-moc3@master/js/live2dcubismpixi.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/litstronger/live2d-moc3@master/js/l2d.js"></script>
    <meta name="description" content="个人技术博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/ccyblog/assets/css/0.styles.79d32354.css" as="style"><link rel="preload" href="/ccyblog/assets/js/app.61cc9ff9.js" as="script"><link rel="preload" href="/ccyblog/assets/js/3.897744a6.js" as="script"><link rel="preload" href="/ccyblog/assets/js/1.371d3697.js" as="script"><link rel="preload" href="/ccyblog/assets/js/13.8010945d.js" as="script"><link rel="preload" href="/ccyblog/assets/js/8.b19724a0.js" as="script"><link rel="prefetch" href="/ccyblog/assets/js/10.a51d9fc9.js"><link rel="prefetch" href="/ccyblog/assets/js/11.8d124275.js"><link rel="prefetch" href="/ccyblog/assets/js/12.a334a46b.js"><link rel="prefetch" href="/ccyblog/assets/js/14.8e3c3ac4.js"><link rel="prefetch" href="/ccyblog/assets/js/15.81bd0ba2.js"><link rel="prefetch" href="/ccyblog/assets/js/16.232611db.js"><link rel="prefetch" href="/ccyblog/assets/js/17.667dde35.js"><link rel="prefetch" href="/ccyblog/assets/js/18.71e79375.js"><link rel="prefetch" href="/ccyblog/assets/js/19.f10b5e62.js"><link rel="prefetch" href="/ccyblog/assets/js/20.dd05ecdc.js"><link rel="prefetch" href="/ccyblog/assets/js/21.4a07e2cf.js"><link rel="prefetch" href="/ccyblog/assets/js/22.29c735e7.js"><link rel="prefetch" href="/ccyblog/assets/js/23.04beb3f2.js"><link rel="prefetch" href="/ccyblog/assets/js/24.e4efbb4f.js"><link rel="prefetch" href="/ccyblog/assets/js/25.63de8752.js"><link rel="prefetch" href="/ccyblog/assets/js/26.1a8c82ca.js"><link rel="prefetch" href="/ccyblog/assets/js/27.47678a4d.js"><link rel="prefetch" href="/ccyblog/assets/js/28.4d87f639.js"><link rel="prefetch" href="/ccyblog/assets/js/29.d613dcd8.js"><link rel="prefetch" href="/ccyblog/assets/js/30.610dbdf4.js"><link rel="prefetch" href="/ccyblog/assets/js/31.c4817f6d.js"><link rel="prefetch" href="/ccyblog/assets/js/32.7af520a4.js"><link rel="prefetch" href="/ccyblog/assets/js/33.5ce06274.js"><link rel="prefetch" href="/ccyblog/assets/js/34.b2117dfb.js"><link rel="prefetch" href="/ccyblog/assets/js/35.377603e6.js"><link rel="prefetch" href="/ccyblog/assets/js/36.883e88a6.js"><link rel="prefetch" href="/ccyblog/assets/js/37.872a7cdf.js"><link rel="prefetch" href="/ccyblog/assets/js/38.18f351f9.js"><link rel="prefetch" href="/ccyblog/assets/js/39.0487dd57.js"><link rel="prefetch" href="/ccyblog/assets/js/4.9b4181ee.js"><link rel="prefetch" href="/ccyblog/assets/js/40.abacd655.js"><link rel="prefetch" href="/ccyblog/assets/js/41.abf116df.js"><link rel="prefetch" href="/ccyblog/assets/js/42.7f9de919.js"><link rel="prefetch" href="/ccyblog/assets/js/43.d41da37b.js"><link rel="prefetch" href="/ccyblog/assets/js/44.7c2519a6.js"><link rel="prefetch" href="/ccyblog/assets/js/45.29a6bc83.js"><link rel="prefetch" href="/ccyblog/assets/js/46.5f6478d4.js"><link rel="prefetch" href="/ccyblog/assets/js/47.631bdc1f.js"><link rel="prefetch" href="/ccyblog/assets/js/48.6df6dfd4.js"><link rel="prefetch" href="/ccyblog/assets/js/49.8fdfb49c.js"><link rel="prefetch" href="/ccyblog/assets/js/5.bd4235cd.js"><link rel="prefetch" href="/ccyblog/assets/js/50.88f2f8bf.js"><link rel="prefetch" href="/ccyblog/assets/js/51.f502157e.js"><link rel="prefetch" href="/ccyblog/assets/js/52.9bf27ff9.js"><link rel="prefetch" href="/ccyblog/assets/js/53.56ba7eeb.js"><link rel="prefetch" href="/ccyblog/assets/js/54.212c55f1.js"><link rel="prefetch" href="/ccyblog/assets/js/55.6fc8672f.js"><link rel="prefetch" href="/ccyblog/assets/js/56.8cbf943d.js"><link rel="prefetch" href="/ccyblog/assets/js/57.8b84c069.js"><link rel="prefetch" href="/ccyblog/assets/js/58.df9fd31e.js"><link rel="prefetch" href="/ccyblog/assets/js/59.4a889f7f.js"><link rel="prefetch" href="/ccyblog/assets/js/6.1ebcf0d6.js"><link rel="prefetch" href="/ccyblog/assets/js/60.045b3756.js"><link rel="prefetch" href="/ccyblog/assets/js/61.4e8f609c.js"><link rel="prefetch" href="/ccyblog/assets/js/62.4fe15d75.js"><link rel="prefetch" href="/ccyblog/assets/js/63.e9ac2545.js"><link rel="prefetch" href="/ccyblog/assets/js/64.083e8d2c.js"><link rel="prefetch" href="/ccyblog/assets/js/65.b6e595bc.js"><link rel="prefetch" href="/ccyblog/assets/js/66.26689277.js"><link rel="prefetch" href="/ccyblog/assets/js/67.60ccd17c.js"><link rel="prefetch" href="/ccyblog/assets/js/68.42b6df4a.js"><link rel="prefetch" href="/ccyblog/assets/js/69.1d5ac1c5.js"><link rel="prefetch" href="/ccyblog/assets/js/7.58212ba9.js"><link rel="prefetch" href="/ccyblog/assets/js/70.6b794575.js"><link rel="prefetch" href="/ccyblog/assets/js/71.09fac264.js"><link rel="prefetch" href="/ccyblog/assets/js/72.ee6a2190.js"><link rel="prefetch" href="/ccyblog/assets/js/73.da9be3f4.js"><link rel="prefetch" href="/ccyblog/assets/js/74.d901de2d.js"><link rel="prefetch" href="/ccyblog/assets/js/75.a8f3a837.js"><link rel="prefetch" href="/ccyblog/assets/js/76.26405b7a.js"><link rel="prefetch" href="/ccyblog/assets/js/77.abe05554.js"><link rel="prefetch" href="/ccyblog/assets/js/78.6fd39cf3.js"><link rel="prefetch" href="/ccyblog/assets/js/79.5a5a23fb.js"><link rel="prefetch" href="/ccyblog/assets/js/80.5de6685c.js"><link rel="prefetch" href="/ccyblog/assets/js/81.452915be.js"><link rel="prefetch" href="/ccyblog/assets/js/82.04c6cc59.js"><link rel="prefetch" href="/ccyblog/assets/js/83.8288a3e4.js"><link rel="prefetch" href="/ccyblog/assets/js/84.e49e3728.js"><link rel="prefetch" href="/ccyblog/assets/js/85.8ad8ef5d.js"><link rel="prefetch" href="/ccyblog/assets/js/86.1d4c8e78.js"><link rel="prefetch" href="/ccyblog/assets/js/87.fc6b54da.js"><link rel="prefetch" href="/ccyblog/assets/js/88.1e7cf8b0.js"><link rel="prefetch" href="/ccyblog/assets/js/9.a8e5976d.js">
    <link rel="stylesheet" href="/ccyblog/assets/css/0.styles.79d32354.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>ccy's blogs</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>个人技术博客</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>月夕花辰</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ccyblog/" class="home-link router-link-active"><img src="/ccyblog/avatar.png" alt="ccy's blogs" class="logo"> <span class="site-name">ccy's blogs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ccyblog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ccyblog/categories/配置/" class="nav-link"><i class="undefined"></i>
  配置
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/手写题/" class="nav-link"><i class="undefined"></i>
  手写题
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/直播/" class="nav-link"><i class="undefined"></i>
  直播
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/网络/" class="nav-link"><i class="undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/CSS/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/优化/" class="nav-link"><i class="undefined"></i>
  优化
</a></li></ul></div></div><div class="nav-item"><a href="/ccyblog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/ccyblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/FrancisSaber" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="./public/avatar.png"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/ccyblog/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    月夕花辰
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>72</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>19</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/ccyblog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ccyblog/categories/配置/" class="nav-link"><i class="undefined"></i>
  配置
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/手写题/" class="nav-link"><i class="undefined"></i>
  手写题
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/直播/" class="nav-link"><i class="undefined"></i>
  直播
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/网络/" class="nav-link"><i class="undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/CSS/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/优化/" class="nav-link"><i class="undefined"></i>
  优化
</a></li></ul></div></div><div class="nav-item"><a href="/ccyblog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/ccyblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/FrancisSaber" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="./public/avatar.png"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java Script</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ccyblog/blogs/javascript/javascript.html" aria-current="page" class="active sidebar-link">/blogs/javascript/javascript.html</a></li><li><a href="/ccyblog/blogs/javascript/javascriptde-ji-cheng.html" class="sidebar-link">组合式继承</a></li><li><a href="/ccyblog/blogs/javascript/shi-jian-xun-huan.html" class="sidebar-link">/blogs/javascript/shi-jian-xun-huan.html</a></li><li><a href="/ccyblog/blogs/javascript/die-dai-qi.html" class="sidebar-link">迭代器（interator）</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc></h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>月夕花辰</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2022
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title"></h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>月夕花辰</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><hr> <p>title: JavaScript
date: 2022-1-10
tags:</p> <ul><li>js基础</li></ul> <hr> <h1 id="javascript知识点"><a href="#javascript知识点" class="header-anchor">#</a> JavaScript知识点</h1> <h2 id="学前"><a href="#学前" class="header-anchor">#</a> 学前</h2> <h3 id="typescript与javascript"><a href="#typescript与javascript" class="header-anchor">#</a> typescript与JavaScript</h3> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141534308.png" alt="image-20220114153435014" style="zoom:47%;"> <h3 id="javascript是一门编程语言"><a href="#javascript是一门编程语言" class="header-anchor">#</a> JavaScript是一门编程语言</h3> <p>JavaScript是一门高级的编程语言</p> <ul><li>机器语言：二进制数组成的机器可识别指令</li> <li>汇编语言：mov ax bx 、push、</li> <li>高级语言：Java、JavaScript、python</li></ul> <p>计算机本身不认识高级语言，最终还是需要转成机器语言</p> <p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141543976.png" alt="image-20220114154347902"></p> <h4 id="高级语言又分为编译型语言和解释型语言。"><a href="#高级语言又分为编译型语言和解释型语言。" class="header-anchor">#</a> <font color="orange">高级语言又分为编译型语言和解释型语言。</font></h4> <p><font color="orange">编译型语言</font>：C、C++、Java（Java有争论，先转成字节码，再转成机器码）JIT</p> <p>把代码直接编译成可执行文件</p> <p><font color="orange">解释型语言</font>：JavaScript、python</p> <p>边读边解释，再转成代码</p> <hr> <h2 id="浏览器工作原理与v8引擎"><a href="#浏览器工作原理与v8引擎" class="header-anchor">#</a> 浏览器工作原理与V8引擎</h2> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141548353.png" alt="image-20220114154800274" style="zoom:80%;"> <h3 id="浏览器内核"><a href="#浏览器内核" class="header-anchor">#</a> 浏览器内核</h3> <p>不同浏览器使用不同内核</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141552239.png" alt="image-20220114155215172" style="zoom:77%;"> <p><font color="orange">浏览器内核实际指的是排版引擎，也称为浏览器引擎、页面渲染引擎或样板引擎</font></p> <h3 id="浏览器渲染过程"><a href="#浏览器渲染过程" class="header-anchor">#</a> 浏览器渲染过程</h3> <p><font color="orange">HTML解析的时候遇到JavaScript标签需要停止解析执行JavaScript代码</font></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141559035.png" alt="image-20220114155957949" style="zoom:77%;"> <p><font color="orange">针对不同电脑的屏幕大小等需要排版引擎处理实现排版布局</font></p> <h3 id="javascript引擎"><a href="#javascript引擎" class="header-anchor">#</a> JavaScript引擎</h3> <p>​		<font color="orange">程序员编写的JavaScript代码无论是在node环境下执行或浏览器执行最终都是要让CPU执行，这个过程需要JavaScript引擎来翻译成CPU指令</font></p> <p><font color="pink">常见的JavaScript引擎：JavaScriptCore、V8</font></p> <p>V8是谷歌浏览器和node的内置引擎</p> <h3 id="浏览器内核和javascript引擎的区别"><a href="#浏览器内核和javascript引擎的区别" class="header-anchor">#</a> <font color="orange">浏览器内核和JavaScript引擎的区别</font></h3> <h4 id="浏览器内核-2"><a href="#浏览器内核-2" class="header-anchor">#</a> 浏览器内核</h4> <p>​		用来解析HTML,布局,排版,渲染等相关工作</p> <h4 id="javascript引擎-2"><a href="#javascript引擎-2" class="header-anchor">#</a> JavaScript引擎</h4> <p>​		用来解析、执行JavaScript代码，转成CPU可执行代码</p> <p>小程序：<img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141611178.png" alt="image-20220114161128088" style="zoom:67%;"></p> <h3 id="v8引擎"><a href="#v8引擎" class="header-anchor">#</a> <font color="orange">	V8引擎</font></h3> <ul><li>C++编写的Google开源高性能JavaScript引擎和WebAssembly，用于Google和<code>node.js</code>等</li> <li>可单独运行或嵌入到C++程序</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141624599.png" alt="image-20220114162400488"></p> <p><font color="orange">不同CPU可识别执行的CPU指令不同，因此将抽象语法树转化需要不同的编译器转化成不同平台的CPU指令;其中<code>ignition</code>可将抽象语法树转成字节码</font></p> <p><font color="orange"><strong>字节码：</strong></font>字节码可跨平台，执行时需转成汇编指令，再转成机器指令</p> <p><font color="orange">V8引擎的优化的机器码是指：（通过Ignition收集信息，对执行频率高的，标记成<code>hot</code>）将其字节码直接转成对应机器码来执行（不通过汇编转成机器码）</font><font color="red">如果这个标记的函数突然改变，会Deoptimization发现并将机器码反转成字节码，以字节码方式转化运行于CPU，反而增加性能耗费</font><font color="orange">（<code>Typescript</code>执行速度会快于JavaScript）</font></p> <ul><li><p>Parse模块会将JavaScript代码转成AST(抽象语法树)，这是因为解释器不能直接识别JavaScript代码</p></li> <li><p>Ignition是一个解释器，会将AST转成<code>BtyeCode</code>（字节码）
<font color="orange">同时会收集TurboFan优化所需要的信息（比如函数参数的类型信息，有了类型才能进行真实的运算）</font>;如果函数只调用一次，Ignition会执行解释执行ByteCode ;</p></li> <li><p>TurboFan是一个编译器，可以将字节码编译成CPU可执行机器码
<font color="orange">如果一个函数被多次调用，那么便会被标记成热点函数，经过TurboFan转成优化的机器码，提高代码执行性能。</font></p> <p><font color="orange">但是，机器码实际上也会被还原为ByteCode，这是因为如果后续执行函数的过程中，类型发生了变化(比如sum函数原来执行的是number类型，后来执行变成了string类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码;</font></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141744686.png" alt="image-20220114174453565" style="zoom:57%;"> <p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141746567.png" alt="image-20220114174621415">
Blink是渲染引擎，字符编码转化成UTF-16</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203121716850.png" alt="image-20220312171654743" style="zoom:77%;"> <p>所预解析，实际就是上图所说的先声名，运行再赋值。</p></li></ul> <p>抽象语法树：<img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141620184.png" alt="image-20220114162047116" style="zoom:80%;"></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141623927.png" alt="image-20220114162311869" style="zoom:67%;"> <hr> <h2 id="函数指执行-作用域链-内存管理"><a href="#函数指执行-作用域链-内存管理" class="header-anchor">#</a> 函数指执行-作用域链-内存管理</h2> <h3 id="v8解析javascript代码过程"><a href="#v8解析javascript代码过程" class="header-anchor">#</a> v8解析JavaScript代码过程</h3> <p>编译 <code>js-&gt;ast</code></p> <ol><li><font color="orange">浏览器内核将代码交给引擎，引擎创建一个<code>GlobalObject</code>（go）对象（里面的window对象指向全局对象本身，变量等）</font></li> <li>运行代码
<ol><li>为了指向代码，v8引擎内部会有一个执行上下文栈（<code>Execution Context Stack</code>, <code>ECStack</code>）（<font color="orange">函数调用栈</font>），函数想要执行，必须放到函数调用栈内</li> <li>如果要执行全局代码，需要创建全局执行上文（GEC），里面包含VO（variable Object，指向GO）
<font color="orange">遇到变量赋值为undefined，遇到函数声名会在<strong>内存</strong>开辟一段空间用于存储函数（存储着函数的作用域和函数体），存储完后在GO的函数名赋值为函数保存的内存地址，是对内存地址的引用</font></li></ol></li> <li>执行代码，当遇到需要执行函数时，会从GO查询，发现是个内存地址，于是从内存取出放入执行栈内执行（不是直接放入执行，而是<font color="pink">先创建函数执行上下文</font>，<font color="orange">函数执行上下文内有自己的类似VO的对象，叫AO，用于存储函数内部定义的变量等</font>）</li></ol> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201151009964.png" alt="image-20220115100942777" style="zoom:67%;"> <h3 id="函数执行上下文"><a href="#函数执行上下文" class="header-anchor">#</a> 函数执行上下文</h3> <p>​		<font color="orange">函数执行上下文不仅包含自身的变量和函数，还包含父作用域链即指向其父函数的AO，最顶层的是GO。</font>当函数内部使用一个变量时，会先从函数的执行上下文查找，没有就沿着父作用域链找，直到GO。如果最终没找到所引用的变量则会报<code>referenrceError</code> 。</p> <p>​		AO在函数执行上下文创建好后创建。</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201151019198.png" alt="image-20220115101956123" style="zoom:67%;"> <h4 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">'Hello world'</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>				<span class="token comment">//此函数的AO为空对象，父作用域指向GO，编译时确定，与调用位置无关	</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token string">'Hello Bar'</span> 
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//Hello world</span>
<span class="token comment">//代码在编译时foo的父亲作用域是全局，虽然foo在bar内调用，但foo本身的父作用域是全局对象，所有引用的是全局的message</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><font color="orange">一个函数的父作用域是在编译时就已经确定并记录在内存中</font><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201151036089.png" alt="image-20220115103613037" style="zoom:80%;"></p> <h3 id="函数执行上下文fec"><a href="#函数执行上下文fec" class="header-anchor">#</a> 函数执行上下文FEC</h3> <p>代码在执行过程中遇到一个函数时，会根据函数体创建一个函数执行上下文并压入ES Stack中</p> <h4 id="包含以下三部分内容"><a href="#包含以下三部分内容" class="header-anchor">#</a> 包含以下三部分内容</h4> <ul><li>在解析函数成为AST树结构时，会创建一个AO(包含形参、arguments、函数定义和指向函数对象即谁引用了这个对象)</li> <li>作用域链∶由VO（在函数中就是AO对象）和父级VO组成，查找时会一层层查找</li> <li><code>this</code>绑定的值</li></ul> <h3 id="变量环境和记录"><a href="#变量环境和记录" class="header-anchor">#</a> 变量环境和记录</h3> <h4 id="早期"><a href="#早期" class="header-anchor">#</a> 早期</h4> <p><font color="orange">每一个执行上下文会被关联到-(variable object，VO)，在源代码中的变量和函数声明会被作为属性添加到VO(变量环境)中。
对于函数来说，参数也会被添加到VO中。</font></p> <h4 id="最新"><a href="#最新" class="header-anchor">#</a> 最新</h4> <p><font color="orange">每一个执行上下文会关联到一个变量环境(VariableEnvironment)中，在执行代码中变量和函数的声明会作为环境记录(Environment Record）添加到变量环境中。对于函数来说，参数也会被作为环境记录添加到变量环境中。</font>不要求一定要用对象来决定，也可以键值对等方式记录。具体是根据<code>js</code>引擎来决定。（即从原先变量和声名要记录到一个对象中变成到一个变量环境中，可以是对象乃至键值对等更多记录形式）</p> <h3 id="作用域提升题"><a href="#作用域提升题" class="header-anchor">#</a> 作用域提升题</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">200</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	n <span class="token operator">=</span> <span class="token number">100</span>			<span class="token comment">//指向的n为全局的，因为其自身执行上下文没有n变量</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>	<span class="token comment">//100</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>		<span class="token comment">//其自身AO包含n，但还未定义</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">200</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">100</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">// undefined 200</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">100</span>

<span class="token keyword">function</span> <span class="token function">foo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>	<span class="token operator">/</span><span class="token number">100</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">200</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>	<span class="token comment">//200</span>
    <span class="token function">foo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>		<span class="token comment">//100</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>		<span class="token comment">//undefined </span>
    <span class="token keyword">return</span> 
    <span class="token keyword">var</span> a <span class="token operator">=</span><span class="token number">100</span>
<span class="token punctuation">}</span>
<span class="token comment">//此代码也会创建一个AO，也包含a，return是在执行时才会起作用，不影响a变量的声名</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> b <span class="token operator">=</span> <span class="token number">10</span>		<span class="token comment">//等于 var a 100; b=100 </span>
    <span class="token comment">//函数内部 直接 变量 = 值 ，变量会提升至全局作用域</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>	<span class="token comment">//referenceError a is not define</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>	<span class="token comment">//10</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//foo2</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>		
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//foo1</span>
<span class="token comment">/*
	上面题目相当于
	var foo = 'undefined';
	foo = function(){console.log(2)};
	foo()		2
	foo = function foo() {console.log(1)};
	foo()		1
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><p><font color="orange">另外对于没有声名var的变量会放在全局对象属性内</font></p> <h3 id="内存管理"><a href="#内存管理" class="header-anchor">#</a> 内存管理</h3> <p>不管什么样的编程语言，在代码的执行过程中都是需要给它分配内存的，不同的是某些编程语言需要我们自己手动的管理内存，某些编程语言会可以自动帮助我们管理内存:</p> <ul><li>不管以什么样的方式来管理内存，内存的管理都会有如下的生命周期︰</li> <li>第一步:分配申请你需要的内存（申请）;</li> <li>第二步:吏用分配的内存（存放一些东西，比如对象等);</li> <li>第三步:不需要使用时，对其进行释放;</li></ul> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201151140914.png" alt="image-20220115114002836" style="zoom:70%;"> <h3 id="js的内存管理"><a href="#js的内存管理" class="header-anchor">#</a> <font color="orange">JS的内存管理</font></h3> <ul><li>JS对于基本数据类型内存的分配会在执行时，直接在栈空间进行分配;</li> <li><font color="orange">JS对于复杂数据类型内存的分配会在堆内存中开辟一块空间，并且将这块空间的指针返回值变量引用;保存的是内存地址。</font></li></ul> <h3 id="js的垃圾回收"><a href="#js的垃圾回收" class="header-anchor">#</a> <font color="orange">JS的垃圾回收</font></h3> <ul><li>对于那些不再使用的对象，我们都称之为是垃圾，它需要被回收，以释放更多的内存空间;</li> <li>而我们的语言运行环境，比如Java的运行环境JVM，JavaScript的运行环境js引擎都会内存垃圾回收器;垃圾回收器我们也会简称为</li> <li>GC，所以在很多地方你看到GC其实指的是垃圾回收器;</li></ul> <h4 id="gc算法"><a href="#gc算法" class="header-anchor">#</a> GC算法</h4> <h5 id="引用计数"><a href="#引用计数" class="header-anchor">#</a> 引用计数</h5> <p>对象在内存中好有一个专门存储自身被引用次数，根据引用次数判断是否要回收。但如果对象相互引用，就可能导致内存泄漏。</p> <h5 id="标记清除"><a href="#标记清除" class="header-anchor">#</a> 标记清除</h5> <p>是设置一个根对象 ( root object )，垃圾回收器会定期从这个根开始，找所有从根开始有引用到的对象，对于哪些没有引用到的对象，就认为是不可用的对象﹔可解决循环引用的问题</p> <p>可达做标记，没标记清除</p> <hr> <h2 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h2> <ul><li><font color="orange">高阶函数，以另一个函数为参数或返回值为一个函数称为高阶函数。</font></li> <li>函数回调，传了一个函数为参并执行</li> <li>当一个函数属于一个对象时，这个函数也是一个方法</li> <li><font color="orange">头等函数：指函数可以当作参数使用或者以函数为返回值,能够在函数内定义函数</font></li></ul> <h3 id="闭包的定义"><a href="#闭包的定义" class="header-anchor">#</a> <font color="orange">闭包的定义</font></h3> <ul><li>闭包（英语:Closure )，又称词法闭包( Lexical Closure )或函数闭包(function closures ) ;</li> <li>是在支持头等函数的编程语言中，实现词法绑定的一种技术;</li> <li>闭包在实现上是一个结构体，它存储了一个函数和一个关联的环境（相当于一个符号查找表）</li> <li><font color="orange">闭包跟函数最大的区别在于，当捕捉闭包的时候，它的自由变量会在捕捉时被确定，这样即使脱离了捕捉时的上下文，它也能照常运行;</font></li> <li>一个函数和对其周围状态( lexical environment，词法环境）的引用捆绑在一起(或者说函数被引用包围），这样的组合就是闭包</li> <li>也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域;</li> <li>在JavaScript 中，<font color="orange">每当创建一个函数，闭包就会在函数创建的同时被创建出来;</font></li></ul> <p>闭包是支持头等函数的编程语言实现词法绑定的一种技术，闭包的实现实际上是一个结构体，存储了一个函数和一个关联环境，闭包让函数让一个内部函数能够访问外部函数的能力。函数的上层作用域是在词法分析时就已经确认。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//如</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'ff'</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	consolo<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//这也是一个闭包，因为他访问了其外层作用域</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'foo'</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bar
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//正常来说执行foo时，当其执行结束后，其定义的变量name应该要被销毁，当bar执行仍可以访问到name，这就是闭包的作用</span>
<span class="token comment">//虽然foo执行结束从执行栈出来，当其VO对象没有被销毁，foo内部的bar函数声名时已经告诉bar的VO对象其父作用域在哪，因此即使bar脱离了上下文，也知道去哪里取变量，能够正常执行。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><font color="orange">子函数确认上层作用域在词法解析时就已经确定</font></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201151552233.png" alt="image-20220115155222139" style="zoom:80%;"> <h3 id="闭包的内存泄露"><a href="#闭包的内存泄露" class="header-anchor">#</a> 闭包的内存泄露</h3> <p>当一个函数执行结束后，如果其AO对象还在被引用，则其不会随着函数执行结束出栈而销毁。</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201151623362.png" alt="image-20220115162321294" style="zoom:80%;"> <p>​	<font color="orange">foo的AO对象因为被bar的AO的父作用链指着，因此一直不会被销毁</font></p> <p>​	<font color="orange"><strong>当foo的AO不再需要用到应该被销毁时，由于作用域引用的缘故，导致AO一直占着内存这就叫内存泄露</strong></font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> nmae <span class="token operator">=</span> <span class="token string">'foo'</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bar
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//通过直接将函数置为null销毁</span>
fn <span class="token operator">==</span> <span class="token keyword">null</span>
bar <span class="token operator">=</span> <span class="token keyword">null</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><hr> <h2 id="闭包内存回收和this的四个绑定规则"><a href="#闭包内存回收和this的四个绑定规则" class="header-anchor">#</a> 闭包内存回收和this的四个绑定规则</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'why'</span>
	<span class="token keyword">var</span> age <span class="token operator">=</span> <span class="token number">19</span>
	<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bar
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//此代码形成了闭包，在实际的js引擎中，由于age属性并未用到，该属性会被删除，只保留有用到的属性，节省内存空间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="this"><a href="#this" class="header-anchor">#</a> this</h3> <ul><li>所有函数执行时，会创建函数执行上下文</li> <li><font color="orange">执行上下文记录着函数的调用栈、AO对象等，<code>this</code>也记录在内</font></li> <li><code>this</code>是在执行时绑定</li> <li><font color="orange"><code>this</code>指向什么跟函数的位置无关，跟函数的被调用方式有关</font></li></ul> <h4 id="this的绑定规则-决定了this的指向"><a href="#this的绑定规则-决定了this的指向" class="header-anchor">#</a> this的绑定规则-决定了this的指向</h4> <ul><li><p>默认绑定</p> <p>​	函数在被调用的时候没有被绑定到任何对象上</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//也是指向window</span>
<span class="token punctuation">}</span>
<span class="token function">foo1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//全局调用，没有绑定到任何对象上</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo	<span class="token comment">//bar指向内存中的函数地址（记录着函数的代码段，不包含this）</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//指向window，因为被调用时没有绑定到某个对象上，跟函数定义在哪无关</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bar
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//this指向全局，因为没有绑定对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>隐式绑定
隐式绑定必须函数内部具备一个对函数的引用（如属性）
如果没有会找不到报错
正是由于这个引用简介绑定了this的指向</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//由哪个对象调用，this就指向那个对象</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;obj2&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">bar</span><span class="token operator">:</span>obj1<span class="token punctuation">.</span>foo
<span class="token punctuation">}</span>
obj2<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//由obj2调用， this指向obj2   </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>显示绑定</p> <p><font color="orange">对象内部不具备某一个函数方法又想在这个对象上强制执行此方法，可以通过<code>call</code>或<code>apply</code>方法，</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;函数被调用&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'obj'</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><font color="orange">通过<code>bind</code>方法</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>	<span class="token comment">//将foo显示绑定到aaa上，因此后续调用fn其this都会指向aaa</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//this指向aaa</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>new绑定
<font color="orange"><code>js</code>中允许通过new关键字去处理函数形成新的函数对象</font> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201171133925.png" alt="image-20220117113344754" style="zoom:80%;"></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//new foo时，会创建一个空对象，将函数内部的方法变量绑定到这个对象上并返回</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h4 id="this解决的问题"><a href="#this解决的问题" class="header-anchor">#</a> this解决的问题</h4> <ol><li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span>whiy<span class="token punctuation">,</span>
    <span class="token function-variable function">eating</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//this在次例子避免了因为obj名字改变导致对象内部函数也需要修改</span>
        consol<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>	<span class="token comment">//打印结果相同 </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//this在全局作用域下</span>
<span class="token comment">// 在浏览器指向window</span>
<span class="token comment">// 在node指向空对象 {}</span>
<span class="token comment">//在node环境下，当文件执行时node将文件当成模块并加载编译放到一个函数内，执行此函数.call({})，call在一个空对象上</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h4 id="题目"><a href="#题目" class="header-anchor">#</a> 题目</h4> <p>https://mp.weixin.qq.com/s/hYm0JgBI25grNG_2sCRlTA</p> <ol><li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">hySetTimeout</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> duration</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>	<span class="token comment">//this指向abc</span>
<span class="token punctuation">}</span>
<span class="token comment">//setTimeout内部是通过apply进行绑定的this对象，并且绑定的是全局对象；</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>	<span class="token comment">//window</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>   
2. ```javascript
   const boxDiv = document.querySelector('.box')
   boxDiv.onClick = function() {	//在DOM箭头事件指向元素
       console.log(this)
   }
   boxDiv.addEventListener('blur', function(){
       fn.call(boxDiv)		
   })
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li><div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>nums<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>	<span class="token comment">//this指向window</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
nums<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>	<span class="token comment">//this指向abc</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span>				
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h4 id="规则优先级"><a href="#规则优先级" class="header-anchor">#</a> 规则优先级</h4> <p>一个函数调用包含多条规则的优先级</p> <ol><li><p>默认优先级最低</p></li> <li><p>显示绑定高于隐式绑定
<font color="orange">显示绑定中bind优先级最高</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>			<span class="token comment">//this指向abc</span>
<span class="token comment">//bind</span>
<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//this指向abc</span>

<span class="token comment">//bind的优先级高于call、apply</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p><code>new</code>高于隐式绑定</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//this指向新创建的对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>new不能和call、apply一起使用，只能和bind使用
<font color="orange">new优先级高于显示绑定</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//this指向new对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h4 id="this规则之外"><a href="#this规则之外" class="header-anchor">#</a> this规则之外</h4> <h5 id="忽略显示绑定"><a href="#忽略显示绑定" class="header-anchor">#</a> 忽略显示绑定</h5> <p><font color="orange">apply、call、bind传入了null和undefined时会自动将this指向window</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="间接函数引用"><a href="#间接函数引用" class="header-anchor">#</a> 间接函数引用</h5> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>obj2<span class="token punctuation">.</span>bar <span class="token operator">=</span> obj1<span class="token punctuation">.</span>foo
obj2<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//this指向obj2</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'obj2'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>						   <span class="token comment">//不加分号会报错</span>
<span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>bar <span class="token operator">=</span> obj1<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//视为独立函数。this指向window</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><hr> <h2 id="箭头函数"><a href="#箭头函数" class="header-anchor">#</a> 箭头函数</h2> <ul><li>箭头函数不能作为构造函数配合new 一起使用</li> <li>箭头函数不会绑定this、argument属性</li> <li>箭头函数不绑定this， 它会捕获其所在（即定义的位置）上下文的this值， 作为自己的this值</li> <li>箭头函数内部自己是没有<code>arguments</code>的</li></ul> <h3 id="简写"><a href="#简写" class="header-anchor">#</a> 简写</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//如果只有一个参数括号可省略</span>
nums<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//如果函数执行体只有一行代码，大括号可省略,并且默认返回此行代码的执行结果，没有结果返回undefined</span>
nums<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> retrun e<span class="token operator">===</span> <span class="token string">'1'</span><span class="token punctuation">)</span>
<span class="token comment">//如果返回的是一个对象且只有一行代码</span>
<span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'mike'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">'18'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	<span class="token comment">//添加小括号强调返回值为对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="箭头函数的this"><a href="#箭头函数的this" class="header-anchor">#</a> 箭头函数的this</h3> <p>​		<font color="orange">箭头函数不适用<code>this</code>的四种规则</font></p> <p>​		<font color="orange">箭头函数是没有显示原型的，所以无法通过new 调用</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> bar
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">)</span>
<span class="token comment">//箭头函数内的this始终指向window</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span>
    <span class="token function-variable function">getData</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//setTimeout的this默认指向window</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
            <span class="token keyword">return</span> result 
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token comment">//getData内的setTimeout是箭头函数，其this指向要根据上下文分析，由于是通过obj调用方法因此this指向obj对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="apply-call-bind实现"><a href="#apply-call-bind实现" class="header-anchor">#</a> apply-call-bind实现</h2> <h3 id="实现call"><a href="#实现call" class="header-anchor">#</a> 实现call</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//给所有函数添加一个方法</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hycall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thisArg<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>		<span class="token comment">//args至少是空数组</span>
    <span class="token comment">//获取要执行的函数，这里this是隐式绑定，指向被调用函数</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>	
    <span class="token comment">//需要将非对象类型转成对象类型，因为无法在非对象类型直接添加使用方法</span>
    thisArg <span class="token operator">=</span> thisArg <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">)</span> <span class="token operator">:</span> window<span class="token punctuation">;</span> 	<span class="token comment">//会转成对应的包装对象</span>
    thisArg<span class="token punctuation">.</span>fn <span class="token operator">=</span> fn<span class="token punctuation">;</span>
    <span class="token keyword">var</span> res <span class="token operator">=</span> thisArg<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">//通过扩展运算符去除数组元素作为传入参数</span>
    <span class="token comment">// 以上两步也可以替换成 fn.call(thisArg)</span>
    <span class="token keyword">delete</span> thisArg<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>nums</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> nums
<span class="token punctuation">}</span>

sum<span class="token punctuation">.</span><span class="token function">hycall</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//进行了隐式绑定, this指向foo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="实现apply"><a href="#实现apply" class="header-anchor">#</a> 实现apply</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//apply第二个参数需要是数组，没有默认是undefined</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">thisArg<span class="token punctuation">,</span> argArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">//这里不需要扩展运算符接收</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
   
    thisArg <span class="token operator">=</span> <span class="token punctuation">(</span>thisArg <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> thisArg <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">)</span><span class="token operator">:</span>window<span class="token punctuation">;</span><span class="token comment">//优化处理</span>
    <span class="token comment">//thisArg = thisArg? Object(thisArg):window;	//这种写法会误判 0 和空字符</span>
    thisArg<span class="token punctuation">.</span>fn<span class="token operator">=</span> fn<span class="token punctuation">;</span>
    <span class="token keyword">let</span> res<span class="token punctuation">;</span>		<span class="token comment">//接收返回值</span>
    <span class="token comment">//if(!argArray){	//如果没有传第二个参数</span>
    <span class="token comment">//    res = thisArg.fn();</span>
    <span class="token comment">//}else{</span>
    <span class="token comment">//    res = thisArg.fn(...argArray);</span>
    <span class="token comment">//}</span>
    <span class="token comment">//argArray = argArray?argArray:[];</span>
    argArray <span class="token operator">=</span> argArray <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">//有值返回，没有返回空数组</span>
    thisArg<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>argArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> thisArg<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
foo<span class="token punctuation">.</span><span class="token function">myApply</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="实现bind"><a href="#实现bind" class="header-anchor">#</a> 实现bind</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">thisArg<span class="token punctuation">,</span> <span class="token operator">...</span>argArray</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    thisArg <span class="token operator">=</span> <span class="token punctuation">(</span>thisArg <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> thisArg <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>thisArg<span class="token punctuation">)</span><span class="token operator">:</span> window<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thisArg<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> finalArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>argArray<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//合并最终参数</span>
        <span class="token keyword">var</span> res <span class="token operator">=</span> thisArg<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> thisArg<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
        <span class="token keyword">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//用法类似call，但参数可以调用bar时传,也可以先在bind传前，再调用bar时传后几个参数</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="es6剩余参数"><a href="#es6剩余参数" class="header-anchor">#</a> ES6剩余参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>nums</span><span class="token punctuation">)</span><span class="token punctuation">{</span>		<span class="token comment">//通过...接收参数形成数组</span>
    
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//传入未知个数个参数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="arguments-参数-基本使用"><a href="#arguments-参数-基本使用" class="header-anchor">#</a> arguments(参数)基本使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> num3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//多出来的参数默认放入一个类数组 arguments内，本质为对象</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//获取参数个数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	    <span class="token comment">//通过索引获取参数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>callee<span class="token punctuation">)</span>	<span class="token comment">//获取参数所在的函数，随意使用可能会造成递归栈溢出的问题</span>
    <span class="token comment">//将类数组转成真实数组</span>
    <span class="token keyword">var</span> newArray2 <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过数组的原型对象的slice方法</span>
    <span class="token keyword">var</span> newArray3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ES6</span>
    <span class="token keyword">var</span> newArray4 <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> mewArray5 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arguments<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><p>浏览器全局是没有arguments的</p></li> <li><p>node全局是有arguments的
因为node将一个js文件当成一个模块，这个模块被包裹成一个函数，通过<code>call(null, ...args)</code></p></li> <li><p>箭头函数剩余参数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h2 id="纯函数-柯里化实现"><a href="#纯函数-柯里化实现" class="header-anchor">#</a> 纯函数-柯里化实现</h2> <p>​		JS函数式编程，也就是一种编程范式</p> <p>​		函数式编程中有一个概念叫纯函数</p> <h3 id="纯函数"><a href="#纯函数" class="header-anchor">#</a> 纯函数</h3> <ul><li>此函数在相同的输入值时，需产生相同的输出。</li> <li>函数的输出和输入值以外的其他隐藏信息或状态无关，也和由I/O设备产生的外部输出无关。（即返回结果只跟传入值有关）</li> <li>该函数不能有语义上可观察的函数副作用，诸如“触发事件”，使输出设备输出，或更改输出值以外物件的内容等。（即不能在纯函数内部触发其他事件或影响到外部）</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> newArray <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//slice是纯函数，不会影响原数组</span>
<span class="token keyword">var</span> newArray1 <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//splice会影响原数组有副作用不是纯函数</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="纯函数的优势"><a href="#纯函数的优势" class="header-anchor">#</a> 纯函数的优势</h4> <ul><li>安心的编写和使用</li> <li><font color="orange">你在写的时候保证了函数的纯度，只是单纯实现自己的业务逻辑即可，不需要关心传入的内容是如何获得的或者依赖其他的外部变量是否已经发生了修改;</font></li> <li>你在用的时候，你确定你的输入内容不会被任意篡改，并且自己确定的输入，一定会有确定的输出;</li></ul> <h4 id="纯函数修改变量"><a href="#纯函数修改变量" class="header-anchor">#</a> 纯函数修改变量</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//类似reducer</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>obj<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
obj <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//通过返回一个新对象接收而不是直接修改原对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="函数柯里化"><a href="#函数柯里化" class="header-anchor">#</a> 函数柯里化</h3> <ul><li>是把接收多个参数的函数，变成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数，而且返回结果的新函数的技术;</li> <li>柯里化声称“如果你固定某些参数，你将得到接受余下参数的一个函数;</li></ul> <p>总结</p> <ul><li>只传递参数的一部分来调用它，让它返回一个新函数处理剩余参数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> x<span class="token operator">+</span>y
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">sum2</span> <span class="token operator">=</span> <span class="token parameter"><span class="token constant">X</span></span> <span class="token operator">=&gt;</span> <span class="token parameter">y</span> <span class="token operator">=&gt;</span> x<span class="token operator">+</span>y<span class="token punctuation">;</span>		<span class="token comment">//简写</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="柯里化作用"><a href="#柯里化作用" class="header-anchor">#</a> 柯里化作用</h3> <ul><li>在函数式编程中，我们其实往往希望一个函数处理的问题尽可能的单一，而不是将一大堆的处理过程交给一个函数来处理;（函数单一职责原则）</li> <li>那么我们是否就可以将每次传入的参数在单一的函数中进行处理，处理完后在下一个函数中再使用处理后的结果;</li> <li>也可以实现逻辑复用</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//使用场景</span>
<span class="token comment">//对第一个参数+10</span>
<span class="token comment">//第二个参数—100 .... </span>
<span class="token comment">//如果不同参数的处理逻辑十分复杂，那么全部写在一个函数内会造成结构复杂，且不符合函数单一职责，通过函数柯里简化单一函数，让逻辑更加清晰。</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202090009467.png" alt="image-20220209000937366" style="zoom:67%;"> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//根据参数值返回结构,自动柯里化</span>
<span class="token keyword">function</span> <span class="token function">autoCurrying</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">3</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">curried</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>							   <span class="token comment">//第二个参数定义将要接收的参数个数,默认3个</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>                               <span class="token comment">//当参数个数符合要求才执行目标函数</span>
            <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        	<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            	<span class="token keyword">return</span> <span class="token function">curried</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>args1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	  <span class="token comment">//接收合并参数,再次调用curried函数</span>
          	<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> curried
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">autoCurrying</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> test1 <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>vue3的createApp通过柯里化实现，第一个参数是render函数，第二个是根组件。</p> <h3 id="组合函数"><a href="#组合函数" class="header-anchor">#</a> 组合函数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo1</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo2</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> y
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">composeFn</span><span class="token punctuation">(</span><span class="token parameter">fn1<span class="token punctuation">,</span> fn2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">count</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token function">fn1</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">composeFn</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>fns</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> length <span class="token operator">=</span> fns<span class="token punctuation">.</span>length
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'要求函数类型'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 		
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> res <span class="token operator">=</span>length<span class="token operator">?</span>fns<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token operator">:</span>args<span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">++</span>index<span class="token operator">&lt;</span> length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            res <span class="token operator">=</span> fns<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> res
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> compose<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> newFn <span class="token operator">=</span> <span class="token punctuation">(</span>fn1<span class="token punctuation">,</span> fn2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">newFn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="with-eval-严格模式-面向对象"><a href="#with-eval-严格模式-面向对象" class="header-anchor">#</a> with-eval-严格模式-面向对象</h2> <h3 id="with语句"><a href="#with语句" class="header-anchor">#</a> with语句</h3> <p>不推荐使用<code>with</code>语句，会产生兼容性错误和混淆错误</p> <p>with 语句不会沿着函数本身的作用域，而是沿着<code>with</code>的参数对象去查询</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//with会形成自己的作用域</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'mary'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> name  <span class="token operator">=</span> <span class="token string">'Mike'</span><span class="token punctuation">;</span>
    <span class="token keyword">with</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>			
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//mary</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="eval函数"><a href="#eval函数" class="header-anchor">#</a> eval函数</h3> <p><code>eval</code>函数可以将一段字符串当作代码执行。是一个全局函数</p> <p><code>eval</code>代码可读性差，<code>eval</code>执行必须经过JS解析器，不能被JS引擎优化，而且字符串容易被篡改。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> jsString <span class="token operator">=</span> <span class="token string">'console.log('</span>Hello word<span class="token string">');'</span>
<span class="token function">eval</span><span class="token punctuation">(</span>jsString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="严格模式"><a href="#严格模式" class="header-anchor">#</a> 严格模式</h3> <p><code>ECMAScript5</code>提出的概念</p> <ul><li>严格模式是一种具有限制性的JavaScript模式，从而使代码隐式的脱离了”懒散（sloppy)模式“;</li> <li>支持严格模式的浏览器在检测到代码中有严格模式时，会以更加严格的方式对代码进行检测和执行;</li></ul> <h4 id="严格模式的限制"><a href="#严格模式的限制" class="header-anchor">#</a> 严格模式的限制</h4> <ul><li>严格模式通过抛出错误来消除一些原有的静默(错误;</li> <li><font color="orange">严格模式让JS引擎在执行代码时可以进行更多的优化(不需要对一些特殊的语法进行处理；</font></li> <li>严格模式禁用了在ECMAScript未来版本中可能会定义的一些语法；（如禁止将<code>class</code>设为变量名）</li></ul> <h4 id="开启严格模式"><a href="#开启严格模式" class="header-anchor">#</a> 开启严格模式</h4> <p>使用<code>webpack</code>等打包工具打包后会开启严格模式，无需手动设置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//给某个js文件开启严格模式 </span>
<span class="token string">&quot;use strict&quot;</span>  <span class="token comment">//在文件最上方添加</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//给单个函数开启</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="严格模式常见限制"><a href="#严格模式常见限制" class="header-anchor">#</a> 严格模式常见限制</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1.意外创建全局变量</span>
message <span class="token operator">=</span> <span class="token string">'hello world'</span>
<span class="token comment">// 2.不允许函数有相同的参数名称</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>			<span class="token comment">//重复参数，后面的覆盖前面</span>
<span class="token comment">// 3.给NaN赋值</span>
<span class="token number">NaN</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">// 4.给只读属性赋值,修改不可配置对象</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>			<span class="token comment">//可否写</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span><span class="token boolean">false</span>		<span class="token comment">//可否配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 5.不可使用原先8进制</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0123</span><span class="token punctuation">;</span>		<span class="token comment">//八进制赋值</span>
<span class="token comment">// 6.自执行函数指向undefined</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//undefined </span>
<span class="token punctuation">}</span>
<span class="token comment">// 7.setTimeOut this指向window</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h1 id="面向对象"><a href="#面向对象" class="header-anchor">#</a> 面向对象</h1> <h2 id="面向对象一"><a href="#面向对象一" class="header-anchor">#</a> 面向对象一</h2> <h3 id="创建对象方式"><a href="#创建对象方式" class="header-anchor">#</a> 创建对象方式</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//方式1</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function-variable function">running</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//方式2</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'miake'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">eating</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="数据属性描述符"><a href="#数据属性描述符" class="header-anchor">#</a> 数据属性描述符</h3> <ul><li><p>如不允许对象属性被赋值、被删除、被遍历</p></li> <li><p>通过属性描述符 <code>Object.defineProperty(target, key, value)</code>，其三个参数分别为目标对象，属性。属性值，返回传入的对象</p></li> <li><p>只要通过属性描述符定义属性，其默认特性都是<code>false</code></p></li> <li><p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202112309033.png" alt="image-20220211230905830"></p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">'mike'</span>
    <span class="token literal-property property">writable</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>			<span class="token comment">//是否可以赋值 </span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>		<span class="token comment">//是否删除，重定义</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span><span class="token boolean">true</span>			<span class="token comment">//是否枚举</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h3 id="存取属性描述符"><a href="#存取属性描述符" class="header-anchor">#</a> <font color="orange">存取属性描述符</font></h3> <ul><li><p>隐藏一个私有属性，截取一个属性被外界访问和修改的过程(Vue2的响应式原理) <font color="orange"><code>js</code>没有严格意义的私有属性</font></p></li> <li><p>具备<code>enumerable</code>、<code>configurable</code>、<code>get</code>、<code>set</code>四个内置属性</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">_address</span><span class="token operator">:</span><span class="token string">'北京'</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> address<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_address
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_address <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul> <h3 id="同时定义多个属性描述符"><a href="#同时定义多个属性描述符" class="header-anchor">#</a> 同时定义多个属性描述符</h3> <p><code>Object.defineProperties</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">'Mike'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">10</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//另外一种私有属性写法</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">_age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token function-variable function">_eating</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_age <span class="token operator">=</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_age
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//打印此对象会多了 age:[Getter/Setter]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="获取对象属性描述符"><a href="#获取对象属性描述符" class="header-anchor">#</a> 获取对象属性描述符</h3> <h4 id="获取一个特定属性描述符"><a href="#获取一个特定属性描述符" class="header-anchor">#</a> 获取一个特定属性描述符</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj， <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj， <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="获取多个对象属性描述符"><a href="#获取多个对象属性描述符" class="header-anchor">#</a> 获取多个对象属性描述符</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//获取对象全部属性</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="object的方法对对象限制"><a href="#object的方法对对象限制" class="header-anchor">#</a> Object的方法对对象限制</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//禁止对象继续添加新的属性</span>
Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//禁止对象配置删除属性</span>
Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//让对象属性不可修改</span>
Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//冻结一个对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="面向对象二"><a href="#面向对象二" class="header-anchor">#</a> 面向对象二</h2> <h3 id="创建对象方案"><a href="#创建对象方案" class="header-anchor">#</a> 创建对象方案</h3> <ul><li><p>字面量声名，不断声名对象创建，需要编写大量重复代码</p></li> <li><p>工厂模式</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">,</span>
        age
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">'18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span> <span class="token string">'19'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>缺点：无法具体区分类型，都是<code>Object</code>类型</p></li> <li><p><font color="orange">构造函数</font></p></li></ul> <h3 id="js的构造函数"><a href="#js的构造函数" class="header-anchor">#</a> JS的构造函数</h3> <ul><li>构造函数也称为构造器，创建对象时调用的函数</li> <li>构造函数也是一个普通的函数，从表现形式来说，和千千万万个普通的函数没有任何区别;</li> <li>那么如果这么一个普通的函数被使用new操作符来调用了，那么这个函数就称之为是一个构造函数;</li></ul> <h4 id="new操作符"><a href="#new操作符" class="header-anchor">#</a> new操作符</h4> <h5 id="new操作符做了什么"><a href="#new操作符做了什么" class="header-anchor">#</a> new操作符做了什么</h5> <ol><li>在内存中创建一个新的对象(空对象）;</li> <li>这个对象内部的[Iprototype]]属性会被赋值为该构造函数的prototype属性;</li> <li>构造函数内部的<code>this</code>，会指向创建出来的新对象;</li> <li>执行函数的内部代码（函数体代码) ;</li> <li>如果构造函数没有返回非空对象，则返回创建出来的新对象;</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//{}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token class-name">__proto__</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span>	<span class="token comment">//foo</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>约定俗成首字母大写的函数为构造函数，ES6的class是此种函数的语法糖。</p> <h3 id="构造函数的缺点"><a href="#构造函数的缺点" class="header-anchor">#</a> 构造函数的缺点</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 没必要为p1和p2同时开启eating大小的内存空间，浪费空间</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">eating</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="对象原型"><a href="#对象原型" class="header-anchor">#</a> 对象原型</h3> <p><code>JavaScript</code>当中每个对象都有一个特殊的内置属性<code>[[prototype]]</code>，这个特殊的对象可以指向另外一个对象。这个属性称为对象原型（隐式原型）</p> <p>早期的ECMA没有规范如何查看 <code>[[prototype]]</code></p> <p><font color="orange">浏览器提供如下方法可以让我们查看一下这个原型对象</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><font color="orange">ES5提供了如下方法获取</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getProtptypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//toString</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="原型的作用"><a href="#原型的作用" class="header-anchor">#</a> 原型的作用</h4> <ul><li><font color="orange">当尝试从对象获取一个属性时，会触发它的<code>[[get]]</code>方法，从当前对象查早，有就直接使用，没有直接沿着原型查找<code>[[prototype]]</code></font></li></ul> <h3 id="函数原型"><a href="#函数原型" class="header-anchor">#</a> 函数原型</h3> <p><font color="orange">函数也是一个对象，也具备隐式原型<code>[[prototype]]</code>,但函数比起普通对象还多了一个显式原型<code>prototype</code>,可直接访问到</font></p> <p><font color="orange">当执行new操作时，其内部还将构造出来的对象的隐式原型指向构造函数的显示原型.</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> foo<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>			
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'mike'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> p2<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//true  [[prototype]]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//mike</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202120010039.png" alt="image-20220212001058898" style="zoom:57%;"> <h3 id="获取函数的显示原型"><a href="#获取函数的显示原型" class="header-anchor">#</a> 获取函数的显示原型</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>console.log(foo.prototype);
console.log(Object.getOwnPropertyDescriptors(foo.prototype));
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><font color="orange">一个构造函数的原型对象默认内置一个<code>constructor</code>的函数，这个函数指向这个构造函数本身 </font></p> <p>函数的原型的顶部最后的隐式原型 (<code>__proto__</code>)指向<code>null</code></p> <h3 id="原型链的尽头"><a href="#原型链的尽头" class="header-anchor">#</a> 原型链的尽头</h3> <p><font color="orange">当一个对象的隐式原型指向<code>null</code>时，说明已经到了顶层原型</font></p> <p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202121413232.png" alt="image-20220212141308018"></p> <h3 id="原型链直接继承的弊端"><a href="#原型链直接继承的弊端" class="header-anchor">#</a> 原型链直接继承的弊端</h3> <ol><li>无法打印继承属性</li> <li>修改引用的值会相互影响</li> <li>无法传递参数</li></ol> <h3 id="借用构造函数实现继承-组合"><a href="#借用构造函数实现继承-组合" class="header-anchor">#</a> <font color="orange">借用构造函数实现继承</font>（组合）</h3> <p>解决原型直接继承的弊端，但父类会被至少调用两次，stu原型多了没必要的属性</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>		<span class="token comment">//Person被通过call显示绑定 stu,实现了接用Person的公共方法，在stu对象上创建了新属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Studnet</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age<span class="token punctuation">,</span> sno</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//隐式绑定，指向 stu，第二次调用P</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> p<span class="token punctuation">;</span>				<span class="token comment">//第一次调用P</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'mike'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>如果直接将子类的原型指向父类原型可能会污染父类原型</li></ul> <h2 id="面向对象三"><a href="#面向对象三" class="header-anchor">#</a> 面向对象三</h2> <h3 id="原型式继承函数-寄生"><a href="#原型式继承函数-寄生" class="header-anchor">#</a> 原型式继承函数(寄生)</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//方法1</span>
<span class="token keyword">function</span> <span class="token function">createObj1</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   Object<span class="token punctuation">.</span><span class="token function">setPropertyOf</span><span class="token punctuation">(</span>newObj<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span> 	<span class="token comment">//相当于 newObj.__proto = o</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token function">createObj1</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//方法2</span>
<span class="token keyword">function</span> <span class="token function">createObj2</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">function</span> <span class="token function">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token class-name">Fn</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
<span class="token comment">//最新</span>
<span class="token comment">//返回一个对象，对象的隐式原型指向 create参数</span>
<span class="token keyword">var</span> info <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//info.__proto__ = obj</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><font color="orange">打印一个函数时，会从函数找到<code>constructor</code></font></p> <h3 id="实现继承的最终方案"><a href="#实现继承的最终方案" class="header-anchor">#</a> 实现继承的最终方案</h3> <p><font color="orange">寄生组合式继承</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//该方法实现了子类的原型指向一个对象，此对象的原型指向符父类原型，并且为这个对象添加了一个构造函数constructor指向子类</span>
<span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">SubType<span class="token punctuation">,</span> SuperType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	<span class="token comment">//第一个参数为子类，第二个参数为父类</span>
    <span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'constructor'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">'SubType'</span><span class="token punctuation">,</span>
       	<span class="token literal-property property">configurable</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">writable</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Studnet<span class="token punctuation">,</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token function">funciton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> Stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'mike'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//手动实现Object.create</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCreate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token class-name">Fn</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="判断方法的补充"><a href="#判断方法的补充" class="header-anchor">#</a> 判断方法的补充</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> info <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">address</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">'北京'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//Object.create第二个参数添加的属性添加在返回的对象内</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol><li><p>判断属性是自己还是原型链上的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'address'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">// 对象自身的hasOwnProperty</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name'</span> <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//in操作符</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><code>instanceof</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Student<span class="token punctuation">,</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stu <span class="token keyword">instanceof</span> <span class="token class-name">Student</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stu <span class="token keyword">instanceof</span> <span class="token class-name">Person</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stu <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//true	</span>
<span class="token comment">//instanceof是判断 对象的原型链上是否有目标对象的原型</span>
<span class="token comment">// stu.__proto__.的原型链上 是否存在一个等于 Student.prototype</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>isPropertypeOf</code>
判断某个对象是否出现在原型对象上</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Studnet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Studnet</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPropertypeOf</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h3 id="函数与对象"><a href="#函数与对象" class="header-anchor">#</a> 函数与对象</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token comment">//定义了foo函数，js内部是通过 new Function()创建出这个foo函数</span>
<span class="token comment">//因为foo是函数且是通过Function new操作出来的，因此 foo.__proto__ = Function.prototype</span>
<span class="token comment">//同时js引擎会对类型是函数的对象自动创建一个显示原型 foo.prototype = {constructor} constructor等于foo函数</span>

fucntion <span class="token function">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">//此函数是 Object函数创造了</span>
Function<span class="token punctuation">.</span>__pro__ <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype

<span class="token comment">//唯一一个特殊的</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype <span class="token operator">===</span> Function<span class="token punctuation">.</span>__proto__

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="object和function"><a href="#object和function" class="header-anchor">#</a> Object和Function</h4> <p><font color="orange"><code>Function</code>函数也是一个函数生成的，因此它的隐式原型指向显示原型，<code>Object</code>函数也是函数生成，因此<code>Object.__proto</code>指向 <code>Function.prototype</code>，而这些函数的prototype对象本质上还是一个对象，因此这些显示原型对象自身的<code>__proto__</code>都指向<code>Object.prototype</code>；最终的Object函数的原型对象<code>Object.prototype</code>的隐式原型指向<code>null</code></font></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1.Function也是函数生成，因此Function.__proto__ === Function.prototype
2.Function.prototype（显示原型是一个对象），是Object创造的 Function.prototype.__proto__ === Object.prototype
3.Object本身是一个被创造的函数，因此 Object.__proto__ = Function.prototype
4.Object函数的自动创建的prototype对象的隐式原型指向null
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202121607980.png" alt="image-20220212160756882" style="zoom:80%;"> <h2 id="面向对象演变"><a href="#面向对象演变" class="header-anchor">#</a> 面向对象演变</h2> <ol><li><p>直接通过 <code>new Object</code>或 <code>let obj = {}</code>直接创建对象</p></li> <li><p><font color="orange">通过工厂函数创建对象,代码复用性弱，无法区分类型</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> createObj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>构造函数+new操作符</p> <ul><li>通过new操作符与构造函数的形式创建新对象返回</li> <li>如果构造函数有相同的方法，必须为每个实例创建同样大小的空间，造成内存浪费</li> <li>可以区分对象类型</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>原型模式</p> <ul><li></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>组合式继承</p> <ul><li>父类的方法可以继承</li> <li>子类可以通过call方法调用父类构造函数</li> <li>父类构造函数要调用两次</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>					<span class="token comment">//父类的属性不会被引用</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>	
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eating</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>		<span class="token comment">//父类的方法可以共享</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
<span class="token keyword">let</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//stu.__proto__ = Person.prototype;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>借用构造函数继承，直接将子类的显示原型指向父类构造函数创建的对象，子类内部通过显示绑定执行父类方法，但是子类内部会多些没必要的属性，且需要调用两次父类的构造方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> p<span class="token punctuation">;</span>
<span class="token keyword">let</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Studnet</span><span class="token punctuation">(</span><span class="token string">'mike'</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>寄生组合式继承</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">SubType<span class="token punctuation">,</span> SuperType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//将子构造方法的显示原型指向父类构造方法创建的对象 SubType.prototype = obj; obj.__proto__ = SuperType</span>
    <span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>SuperType<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//相当于 SubType.prototype = new SuperType()</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//无需再调用两次父类烦烦烦</span>
<span class="token punctuation">}</span>
<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Student<span class="token punctuation">,</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Studnet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ol> <h1 id="es"><a href="#es" class="header-anchor">#</a> ES</h1> <h2 id="es6类的使用"><a href="#es6类的使用" class="header-anchor">#</a> ES6类的使用</h2> <ul><li>ES6新的标准使用了<code>class</code>关键字定义类</li> <li>本质上还是构造函数、原型类的语法糖</li></ul> <h3 id="具体使用"><a href="#具体使用" class="header-anchor">#</a> 具体使用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token comment">//类也是有自己的显示原型对象，Person.prototype</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//function</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//p.__proto__ === Person.prototype</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>原先直接函数定义构造类函数可以直接传参数，ES6的类通过类内的<code>constructor</code>函数（构造方法）传参。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">eating</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'mike'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="类的静态方法"><a href="#类的静态方法" class="header-anchor">#</a> 类的静态方法</h4> <p>无需通过类创建一个对象，可以通过类名直接调用类内的方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Person<span class="token punctuation">.</span><span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="类的继承"><a href="#类的继承" class="header-anchor">#</a> 类的继承</h4> <p><font color="orange"><code>super</code>关键字</font></p> <p>之前通过<code>call</code>方法调用父类的方法</p> <ul><li>ES6类的继承其子类显示原型还是指向一个新对象，这个新对象的隐式原型指向父类的显示原型</li> <li><font color=":orange">还多出了一部操作 ： <code>Student.__proto__ = Person</code>，这部的目的是为了实现静态方法的继承</font></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">eating</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>			<span class="token comment">//students是子类，也叫派生类</span>
    <span class="token comment">// JS引擎在解析子类的时候要求，如果实现继承</span>
    <span class="token comment">// 那么子类的构造方法中，在使用this之前，必须调用 super()调用父类的构造函数</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sno</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//是个语法糖，属性最终都添加在new出来的对象内</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//类似于 Person.constructor</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sno <span class="token operator">=</span> sno<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">//子类重写父类的方法</span>
    <span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>			<span class="token comment">//重写父类的running方法</span>
        <span class="token comment">//子类调用父类的方法</span>
    	<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">eating</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>			
<span class="token punctuation">}</span>
<span class="token comment">// Student.prototype.__proto__ === Person.prototype</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="es6转es5"><a href="#es6转es5" class="header-anchor">#</a> ES6转ES5</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
	
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​	babel在转化代码时，会识别标记纯函数，如果一个函数没有被使用吗，在用一些打包工具时，如webpack开启树摇，会不对没用到的代码进行打包。</p> <h4 id="继承内置类"><a href="#继承内置类" class="header-anchor">#</a> 继承内置类</h4> <p>如如数组类添加一些自己的内置方法，不会污染<code>Array</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">myArr</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token punctuation">{</span>
	<span class="token function">firstItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	 <span class="token comment">//</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">myArr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="类的混入"><a href="#类的混入" class="header-anchor">#</a> 类的混入</h4> <p>JavaScript只支持单继承，父类只能有一个。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//通过函数传入一个类，在一个已经继承的类继续继承重构</span>
<span class="token keyword">function</span> <span class="token function">mixinRunner</span><span class="token punctuation">(</span><span class="token parameter">BaseClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">NewClass</span> <span class="token keyword">extends</span> <span class="token class-name">BaseClass</span> <span class="token punctuation">{</span>	
        <span class="token function">running</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> NewClass				
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">var</span> newStuClass <span class="token operator">=</span> <span class="token function">mixinRunner</span><span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//新类即继承</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">newStuClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="javascript的多态"><a href="#javascript的多态" class="header-anchor">#</a> JavaScript的多态</h4> <p><font color="orange">当对不同数据类型执行相同操作，如果表现的形式不一样，就是多态的体现</font></p> <p>传统多态的前提</p> <ul><li>必须有继承</li> <li>必须有重写</li> <li>必须有父类引用子类对象</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Shape</span> <span class="token punctuation">{</span>
    <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
clsss son1 <span class="token keyword">extends</span> <span class="token class-name">Shape</span><span class="token punctuation">{</span>
    <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
clsss son2 <span class="token keyword">extends</span> <span class="token class-name">Shape</span><span class="token punctuation">{</span>
    <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">calcArea</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">shape</span><span class="token operator">:</span> Shape</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Shape<span class="token punctuation">.</span><span class="token function">getArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//都调用了calcArea，传入了不同参数，影响不同</span>
<span class="token function">calcArea</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">son1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">calcArea</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">son2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="es6"><a href="#es6" class="header-anchor">#</a> ES6</h2> <h3 id="字面量增强"><a href="#字面量增强" class="header-anchor">#</a> 字面量增强</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'mike'</span>
<span class="token keyword">var</span> unknow <span class="token operator">=</span> <span class="token string">'111'</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span><span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>		<span class="token comment">//简写 name: name </span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
	<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>			<span class="token comment">//语法糖，简写</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>		<span class="token comment">//这不是简写</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>unknow<span class="token operator">+</span><span class="token string">&quot;11&quot;</span><span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'11'</span>		<span class="token comment">//计算属性名</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="解构"><a href="#解构" class="header-anchor">#</a> 解构</h3> <h4 id="数组解构"><a href="#数组解构" class="header-anchor">#</a> 数组解构</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name1'</span><span class="token punctuation">,</span> <span class="token string">'name2'</span><span class="token punctuation">,</span> <span class="token string">'name3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//数组解构</span>
<span class="token keyword">var</span> <span class="token punctuation">[</span>item1<span class="token punctuation">,</span> item2<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">;</span>		<span class="token comment">//命名</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item1<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//name1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item2<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//name2</span>

<span class="token comment">//解构后面元素</span>
<span class="token keyword">var</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">,</span>item3<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item3<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//name3</span>

<span class="token comment">//解构一个元素，后面的放到新数组</span>
<span class="token keyword">var</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> <span class="token operator">...</span>newArr<span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">;</span>	<span class="token comment">//name:name1    newArr:[name2, name3]</span>

<span class="token comment">//解构默认值</span>
<span class="token keyword">var</span> <span class="token punctuation">[</span>name1<span class="token punctuation">,</span> name2<span class="token punctuation">,</span> name3<span class="token punctuation">,</span> name4 <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">]</span> <span class="token operator">=</span> list<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="对象解构"><a href="#对象解构" class="header-anchor">#</a> 对象解构</h4> <p>更加灵活，没有顺序</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">11</span>
<span class="token punctuation">}</span>
<span class="token comment">//对象解构</span>
<span class="token keyword">var</span> <span class="token punctuation">{</span>name <span class="token punctuation">,</span> age<span class="token punctuation">}</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>		
<span class="token comment">// key重命名</span>
<span class="token keyword">var</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> newName<span class="token punctuation">}</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newName<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//why</span>
<span class="token comment">//重命名且设置默认值</span>
<span class="token keyword">var</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> newName <span class="token operator">=</span> <span class="token string">'11'</span><span class="token punctuation">}</span> <span class="token operator">=</span> obj<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//参数传递时解构</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">11</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//直接传递对象，让函数调用时自己解构</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="let-const的基本使用"><a href="#let-const的基本使用" class="header-anchor">#</a> let/const的基本使用</h3> <h4 id="let"><a href="#let" class="header-anchor">#</a> let</h4> <ul><li>不可重复声名</li> <li>不可在声名前访问</li></ul> <p>在全局通过var声名一个变量，会在window上添加一个属性，但是<code>let</code> 和 <code>const</code>不会</p> <p>每个执行上下文会被关联到一个变量环境，在源代码的变量和函数声名会作为属性添加到VO中，对于函数，参数也会添加到VO中</p> <p>每一个执行上下文会关联到一个变量环境(VariableEnvironment) VE中，在执行代码中变量和函数的声明会作为环境记录(Environment Record)添加到变量环境，对于函数其参数也会添加都变量环境。</p> <p><code>let</code>变量在执行上下文被创建时，<code>let</code>变量就已经被创建了，但是不可以任何方式访问，直到词法绑定求值。没有作用域提升。</p> <h4 id="const"><a href="#const" class="header-anchor">#</a> const</h4> <p>​		如果<code>const</code>变量是一个基本类型，不可修改，如果是引用类型，可以修改引用内部的变量，但不能直接替换引用对象</p> <h4 id="let-const和window"><a href="#let-const和window" class="header-anchor">#</a> let-const和window</h4> <p><font color="orange">早期ECMA标准：这些执行上下文和变量是关联到一个VO<code>（variable object）</code>对象中，现在是关联到一个变量环境（可以以更多形式来表示）</font></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202122152339.png" alt="image-20220212215212228" style="zoom:80%;"> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> Go <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">foo</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">}</span>		<span class="token comment">//全局对象</span>
<span class="token keyword">var</span> window <span class="token operator">=</span> Go
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>现在ECMA标准</strong></p> <p>每一个执行上下文会关联到一个<strong>变量环境</strong>(VariableEnvironment)中，在执行代码中变量和函数的声明会作为<strong>环境记录</strong>(Environment Record)添加到变量环境中。</p> <p>对于函数来说，参数也会被作为环境记录添加到变量环境中。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//V8</span>
<span class="token literal-property property">variables_</span><span class="token operator">:</span> VariableMap		<span class="token comment">//一个哈希Map结构</span>

<span class="token comment">//当var声名还是会在window上添加，是为了处理兼容性问题</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202122152569.png" alt="image-20220212215224458" style="zoom:80%;"> <h3 id="块级作用域"><a href="#块级作用域" class="header-anchor">#</a> 块级作用域</h3> <p><font color="orange">ES6新增了块作用域，并且通过 <code>let、const、function、class</code>声名的标识符是具备块级作用域</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
	<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span>		<span class="token comment">//块代码，但ES6之前没有块作用域概念</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'mike'</span><span class="token punctuation">;</span>		<span class="token comment">//没有产生新的作用域，记录的是键值对</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ES5只有两个东西会形成作用域</strong></p> <ol><li>全局作用域</li> <li>函数作用域</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//这段代码有3个作用域 全局、foo作用域、bar作用域</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="es6作用域"><a href="#es6作用域" class="header-anchor">#</a> ES6作用域</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token string">'111'</span>		<span class="token comment">//外界可访问</span>
    <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token string">'why'</span><span class="token punctuation">;</span>		<span class="token comment">//外界不可访问</span>
    <span class="token keyword">function</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>		<span class="token comment">//大部分浏览器为了兼容以前的代码所以让function没有块作用域概念</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><font color="orange"><code>if、switch、for</code>也是块级作用域</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//这段代码无法执行，虽然每次迭代都会产生新作用域但const的值在块内会执行加1操作</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//可以执行</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><font color="orange">我们用let 、const定义一个变量，在其声名之前都不可以使用，这个叫暂时性死区</font></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>var foo = 'foo'
function bar() {
	console.log(foo);
	let foo = 'abc'
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>var所表现出来的特殊性:比如作用域提升、window全局对象。没有块级作用域等都是一些历史遗留问题</p> <h3 id="模板字符串"><a href="#模板字符串" class="header-anchor">#</a> 模板字符串</h3> <p>模板字符串可以调用函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'mike'</span>
consoloe<span class="token punctuation">,</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;my name is ${name}&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="标签模板字符串"><a href="#标签模板字符串" class="header-anchor">#</a> 标签模板字符串</h3> <p><code>react</code>的styled-components通过这种代码实现在JS编写css</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>			<span class="token punctuation">[</span>Hello<span class="token punctuation">,</span> world<span class="token punctuation">]</span><span class="token punctuation">,</span> mike
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token string">'eeeeee'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'mike'</span>
foo<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">world</span><span class="token template-punctuation string">`</span></span>		<span class="token comment">//	</span>
<span class="token comment">//第一个参数依然是模块字符串中整个字符串，只是被切成多块,放到了一个数组中</span>
<span class="token comment">//第二个参数是模块字符串中，第一个$[}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="函数默认参数"><a href="#函数默认参数" class="header-anchor">#</a> 函数默认参数</h3> <p>有默认值最好放到最后</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//ES5</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    m <span class="token operator">=</span> m <span class="token operator">||</span> <span class="token string">'aaa'</span>	<span class="token punctuation">;</span><span class="token comment">//有bug,0和空字符串会被视为false</span>
<span class="token punctuation">}</span>
<span class="token comment">//ES6</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token operator">=</span><span class="token number">1</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">//foo.length 为函数参数个数，有默认值不计算在内</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="函数的剩余参数"><a href="#函数的剩余参数" class="header-anchor">#</a> 函数的剩余参数</h3> <p>只有函数的最后一个参数前有...才会将剩余参数形成数组</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>	<span class="token comment">//1, 2, [3, 4, 5]</span>

<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>argument和剩余参数的区别</strong></p> <ul><li>剩余参数必须放到最后</li> <li>argument不是一个真正的数组</li></ul> <h3 id="展开语法"><a href="#展开语法" class="header-anchor">#</a> 展开语法</h3> <ul><li>可以在函数调用数组构造时，将数组表达式或者string在语法层面展开;</li> <li>还可以在构造字面量对象时,将对象表达式按key-value的方式展开；</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token operator">...</span>list<span class="token punctuation">)</span>		<span class="token comment">//调用函数展开数组</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'123'</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token operator">...</span>name<span class="token punctuation">)</span>		<span class="token comment">//调用函数可以展开字符串</span>
<span class="token keyword">var</span> info <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">''</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>info<span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span><span class="token string">'广州'</span><span class="token punctuation">,</span> <span class="token operator">...</span>list<span class="token punctuation">}</span><span class="token punctuation">;</span>	<span class="token comment">//同时展开数组和对象生成新对象</span>
<span class="token comment">/*obj = {
   name:'',
   address:'广州',
   0:1,
   1:2,
   2:3
}*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><font color="orange">展开运算符做的是浅拷贝，即生成的新对象内的属性改变会隐形被展开对象的值，因为新对象的属性是值的引用</font></p> <h3 id="es6数值表示"><a href="#es6数值表示" class="header-anchor">#</a> ES6数值表示</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//不同进制</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>	<span class="token comment">//10</span>
<span class="token keyword">const</span> num1 <span class="token operator">=</span> <span class="token number">0b100</span><span class="token punctuation">;</span>  <span class="token comment">//2</span>
<span class="token keyword">const</span> num2 <span class="token operator">=</span> <span class="token number">0o100</span><span class="token punctuation">;</span>  <span class="token comment">//8</span>
<span class="token keyword">const</span> num3 <span class="token operator">=</span> <span class="token number">0x100</span><span class="token punctuation">;</span>	 <span class="token comment">//16</span>
<span class="token comment">//大的数值连接符 ES2021 ES12</span>
<span class="token keyword">const</span> big <span class="token operator">=</span> <span class="token number">100_100_000_000</span><span class="token punctuation">;</span>	<span class="token comment">//相当于 100，100，100，100</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="symbol"><a href="#symbol" class="header-anchor">#</a> Symbol</h3> <p><font color="orange"><strong>ES6新加的一种基本数据类型</strong></font></p> <ul><li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">firends</span><span class="token operator">:</span> <span class="token string">'mary'</span>
<span class="token punctuation">}</span>
consolo<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;name&quot;  ,  &quot;friends&quot;</span>
<span class="token comment">//ES6之前对象内的属性的key都是字符串表示，如果新加了想表示不同意义的同名key（属性）会出现冲突覆盖</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p><font color="orange">通过<code>Symbol</code>可以生成一个独一无二的值</font></p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//ES6后，对象的key可以是字符串或Symbol</span>
<span class="token comment">//每一个Symbol都是唯一的，且创造时可以传入一个描述</span>
<span class="token keyword">const</span> s <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'一个Symbol对象'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>description<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//用Symbol作为key</span>
<span class="token comment">//1.</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>s1<span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'abc'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>s2<span class="token punctuation">]</span><span class="token operator">:</span><span class="token string">'bca'</span>
<span class="token punctuation">}</span>
<span class="token comment">//2.</span>
obj<span class="token punctuation">[</span>s3<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'11'</span>
<span class="token comment">//3.</span>
<span class="token keyword">const</span> ss <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> ss<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p><font color="orange">不能通过.语法获取Symbol值</font></p></li> <li><p>使用<code>Object.keys</code>无法获取<code>Symbol</code>的属性</p></li> <li><p>想获取对象的Synbol</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertSymbols</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> s <span class="token keyword">of</span> keys<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>实现两个Symbol相等</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//Symbol.for(key)</span>
<span class="token keyword">const</span> sa <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> sb <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">for</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>
sa <span class="token operator">===</span> ab <span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>获取Symbol的key</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> sb <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token string">'aaa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> skey <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">keyFor</span><span class="token punctuation">(</span>sb<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sc <span class="token operator">=</span> Symbol<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>skey<span class="token punctuation">)</span><span class="token punctuation">;</span>
sb <span class="token operator">===</span> sc <span class="token punctuation">;</span> <span class="token comment">//true </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h3 id="set的基本使用"><a href="#set的基本使用" class="header-anchor">#</a> Set的基本使用</h3> <p><font color="orange">ES6之前存储数据的结构主要有两种：数组、对象，ES6新加了 <code>Set</code>和<code>Map</code>，以及它们的另外两种形式：WeakSet、WeakMap</font></p> <ul><li><p>Set是一个新增的数据结构，<strong>可以用来保存数据，类似于数组，但是和数组的区别是元素不能重复。</strong></p></li> <li><p>目前只能通过<code>Set</code>函数创建Set</p></li> <li><p><code>set</code>可以给数组去重</p></li> <li><p><code>set</code>对对象的引用是强引用</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//添加</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//不能重复，只有一个10</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//可以存储两个空对象，因为它们的内存地址不同</span>
<span class="token comment">//删除</span>
set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//只能传入元素</span>
<span class="token comment">//set的大小</span>
set<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//判断是否包含</span>
set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment">//清除</span>
set<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//遍历</span>
set<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> s <span class="token keyword">of</span> set<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><p>WeakSet和set的区别</p> <ul><li><font color="orange">只能存储对象，不能存储基本数据类型</font></li> <li><font color="orange">其对对象的引用是弱引用，即一个对象只有被WeakSet引用，那么GC回收器在侦测到这个对象会对其进行回收</font></li> <li>WeakSet是不能遍历</li></ul></li></ul> <h3 id="map的基本使用"><a href="#map的基本使用" class="header-anchor">#</a> Map的基本使用</h3> <ul><li><p>Map数据结构用来存储映射关系</p></li> <li><p><font color="orange">Map结构的<code>key</code>可以是对象，与普通对象的区别之一，key值唯一</font></p></li> <li><p>JavaScript不允许使用对象类型作为<code>key</code></p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//可以传入一个数组创建，对数组元素类型有要求</span>
<span class="token comment">//设置</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">,</span> '<span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取大小</span>
map<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//获取值</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
<span class="token comment">//判断是否存在</span>
map<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
<span class="token comment">//删除</span>
map<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">)</span>
<span class="token comment">//清空</span>
map<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//可遍历 forEach ;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token keyword">of</span> map<span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ul> <h4 id="weakmap"><a href="#weakmap" class="header-anchor">#</a> WeakMap</h4> <ul><li><p>其key只能是对象类型</p></li> <li><p>对对象的引用是弱引用</p></li> <li><p>没有size方法</p></li> <li><p>WeakMap也无法遍历，直接打印是 item unknow</p></li> <li><p>应用场景 vue3响应式原理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//当obj的name属性发生变化时，触发foo和bar方法,age变化触发foo1, bar1</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'mike'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">[</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token punctuation">[</span>foo1<span class="token punctuation">,</span> bar1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> weakMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
weakMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>     
<span class="token comment">//map存储监听的对象的属性以及它们的依赖</span>
<span class="token comment">//weakMap存储监听的对象和map的映射</span>

<span class="token comment">//如果name发生了改变</span>
<span class="token comment">//Proxy /Object.defineProperty监听变化</span>

obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'new'</span>
<span class="token keyword">const</span> targetMap <span class="token operator">=</span> weakMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'obj'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> targetMethods <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//获取改变的属性对应的依赖</span>
targetMethods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><font color="orange">之所以用weakMap记录是因为如果当对象被销毁时，如果是weakMap的话这个其所占的内存空间会被回收，不会由于Map的强引用导致无法回收</font></p></li></ul> <h2 id="es-2"><a href="#es-2" class="header-anchor">#</a> ES+</h2> <h3 id="es7"><a href="#es7" class="header-anchor">#</a> ES7</h3> <h4 id="array-includes"><a href="#array-includes" class="header-anchor">#</a> Array.includes</h4> <ul><li>返回值变成布尔，可以判断是否存在NaN</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
list<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//如果返回-1说明不包含，如果包含返回对应索引</span>

list<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//返回布尔，第二个参数声名从那个索引开始</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="指数运算"><a href="#指数运算" class="header-anchor">#</a> 指数运算</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//3的2次方</span>

<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token number">3</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">;</span>			   <span class="token comment">//3的2次方</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="es8"><a href="#es8" class="header-anchor">#</a> ES8</h3> <h4 id="object-values"><a href="#object-values" class="header-anchor">#</a> Object.values</h4> <ul><li>之前可以通过Objects.keys()获取一个对象所有的key，返回一个数组</li> <li>Object.values可以返回一个对象的所有value</li></ul> <h4 id="object-entries"><a href="#object-entries" class="header-anchor">#</a> Object.entries</h4> <ul><li><p>通过此方法可以获取一个数组，数组中会存放可枚举属性的键值对数组。</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'mike'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">19</span>
<span class="token punctuation">}</span>
Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// [[name, 'mike'], [age, 18]] </span>
<span class="token comment">//字符串和数组以他们的索引为key</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul> <h4 id="string-padding"><a href="#string-padding" class="header-anchor">#</a> String Padding</h4> <p>​		某些字符串我们需要对其进行前后的填充，来实现某种格式化效果，ES8中增加了padStart 和padEnd方法，分别是对字符串的首尾进行填充的。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token string">'hello world'</span><span class="token punctuation">;</span>
message<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padEnd</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//返回新字符串。第一个参数为字符串长度，第二个参数为填充的内容</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="async-和-promise"><a href="#async-和-promise" class="header-anchor">#</a> async 和 Promise</h4> <h4 id="getownpropertydesciptors-获取数据属性描述符"><a href="#getownpropertydesciptors-获取数据属性描述符" class="header-anchor">#</a> getOwnPropertyDesciptors-获取数据属性描述符</h4> <h3 id="es9"><a href="#es9" class="header-anchor">#</a> ES9</h3> <h4 id="iterator迭代器"><a href="#iterator迭代器" class="header-anchor">#</a> iterator迭代器</h4> <h4 id="对象展开运算符"><a href="#对象展开运算符" class="header-anchor">#</a> 对象展开运算符</h4> <h4 id="promise-finally"><a href="#promise-finally" class="header-anchor">#</a> Promise finally</h4> <h3 id="es10"><a href="#es10" class="header-anchor">#</a> ES10</h3> <h4 id="flat-和-flatmap"><a href="#flat-和-flatmap" class="header-anchor">#</a> flat 和 flatMap</h4> <p>​		<code>flat()</code>方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//将nums转为一维数组</span>
<span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> newArr <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//默认一维，参数决定了将几维</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​		<code>flatMap</code>会映射每个元素，将结果压缩返回新数组</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span>  num2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> newArr <span class="token operator">=</span> num2<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> item<span class="token operator">*</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//应用场景</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Hello world'</span><span class="token punctuation">,</span> <span class="token string">&quot;11 33&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> nweArr <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">/*
    	flat会先将数组扁平化 &quot;Hello world&quot;   &quot;11 33&quot;
    	在迭代每个元素
    */</span>
    <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//可以帮我们将多个返回结果压缩成数组</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="object-fromentries"><a href="#object-fromentries" class="header-anchor">#</a> Object fromEntries</h4> <p>将<code>entries</code>格式的转回对象类型</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> entires <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> Object <span class="token function">fromEntries</span><span class="token punctuation">(</span>entires<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="trimstart-trimend"><a href="#trimstart-trimend" class="header-anchor">#</a> trimStart&amp;trimEnd</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token string">'        hello world      '</span>
message<span class="token punctuation">.</span><span class="token function">trimStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//去除头部空格</span>
message<span class="token punctuation">.</span><span class="token function">trimEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//去除尾部空格</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="symbol-description"><a href="#symbol-description" class="header-anchor">#</a> Symbol description</h4> <h3 id="es11"><a href="#es11" class="header-anchor">#</a> ES11</h3> <h4 id="bigint"><a href="#bigint" class="header-anchor">#</a> BigInt</h4> <ul><li><p>早期有时无法正确表示过大</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//ES11之前</span>
<span class="token keyword">const</span> maxInt <span class="token operator">=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">;</span>  <span class="token comment">//最大的安全的int</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//用法：数字后加n</span>
<span class="token keyword">const</span> bigInt <span class="token operator">=</span> <span class="token number">1011212121151515151n</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>  
- &lt;font color=&quot;orange&quot;&gt;不能让`bigInt`直接跟`number`类型相加,`bigInt`不支持隐式转化&lt;/font&gt;

- ```js
  //相互转化
  small = Number(bigInt);
  big = bigInt(small);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="nullish-coalescing-opeartor"><a href="#nullish-coalescing-opeartor" class="header-anchor">#</a> Nullish Coalescing Opeartor</h4> <p><font color="orange">空值合并运算</font> <strong>??</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> foo 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//undefined</span>
<span class="token keyword">const</span> bar <span class="token operator">=</span> foo <span class="token operator">||</span> <span class="token string">'default value'</span><span class="token punctuation">;</span>	<span class="token comment">//默认值,无法识别空字符串、0</span>
<span class="token keyword">const</span> test <span class="token operator">=</span> foo<span class="token operator">??</span><span class="token string">'defalut value'</span><span class="token punctuation">;</span>		<span class="token comment">//只有foo为null和undefined才会引用后面的</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="option-chaining"><a href="#option-chaining" class="header-anchor">#</a> Option Chaining</h4> <p>可选链也是ES11中新增一个特性，主要作用是让我们的代码在进行null和undefined判断时更加清晰和简洁∶</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">firends</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>friends<span class="token punctuation">.</span>firends<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//会报错，因为尝试在undefined上获取属性</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token operator">&amp;&amp;</span>info<span class="token punctuation">.</span>friends<span class="token operator">&amp;&amp;</span>info<span class="token punctuation">.</span>friends<span class="token punctuation">.</span>girlFriend<span class="token punctuation">)</span>
<span class="token comment">//语法糖,更加简洁</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>friends<span class="token operator">?.</span>girlFriend<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//判断后面的是不是undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="global-this"><a href="#global-this" class="header-anchor">#</a> Global This</h4> <ul><li><p>浏览器</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//获取全局对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>node中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//获取全局对象</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>ES11</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//获取全局</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalThis<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h4 id="for-in-标准化"><a href="#for-in-标准化" class="header-anchor">#</a> for in 标准化</h4> <ul><li>以前不同浏览器执行 for in 可能获取key或 value，现在规定返回 key</li></ul> <h3 id="es12-2021"><a href="#es12-2021" class="header-anchor">#</a> ES12   2021</h3> <h4 id="finalizationregister"><a href="#finalizationregister" class="header-anchor">#</a> finalizationRegister</h4> <p>ES12新增的类，支持监听对象的销毁</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> finalRegister <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FinalizationRegistery</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'注册在finalRegister的某个对象被销毁了'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> why<span class="token punctuation">}</span><span class="token punctuation">;</span>
FinalizationRegistery<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>	<span class="token comment">//当GC回收时，触发FinalizationRegistery回调</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="weakref"><a href="#weakref" class="header-anchor">#</a> WeakRef</h4> <p>弱引用</p> <p>weakRef.prototype .deref:</p> <ul><li>如果原对象没有销毁,哪么可以获取到原对象</li> <li>如果原对象已经销毁，那么获取到的是undefined</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> why<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">deref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="logical-assign-operator"><a href="#logical-assign-operator" class="header-anchor">#</a> logical-assign-operator</h4> <p>逻辑赋值运算</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. ||=逻辑或赋值运算</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
message <span class="token operator">=</span> message <span class="token operator">||</span> <span class="token string">'defalut'</span>
message <span class="token operator">||=</span> <span class="token string">'default'</span>		<span class="token comment">//效果等同上一行代码</span>
<span class="token comment">// 2. &amp;&amp;=逻辑与赋值运算</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
obj<span class="token operator">&amp;&amp;</span><span class="token function">foo</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//如果obj存在执行foo函数</span>

info <span class="token operator">&amp;&amp;=</span> info<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token comment">// 3. ??=逻辑空赋值运算</span>
<span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token number">0</span>
message<span class="token operator">??=</span><span class="token string">'defalut'</span><span class="token punctuation">;</span>	<span class="token comment">//如果message为空，设置默认值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="string-replace"><a href="#string-replace" class="header-anchor">#</a> String.replace</h4> <h1 id="响应式"><a href="#响应式" class="header-anchor">#</a> 响应式</h1> <h2 id="proxy-reflect"><a href="#proxy-reflect" class="header-anchor">#</a> Proxy-Reflect</h2> <h3 id="监听对象的操作方法"><a href="#监听对象的操作方法" class="header-anchor">#</a> 监听对象的操作方法</h3> <ol><li><p>利用存储属性描述符</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">19</span><span class="token punctuation">,</span>
    <span class="token literal-property property">get</span><span class="token operator">:</span><span class="token function">fucntion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name被访问了'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name被设置了'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//同时监听多个</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><strong>缺点：</strong></p> <ul><li>首先，Object.defineProperty设计的初衷↓不是为了去监听截止一个对象中未所有的属性的。</li> <li>我们在定义某些属性的时候，初衷其实是定义普通的属性，但是后面我们强行将它变成了数据属性描述符。</li> <li><font color="orange">其次，如果我们想监听更加丰富的操作，比如新增属性、删除属性，那么Object.defineProperty是无能为力的。所以我们要知道，存储数据描述符设计的初衷并不是为了去监听一个完整的对象。</font></li></ul></li> <li><p>利用proxy</p></li></ol> <h3 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h3> <p>在ES6中，<font color="orange">新增了一个Proxy类这个类从名字就可以看出来，是用于帮助我们创建一个代理的∶</font></p> <ul><li>也就是说，如果我们希望监听一个对象的相关操作，那么我们可以先创建一个代理对象Proxy对象;</li> <li>之后对该对象的所有操作，都通过代理对象来完成，代理对象可以监听我们想要对原对象进行哪些操作;</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> objP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//第一个参数为代理对象，第二个为捕获器</span>
objP<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'key'</span><span class="token punctuation">;</span>   <span class="token comment">//如果不重写相当于浅拷贝对象</span>

<span class="token keyword">const</span> newObjProxt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">//获取时捕获器</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>	<span class="token comment">//第一个是代理对象，第二个是key</span>
        <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//设置捕获器</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//监听in捕获器 ，判断obj是否包含某个key</span>
    <span class="token function">has</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> key <span class="token keyword">in</span> target
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//删除</span>
    <span class="token function">deleteProperty</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">delete</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202131455185.png" alt="image-20220213145504714" style="zoom:80%;"> <h3 id="reflect"><a href="#reflect" class="header-anchor">#</a> Reflect</h3> <p><code>Reflect</code>也是ES6新增的一个API，<font color="orange">它是一个对象</font>，字面的意思是反射。<img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202131458019.png" alt="image-20220213145841839"></p> <p>Reflect的方法和Proxy是一一对应的</p> <p><font color="orange"><strong>Reflect和Proxy结合</strong></font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span>
<span class="token punctuation">}</span>
<span class="token comment">//与直接通过原对象修改的区别在于Reflect会返回一个布尔值判断是否设置成功</span>
<span class="token keyword">const</span> objProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">{</span>
        Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="receiver参数的作用"><a href="#receiver参数的作用" class="header-anchor">#</a> Receiver参数的作用</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">_name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">,</span>	<span class="token comment">//属性名加下滑视为私有属性</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">=</span> value
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//当传入receiver时，this对象被改变，让this不再直接指向源对象</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//当调用触发源对象的get方法，其this还是指向源对象不是指向代理对象</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="reflect-constructor"><a href="#reflect-constructor" class="header-anchor">#</a> Reflect.constructor</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//想要实现执行的是Sutdnet的代码，但创建的对象是teacher对象</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Teacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> teacher <span class="token operator">=</span> <span class="token class-name">Reflect</span><span class="token punctuation">.</span><span class="token function">constructor</span><span class="token punctuation">(</span>Studnet<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;WHY&quot;</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Teacher<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>teacher<span class="token punctuation">.</span>__proto <span class="token operator">===</span> teacher<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="响应式-2"><a href="#响应式-2" class="header-anchor">#</a> 响应式</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Depend</span> <span class="token punctuation">{</span>		<span class="token comment">//收集依赖</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reactivesFns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">addDepend</span><span class="token punctuation">(</span><span class="token parameter">reactiveFn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>			<span class="token comment">//添加依赖</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reactivesFns<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>reactiveFn<span class="token punctuation">)</span><span class="token punctuation">;</span>	
    <span class="token punctuation">}</span>
	<span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>					 <span class="token comment">//遍历数组触发依赖</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>reactivesFns<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>		
            <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">watchFn</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    dep<span class="token punctuation">.</span><span class="token function">addDepend</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//自动监听执行</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'why'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span>
<span class="token punctuation">}</span>
<span class="token comment">//这种写法没有实现一个depend对应一个属性，会导致一个属性改变触发全部依赖</span>
<span class="token keyword">const</span> objProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dep<span class="token punctuation">.</span><span class="token function">addDepend</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 依赖管理， 即不同对象不同属性对应各自的dep对象</span>
<span class="token comment">//vue3 实现响应式  proxy+reflect+map+weakmap</span>
<span class="token comment">/*
	1.用map存储一个对象的不同属性和依赖的映射关系
	2.用weakMap存储不同对象和map的映射关系
*/</span>
<span class="token comment">//先创建一个weakMap用于存储存储不同响应式对象和 其存储属性和依赖映射关系的mao</span>
<span class="token keyword">const</span> targetMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//封装获取依赖对象函数</span>
<span class="token keyword">function</span> <span class="token function">getDepend</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> map <span class="token operator">=</span> targetMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">)</span><span class="token punctuation">{</span>						  <span class="token comment">//如果不存在先创建对象的map</span>
        map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        targetMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//target为对象</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> depend <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>depend<span class="token punctuation">)</span><span class="token punctuation">{</span>
        depend <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Depend</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        depend<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token keyword">function</span> <span class="token function">Reactive</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202131650583.png" alt="image-20220213165005385" style="zoom:80%;"> <h1 id="异步方案"><a href="#异步方案" class="header-anchor">#</a> 异步方案</h1> <h2 id="promise"><a href="#promise" class="header-anchor">#</a> Promise</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeOut</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span>  <span class="token string">'error'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//这种无法获取结果，因为setTimeOut是异步函数</span>
<span class="token comment">//之前的解决方法是额外传入成功和失败的回调函数作为参数</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">data success<span class="token punctuation">,</span> fail</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 	data <span class="token operator">==</span> <span class="token boolean">true</span><span class="token operator">?</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><font color="orange">Promise函数返回了一个承诺，规范了更好的代码编写逻辑，当我们想执行一个异步函数时，我们无法立即拿到执行结果，我们就可以将这个函数改成Promise函数</font></p> <ul><li><font color="orange"><strong>Promise是一个类</strong></font>，可以翻译成承诺、许诺、期约;</li> <li>当我们需要给予调用者一个承诺︰待会儿我会给你回调数据时，就可以创建一个Promise的对象;</li> <li>在通过new创建Promise对象时，我们需要传入一个回调函数，我们称之为<code>executor</code>执行者
<ul><li>这个回调函数会被立即执行，并且给传入另外两个回调函数<code>resolve、reject</code></li> <li>当我们调用resolve回调函数时，会执行Promise对象的then方法传入的回调函数;</li> <li>当我们调用reject回调函数时，会执行Promise对象的catch方法传入的回调函数;</li></ul></li> <li>Promise帮我们规范了异步回调的一种规范</li> <li>resolve参数会作为成功回调的参数，<code>reject</code>的参数会作为失败回调的参数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//Promise的第一个参数为一个函数，会立即执行,此函数默认具备resolve和reject两个函数作为参数</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>	
    <span class="token keyword">if</span><span class="token punctuation">(</span>succcess<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//别人拿到一个Promise对象后，可以通过 .then拿到成功回调</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//通过 .catch拿到失败回调</span>
promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//实际上 .then可以传递两个参数，第一个是成功回调，第二个是失败回调</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'成功回调'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'失败回调'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="promise的三个状态"><a href="#promise的三个状态" class="header-anchor">#</a> Promise的三个状态</h3> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202132112193.png" alt="image-20220213211209044" style="zoom:67%;"> <ul><li>Promise的状态一旦确定就无法再次改变</li></ul> <h3 id="resolve的参数"><a href="#resolve的参数" class="header-anchor">#</a> resolve的参数</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//如果给resolve函数的参数是一个Promise，则Promise的状态交给这个参数决定</span>
<span class="token keyword">const</span> newPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'新'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>newPromise<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//then执行结果由 newPromise决定</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//如过给resovle传入一个对象，这个对象有then方法且实现了方法，这个方法会自动执行且决定了后续状态</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="then方法"><a href="#then方法" class="header-anchor">#</a> then方法</h3> <ul><li><p>then方法是Promise对象上的一个方法：它其实是放在Promise的原型上</p></li> <li><p>同一个Promise可以被多次调用<code>then</code>方法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token function">res</span><span class="token punctuation">(</span><span class="token string">'sunccess'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//重复调用一个promise的then方法</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//1 success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//2 success</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p><code>then</code>方法传入的回调函数可以有返回值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'aaa'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//aaa;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/*
	1.之所以在then后面再次调用then是因为如果我们在上一个then返回了一个普通对象， promise内部会创建一个新的promise，以这个对象为新的promise的resolve的参数, 从而实现了链式调用；如果没有给then写返回值，则以undefined为参数
*/</span>
<span class="token comment">/*
	2.如果then返回一个Promise，下一个then的结果由返回的promise决定
*/</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">/*
	3.如果返回了一个实现then的对象，那么下一个then的结果由这个then决定
*/</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'11'</span>
        <span class="token function-variable function">then</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li> <li><p>then具体执行哪个回调由Promise的返回状态决定</p></li></ul> <h3 id="catch"><a href="#catch" class="header-anchor">#</a> catch</h3> <p>​		当Promise的executor抛出异常时，也是调用<code>then</code>的错误回调</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//会执行这段代码</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//为了方便看，可以用catch代替then的错误回调，一种语法糖，不符合promise的 a+规范</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>			<span class="token comment">//catch优先捕获最先的异常捕获</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>	
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//这样写如果then接收到异常在node会报错，可以加个.catch处理</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><p>同一个promise的catch方法可以多次调用，像then一样</p></li> <li><p>catch方法的返回值</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//catch方法返回值也如同then一样返回一个promise</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h3 id="finally"><a href="#finally" class="header-anchor">#</a> finally</h3> <p>ES9新增的特性，不接收参数，其不管执行结果成功与否都会执行,如果有返回值也是返回一个promise</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'一定会执行'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//可以用来清除</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="promise的类方法"><a href="#promise的类方法" class="header-anchor">#</a> promise的类方法</h3> <ul><li><code>promise.resolve(obj)</code></li> <li><code>promise.reject(obj)</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//通过promise的类方法将一个普通对象转为promise</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//相当于</span>
<span class="token keyword">const</span> newP <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//也是可以传入一个promsie或者一个实现then方法的对象</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>promise.all</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//当所有promsie状态确认时，才一次性处理结果，如果不是promise对象会装成promise，以这个对象作为resolve的参数</span>
<span class="token comment">//但如果其中一个出现了reject，不管其他执行结果如何，都执行catch</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>promise.allSettled</strong></p> <ul><li>同.all差不多，但它返回的是一个数组，记录promise执行的结果</li> <li><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202132243593.png" alt="image-20220213224345422"></li></ul> <p><strong>promise.race</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//以最先确认状态的promise状态为标准，不管其他的promsie且不管执行结果是成功或失败</span>
Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Promise.any</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//会等到至少有一个执行resolve才结束，如果全都拒绝，c</span>
Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h1 id="async和await"><a href="#async和await" class="header-anchor">#</a> async和await</h1> <p>ES8新出了async 和 await关键字</p> <ul><li><p><font color="orange"><code>async</code>关键字用于声名异步函数</font></p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//用法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>异步函数执行</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//异步函数内不特殊处理其执行顺序如同普通函数</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p><code>async</code>与普通函数的区别</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	1.async函数的返回值一定是一个promise，如果想获取这个promise的then方法接收的回调
		-如果没有返回值 resolve(undefined)
		-返回一个promise
		-返回一个实现then方法的对象
		-
	2.异步函数内的异常会作为promise的reject处理,因此异步函数出错其他函数仍可以运行
	3.async 函数内部可以使用 await关键字 后面一般跟着 promise 也可以是普通值,如果是普通值，相当于调用promise的resolve
*/</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
foo<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>		<span class="token comment">//异常捕获</span>

<span class="token keyword">function</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">res</span><span class="token punctuation">(</span><span class="token string">'111'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">requestData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//await 的返回值是promise处理的结果</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//在await没有拿到结果时，这行代码都不会执行</span>
<span class="token punctuation">}</span>


<span class="token comment">//如果await 的promise返回一个rejected，那么他会将整个异步函数当作promsie返回对象的值</span>
<span class="token keyword">async</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">rejected</span><span class="token punctuation">(</span><span class="token string">'11'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
foo<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div></li></ul> <h1 id="浏览器中的javascript进程"><a href="#浏览器中的javascript进程" class="header-anchor">#</a> 浏览器中的JavaScript进程</h1> <p>JavaScript是单线程的，即只有一个主线程。<font color="orange">JavaScript的进程容器是浏览器或Node</font></p> <h2 id="浏览器的进程"><a href="#浏览器的进程" class="header-anchor">#</a> 浏览器的进程</h2> <p>多数浏览器是多进程的，为了防止因为一个页面卡死导致全部页面都未响应，因此每打开一个<code>tab</code>标签页，就开启一个进程。</p> <ul><li>JavaScript的代码执行是在一个单独的线程中执行的:
<ul><li>这就意味着JavaScript的代码，在同一个时刻只能做一件事;</li> <li>如果这件事是非常耗时的，就意味着当前的线程就会被阻塞;</li></ul></li> <li>所以真正耗时的操作，实际上并不是由JavaScript线程在执行的:
<ul><li>浏览器的每个进程是多线程的，那么其他线程可以来完成这个耗时的操作;</li> <li>比如<font color="orange">网络请求、定时器</font>，我们只需要在特性的时候执行应该有的回调即可;</li></ul></li></ul> <h1 id="事件循环-队列"><a href="#事件循环-队列" class="header-anchor">#</a> 事件循环-队列</h1> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;script start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">/*
    setTimeout本身是立即执行的，其传入其中的回调函数才是异步函数
    setTimeout的执行不是由JavaScript的主线程执行的，而是浏览器的其他进程的线程执行的，当等待相应的时间后，将回调函数放入事件队列 
	*/</span>    
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;script end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>事件循环：就是JavaScript代码在执行过程中，遇到的一些较为耗时的操作（如定时器、DOM监听、网络请求），是不会交由JavaScript线程去执行的，而是交由浏览器的其他进程的线程去执行，执行结束再将相应回调放入事件队列中，js调用栈再从事件队列拿取回调放入调用栈内执行。这个过程叫事件循环</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202142125244.png" alt="image-20220214212529088" style="zoom:80%;"> <h2 id="宏任务和微任务"><a href="#宏任务和微任务" class="header-anchor">#</a> 宏任务和微任务</h2> <p>事件队列分为宏任务队列和微任务队列</p> <ul><li><p>macrotask queue：宏任务队列</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ajax、setTimeout、setInterval、DOM监听、UI Rendering
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>microtask queue：微任务队列</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>queueMicrotask 、Promise then回调、queueMicrotask、Mutation Observer API等
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>规范：<font color="orange">在执行任何宏任务之前，必须保证微任务队列已经清空</font></p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="事件队列"><a href="#事件队列" class="header-anchor">#</a> 事件队列</h2> <p>一个async函数的执行，如果其内部没有声名<code>await</code>，是跟<code>main script</code>一样执行，如果其内部声名了<code>await</code>，<code>await</code>后的<code>executor</code>的会立即执行返回一个<code>then</code>，因此<code>await</code>后的代码都会加入微任务队列</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//之所以会推迟加入微任务是因为防止异步任务过于耗时影响后续代码</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token comment">// 1. return 4</span>
    <span class="token comment">// 2. 返回thenable	   可以视为需要执行两次 return 4</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">then</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 3.返回 一个promise	 可视为执行3次return</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="node的事件循环"><a href="#node的事件循环" class="header-anchor">#</a> Node的事件循环</h2> <p>当我们在控制台通过node 命令执行一个js文件时，node的操作如下</p> <ol><li>开启一个node进程</li> <li>node进程是多线程的</li> <li>node会分配一个线程来执行<code>js</code>代码</li> <li>一些耗时操作会由其他线程执行（如文件操作、网络请求）</li> <li><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202142217918.png" alt="image-20220214221729751"></li> <li><code>Application</code>(JavaScript代码、koa、express)应用通过V8引擎运行，V8引擎通过NODE封装的一些API将一些异步操作交给libuv库（C语言编写）进行处理，libuv将这些请求分配给线程池，线程处理完将回调放入事件队列。</li> <li>node异步操作更多是文件操作</li> <li>NODE一次完整的事件循环Tick分为很多阶段
<ul><li>定时器(Timers)：本阶段执行已经被setTimeout()和setInterval()的调度回调函数。</li> <li>待定回调(Pending Callback)：对某些系统操作（如TCP错误类型）执行回调，比如TCP连接时接收到ECONNREFUSED。</li> <li><code>idle, prepare</code>：仅系统内部使用。</li> <li>轮询( Poll )：检索新的IO事件;执行与I/O相关的回调;    node大部分阻塞在这个阶段</li> <li>检测( check ) : <code>setImmediate()</code>回调函数在这里执行。</li> <li>关闭的回调函数：一些关闭的回调函数，如: <code>socket.on('close'，...)</code></li></ul></li> <li><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202142233916.png" alt="image-20220214223317768" style="zoom:80%;"></li></ol> <h1 id="javascript错误处理方案"><a href="#javascript错误处理方案" class="header-anchor">#</a> JavaScript错误处理方案</h1> <h2 id="函数错误处理"><a href="#函数错误处理" class="header-anchor">#</a> 函数错误处理</h2> <ul><li><code>throw</code>关键字 ：如果函数已经抛出异常，后续代码不会继续执行，<code>promise</code>除外</li> <li><code>Error</code>类</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> sum <span class="token operator">!==</span><span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token string">'error'</span><span class="token punctuation">;</span>		<span class="token comment">//throw会让程序终止</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//直接使用Error类</span>
<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'错误信息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//可以给出更多错误信息，如函数调用栈</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="抛出异常处理"><a href="#抛出异常处理" class="header-anchor">#</a> 抛出异常处理</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	当函数内部抛出错误时，有两种处理方法
	1.不处理，抛出的错误会沿着调用栈一层一层抛出，如果每一层都没处理，错误最终会抛到顶层终止
	2.try catch处理
	3.finaylly 不管成不成功，都处理
*/</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//如果try内出现错误，会被catch捕获，不会终止</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>		
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//处理错误</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h1 id="javascript模块化"><a href="#javascript模块化" class="header-anchor">#</a> JavaScript模块化</h1> <h2 id="什么是模块化"><a href="#什么是模块化" class="header-anchor">#</a> 什么是模块化</h2> <ul><li>事实上模块化开发最终的目的是<font color="orange">将程序划分成一个个小的结构</font>（模块）﹔</li> <li>这个结构中编写<font color="orange">属于自己的逻辑代码，有自己的作用域</font>，不会影响到其他的结构</li> <li>这个结构可以将自己希望暴露的<font color="orange">变量、函数、对象等导出</font>给其结构使用;</li> <li>也可以通过某种方式，如<font color="orange">导入另外结构中的变量、函数、对象</font>等;</li></ul> <h2 id="为什么需要模块化"><a href="#为什么需要模块化" class="header-anchor">#</a> 为什么需要模块化</h2> <ul><li>ajax的出现，<font color="orange">前后端开发分离</font>，意味着后端返回数据后，我们需要通过JavaScript进行前端页面的渲染;</li> <li>SPA的出现，前端页面变得更加复杂∶包括前端路由、状态管理等等一系列复杂的需求需要通过JavaScript来实现;</li> <li>包括Node的实现，JavaScript编写复杂的后端程序，没有模块化是致命的硬伤;</li></ul> <h2 id="模块化规范"><a href="#模块化规范" class="header-anchor">#</a> 模块化规范</h2> <p>JavaScript在ES6才推出自己的模块化方案</p> <ul><li>AMD-少用</li> <li>CMD-少用</li> <li><font color="orange">CommomJS</font></li> <li><font color="orange">ES Module模块化方案 - 未来发展趋势</font></li></ul> <h2 id="js模块化"><a href="#js模块化" class="header-anchor">#</a> JS模块化</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	早期在网页的处理方案
	1.很容易造成变量冲突
	2.不方便开发，需要得知变量名
	3.需要适应不同规范
*/</span>
<span class="token comment">//why.js</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>moduleA<span class="token punctuation">.</span>isFlag<span class="token punctuation">)</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
   <span class="token punctuation">}</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//index.js</span>
<span class="token keyword">var</span> moduleA <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">flag</span><span class="token operator">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="commonjs和node"><a href="#commonjs和node" class="header-anchor">#</a> CommonJS和NODE</h2> <ul><li><p>NODE是CommonJS在服务器端一个具有代表性的实现</p></li> <li><p><code>webpack</code>打包工具具备对CommonJS的支持和转换  webpack可以将 ES Module打包成浏览器支持的模块代码</p></li> <li><p>在Node中每一个js文件都是一个单独的模块</p></li> <li><p>这个模块中包括<font color="orange">CommonJS规范的核心变量</font>：<code>exports、module.exports、require</code></p></li> <li><p>我们可以使用这些变量来方便的进行模块化开发;</p></li></ul> <p><strong>CommonJS</strong></p> <p><font color="orange">最终导出的是<code>module.exports</code>，<code>exports</code>只是对<code>module.exports</code>的引用</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//基本使用</span>
<span class="token comment">//why.js</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'why'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token string">'19'</span>
<span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*
	两种导出方案
	1.module.exports
		-module是当前所处文件具备的默认对象
	2.exports
	
	//源码实现
	module.exports = {}
	exports = module.exports
	是无法通过如下方法导出对象的
	exports = {}	这会让exports脱离module.exports
*/</span>
<span class="token comment">//1.</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    age
<span class="token punctuation">}</span>
<span class="token comment">//2. 这种方式很少使用</span>
exports<span class="token punctuation">.</span>name <span class="token operator">=</span> name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//文件导入</span>
<span class="token comment">//index.js</span>
<span class="token keyword">const</span> why <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./why.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//可以解构</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./why.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
consolo<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>why<span class="token punctuation">.</span>name<span class="token punctuation">,</span> why<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//工作原理</span>
<span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/*
    	id传文件的路径和名称，从对应文件返回其module上的exports对象，地址空间的引用，它们指向的是同一个对象
    	因此，如果已经导入了一个module，源文件的内容改了之后会影响引用文件
    */</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>require规则</strong></p> <p>​		<font color="orange"><code>require</code>本质上是一个函数，可以帮助我们引用对应文件的<code>module.exports</code>对象</font></p> <ul><li><p>查找规则</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	require(x)
	1.x为核心模块
	2. 以目录路径开头
	3.不是路径或核心模块
*/</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//返回node的核心模块</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				   <span class="token comment">//相对路径</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'/d'</span><span class="token punctuation">)</span>					  <span class="token comment">//根路径</span>

<span class="token comment">/* 
	如果没有加 文件后缀名 按如下顺序 .js、.json、.node 如果没有相应文件 将X当作目录，否则报错
*/</span>

<span class="token comment">//如果获取一个npm包的核心模块,会从node_modules找，没有就依次往上找node_modules, 如果找到一般自动找所在node_modules文件的index.js文件</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <p><font color="orange"><strong>模块的加载细节</strong></font></p> <ul><li><p><font color="orange">导入一个模块，该模块文件的代码会在require导入时运行一遍</font></p></li> <li><p>如果一个模块重复加载会被缓存，其内部代码也只运行一次（因为node将每一个js文件对应一个module实例，当其已经被加载时，其内置属性<code>loaded</code>会置为<code>true</code>表示已经加载）</p></li> <li><p>如果循环引用的加载顺序</p> <p>这种加载顺序可以用数据结构图来表示</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	其文件引用会按require顺序执行，会将aa内部代码执行后才执行bb，如果aa内部引用了多个其他module，会继续按顺序引用执行，如果有重复依赖会跳过,直到没有引用才返回。实际上就是图的深度优先搜索
*/</span>
<span class="token comment">/*
	aaa
	ccc
	ddd
	eee
	bbb
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><font color="orange">模块是运行时才加载</font></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202142358256.png" alt="image-20220214235810112" style="zoom:80%;"></li></ul> <p><strong>Common JS的缺点</strong></p> <ul><li>CommonJS加载模块是同步的:
<ul><li><font color="orange">同步的意味着只有等到对应的模块加载完毕，当前模块中的内容才能被运行﹔</font></li> <li><font color="orange">这个在服务器不会有什么问题，因为服务器加载的js文件都是本地文件，加载速度非常快;</font></li> <li>如果文件在不同的网络服务器，需要从网络下载，会降低文件加载速度</li></ul></li> <li>Common JS的模块加载方式方式不适用于浏览器端</li> <li>webpack配置虽然本身使用 Commom JS，但最终还是会打包成浏览器支持的方式</li></ul> <h2 id="amd"><a href="#amd" class="header-anchor">#</a> AMD</h2> <p><font color="orange">浏览器的一种异步模块化规范方案，较少使用</font></p> <p>使用AMD实现库 <code>request.js</code></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!--&gt;
	下载引入require.js
	data-main 的作用是在加载完src文件后会加载执行该文件
&lt;--&gt;</span>
script src=&quot;./lib/require.js&quot; data-main=&quot;./index.js&quot;&gt;&lt;/script
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// src/main.js</span>
require<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">baseUrl</span><span class="token operator">:</span><span class="token string">'./src'</span><span class="token punctuation">,</span>		<span class="token comment">// ./src是默认值基本路径</span>
    <span class="token literal-property property">paths</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">foo</span><span class="token operator">:</span><span class="token string">&quot;./foo&quot;</span>			<span class="token comment">//相对路径是基于index.html,</span>
        <span class="token literal-property property">bar</span><span class="token operator">:</span><span class="token string">&quot;./bar&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">foo</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//届时，foo模块导出的内容可以通过回调函数的参数foo获取</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//foo.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'why'</span>
    <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h2> <p>一种应用于浏览器的模块化规范，采用异步加载模块</p> <p>使用seajs实现</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./lib/sea.js<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./lib/sea.js<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	seajs<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;./index.js&quot;</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//main.js</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//</span>
    exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'11'</span><span class="token punctuation">;</span>	<span class="token comment">//导出方式1</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>		<span class="token comment">//导出方式2</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="es-module"><a href="#es-module" class="header-anchor">#</a> <font color="orange">ES Module</font></h2> <h3 id="与commonjs的区别"><a href="#与commonjs的区别" class="header-anchor">#</a> 与CommonJS的区别</h3> <ul><li>使用了<code>exports</code>和<code>import</code>关键字</li> <li>采用了编译期的静态分析，也加入了动态引用方式</li> <li>ES Module 自动使用 <code>use strict</code> 模式</li></ul> <h3 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h3> <ol><li><p>script type=&quot;module&quot; src=&quot;./index.js&quot;&gt;</p></li> <li><p><font color="orange">不支持本地<code>file</code>协议加载，会遇到CORS错误，需要开启本地服务通过http请求加载</font></p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	不能直接通过script标签执行 使用了 exports和module模块化的js文件，需要给script标签加上 type =“module&quot;
	&lt;script type=&quot;module&quot; src=&quot;./index.js&quot;&gt;&lt;/script&gt;
	浏览器直接打开一个使用了ES Module 的html是无法执行的，因为本地直接打开使用本地加载， ES module不支持file协议 ，而
	需要开启一个本地服务器通过http加载
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="导出方式"><a href="#导出方式" class="header-anchor">#</a> 导出方式</h3> <ol><li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'why'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>导出和声名分开</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'11'</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">/*
	这是固定语法，不是对象,即不能 写键值对
*/</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    foo
<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> foo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>其别名</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span>
    name <span class="token keyword">as</span> newName<span class="token punctuation">,</span>
    foo <span class="token keyword">as</span> newFoo
<span class="token punctuation">}</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>newName<span class="token punctuation">,</span> newFoo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h3 id="导入方式"><a href="#导入方式" class="header-anchor">#</a> 导入方式</h3> <ol><li>普通导入</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><p>其别的名字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>name <span class="token keyword">as</span> fnmae<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>全部放到一个标识符</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> foo <span class="token keyword">from</span> <span class="token string">''</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>name<span class="token punctuation">,</span> foo<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ol> <h3 id="结合使用"><a href="#结合使用" class="header-anchor">#</a> 结合使用</h3> <ol><li><p>导出方式1</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//统一导入导出</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
<span class="token keyword">export</span><span class="token punctuation">{</span>
    foo<span class="token punctuation">,</span>
    bar
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>导出方式2</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token punctuation">{</span>foo<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>bar<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>导出方式3</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">''</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h3 id="默认导入导出"><a href="#默认导入导出" class="header-anchor">#</a> 默认导入导出</h3> <p><font color="orange">默认导出只能有一个</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> foo <span class="token operator">=</span> <span class="token string">'1'</span>
<span class="token keyword">const</span> bar <span class="token operator">=</span> <span class="token string">'2'</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
	foo <span class="token keyword">as</span> <span class="token keyword">default</span>		<span class="token comment">//方式1</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> foo 		<span class="token comment">//方式2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><font color="orange">导入默认内容，命名可以自定义</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> why <span class="token keyword">from</span> <span class="token string">'./index.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="import函数"><a href="#import函数" class="header-anchor">#</a> import函数</h3> <h4 id="import同步加载"><a href="#import同步加载" class="header-anchor">#</a> import同步加载</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//同步解析，在foo执行玩之前name都不会打印</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> age<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">''</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="import异步加载"><a href="#import异步加载" class="header-anchor">#</a> import异步加载</h4> <p><font color="orange">可以将import当作函数，参数为模块路径，返回一个promise对象，通过then方法获取内容，实现异步加载</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./foo.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="es11新增特性"><a href="#es11新增特性" class="header-anchor">#</a> ES11新增特性</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//获取到一个url是文件所在下载路径</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="es-module解析流程"><a href="#es-module解析流程" class="header-anchor">#</a> ES Module解析流程</h3> <p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202151612574.png" alt="image-20220215161202420"></p> <p><font color="red"><strong>静态分析，动态运行</strong></font></p> <ul><li><p>ES Module是基于静态分析不能根据代码判断具体引入哪个文件</p></li> <li><p>模块记录是一种数据结构。必须实例化才可以使用</p></li> <li><p>将js文件解析成模块记录后进行实例化，分析模块引入了什么其他模块并抓取下载</p></li> <li><p><font color="orange">模块下载有一个map来记录映射已经下载了哪些模块防止重复下载</font></p></li> <li><p><font color="orange">第二个模块记录实例化会生成一个模块环境记录对象，会绑定记录模块导出的变量即分配空间为undefined，再实例对象运行是才赋值；模块导入也是如此</font></p></li> <li><p><font color="orange">不允许修改导入变量的值</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./index.js'</span>
name <span class="token operator">=</span> <span class="token string">'1'</span>		<span class="token comment">//执行会报错</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'1'</span>	<span class="token comment">//可以执行</span>
<span class="token keyword">export</span><span class="token punctuation">{</span>
	name
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202151627303.png" alt="image-20220215162732179"></p></li></ul> <h2 id="es-module-和-common-js相互调用"><a href="#es-module-和-common-js相互调用" class="header-anchor">#</a> ES Module 和 Common JS相互调用</h2> <h3 id="浏览器"><a href="#浏览器" class="header-anchor">#</a> 浏览器</h3> <p>在浏览器不能，因为浏览器不支持Common JS</p> <h3 id="node环境"><a href="#node环境" class="header-anchor">#</a> NODE环境</h3> <p>区分具体NODE版本</p> <h3 id="webpack下"><a href="#webpack下" class="header-anchor">#</a> webpack下</h3> <p>可以相互调用</p> <div class="language-powershell line-numbers-mode"><pre class="language-powershell"><code>npm init <span class="token operator">-</span>y					<span class="token comment">#生成package.json文件</span>
npm i webpack wepack-<span class="token function">cli</span>	 <span class="token comment">#webpack4.x之后需要同时下载cli</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//index.js				//es 导入</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./foo'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//foo.js		common js导出</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">const</span> age <span class="token operator">=</span><span class="token number">19</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    age
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//index.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./foo.js'</span><span class="token punctuation">)</span>	<span class="token comment">//common js导入</span>

<span class="token comment">//foo.js</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">''</span>			<span class="token comment">//ES MODULE 导出</span>
<span class="token keyword">const</span> age <span class="token operator">=</span><span class="token number">19</span>
<span class="token keyword">export</span><span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>
    age
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><hr> <h1 id="other"><a href="#other" class="header-anchor">#</a> other</h1> <h2 id="作用域提升"><a href="#作用域提升" class="header-anchor">#</a> 作用域提升</h2> <p>​		当浏览内核将JavaScript代码交给引擎时，引擎会创建一个对象（GO），对象包含各种变量的定义、window，函数等。</p> <p>​		当变量被引用输出时，如果在此行代码执行之前，该变量就已经被声名赋值，则可以成功引用，否则结果为undefined<font color="orange">（因为早在浏览器将代码交给引擎时，变量就已经被声名在GO中，只是值为undefined）</font>。全局代码执行时，是从VO里面取值，而VO又指向GO。</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141821630.png" alt="image-20220114182144565" style="zoom:80%;"> <h2 id="数组"><a href="#数组" class="header-anchor">#</a> 数组</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> newList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>	<span class="token comment">//要求返回布尔值</span>
	<span class="token comment">//如果返回值为true的元素会形成新数组并返回</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// forEach 枚举，没有返回值</span>
<span class="token comment">//find  findIndex原理与find相同，当返回的是序列值</span>
<span class="token keyword">var</span> target <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> item <span class="token operator">==</span> <span class="token string">'a'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//nums.reduce	用于累加,接收两个参数，第一个参数为函数（包含两个函数，前一个返回值和当前的item），第二个参数是初始的preValue值</span>
<span class="token keyword">var</span> total <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">preValue<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> preValue<span class="token operator">+</span>item
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>	
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><font color="orange">对于<code>forEach</code>可以传入第二个参数指定this，否则指向window</font></p> <h3 id="call、apply和bind区别"><a href="#call、apply和bind区别" class="header-anchor">#</a> call、apply和bind区别</h3> <p><font color="orange">实现的功能相同，传参方法不同，可以明确指定<code>this</code>指向</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> num3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> argument<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> item</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> pre<span class="token operator">+</span>item
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'call'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span>		<span class="token comment">//参数一个一个写</span>
<span class="token function">sum</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token string">'apply'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span>	<span class="token comment">//参数以数组形式给出</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><font color="orange"><code>bind</code>也是可以显示绑定函数的<code>this</code>指向，可以简化去需对同一个对象指向显示绑定方法时的写法</font> <font color="orange">执行bind实际上是创建了一个新的对象</font>.</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'aa'</span><span class="token punctuation">)</span>		<span class="token comment">//将foo绑定到aa上，</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="细节"><a href="#细节" class="header-anchor">#</a> 细节</h2> <h3 id="数字在v8下占据的的内存大小"><a href="#数字在v8下占据的的内存大小" class="header-anchor">#</a> 数字在v8下占据的的内存大小</h3> <p><font color="orange">一个数字在js中占据8字节，v8对小的数字会优化减小为4字节</font></p> <h3 id="settimeout"><a href="#settimeout" class="header-anchor">#</a> setTimeOut</h3> <p>​		其内部是通过<code>apply</code>绑定window实现的。</p> <h3 id="prototype-property"><a href="#prototype-property" class="header-anchor">#</a> prototype &amp; property</h3> <p>一个是对象的原型一个是对象的描述符信息</p> <h1 id="进程和线程"><a href="#进程和线程" class="header-anchor">#</a> 进程和线程</h1> <ul><li>一个应用程序运行需要开启一个或多个进程</li> <li>一个进程可以只有一个线程称为主线程，也可以有多个程序（线程是操作系统进行资源调配的最小单位）</li> <li>操作系统之所以可以在多个进程来回切换是因为每个进程的运行都有自己的时间片，时间片用完就切换，而这个切换过程是非常快的，用户感受不出它们之间的间隔</li></ul> <h1 id="json-数据存储"><a href="#json-数据存储" class="header-anchor">#</a> JSON-数据存储</h1> <p>在目前的开发中，JSON是一种非常重要的数据格式，它并不是编程语言，而是一种可以在服务器和客户端之间传输的数据格式。</p> <p>JSON是一种轻量级的资料交换格式，可在各类编程语言使用</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202152230020.png" alt="image-20220215223000886" style="zoom:80%;"> <p>JSON的顶层支持对象、数组、数字、布尔、null、字符串（要双引号包裹），不可以加任何注释</p> <h2 id="json序列化"><a href="#json序列化" class="header-anchor">#</a> JSON序列化</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token comment">//localStorage存储，需要转成JSON格式的字符串存储对象，否则保存的是 [object, object]</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> getObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;obj&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>JSON.stringify过滤</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;friend&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//第二个参数传想要保存的属性</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//传入回调函数进行处理</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> 					<span class="token comment">//第三个参数控制缩进</span>

<span class="token comment">//如果obj对象有toJSON方法，会调用内部的toJSON方法</span>
<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">toJSON</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>JSON.parse</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>JSONString<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//拦截处理</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="json序列化深拷贝"><a href="#json序列化深拷贝" class="header-anchor">#</a> JSON序列化深拷贝</h2> <p>​		浅拷贝的引用属性是指向同一个对象</p> <p>​		通过JSON可以实现深拷贝，但无法识别函数会移除</p> <h1 id="bom"><a href="#bom" class="header-anchor">#</a> BOM</h1> <ul><li><p>JavaScript有一个非常重要的运行环境就是浏览器，而且浏览器本身又作为一个应用程序需要对其本身进行操作，所以通常浏览器会有对应的对象模型（BOM，Browser Object Model )。浏览器对象模型。</p> <ul><li>我们可以将BOM看成是连接JavaScript脚本与浏览器窗口的桥梁。通过B0M对浏览器进行操作。</li></ul></li> <li><p>BOM主要对象模型</p> <ul><li>window：包括全局属性、方法，控制浏览器窗口相关的属性、方法;</li> <li>location：浏览器连接到的对象的位置( URL ) ;</li> <li>histroy：操作浏览器的历史</li> <li>document：当前窗口操作文档的对象;</li></ul></li> <li><p>window对象在浏览器有两个身份</p> <ul><li><p><font color="orange">全局对象</font>：在Node是global，在浏览器是window对象和全局对象GO（浏览器回收也是从全局对象查找）
window默认给我们提供了全局函数和类：setTimeout、Math、Date、Object等</p></li> <li><p><font color="orange">浏览器窗口对象</font></p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202161111674.png" alt="image-20220216111127458" style="zoom:80%;"> <p>Window窗口对象继承<code>EventTarget</code></p> <p>常见方法</p> <p>window.open(&quot;第一个参数是目标网页地址&quot;，target)，第二个为可选参数
<img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202161122379.png" alt="image-20220216112256272" style="zoom:80%;"></p></li></ul></li> <li><p>派发时间</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">dispathchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h3 id="location"><a href="#location" class="header-anchor">#</a> location</h3> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202161132478.png" alt="image-20220216113208336" style="zoom:50%;"> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//这种是加载新网页，需要重新请求资源</span>
location<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">&quot;自动打开新地址&quot;</span><span class="token punctuation">)</span>
location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;地址&quot;</span>；
location<span class="token punctuation">.</span>replace <span class="token operator">=</span><span class="token string">&quot;新地址&quot;</span><span class="token punctuation">;</span>	<span class="token comment">//此操作无法回滚</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="history"><a href="#history" class="header-anchor">#</a> history</h3> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202161134543.png" alt="image-20220216113431385" style="zoom:50%;"> <p><font color="orange"><code>state</code>改变是不会刷新网页，也是前端路由实现原理</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>dom<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'why'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/detail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这种会保存路由状态</span>
    history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//这种不会保留替换前的状态</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><font color="orange">go回退刷新与否是根据所切换的history是状态切换还是路由切换有关</font></p> <h1 id="dom"><a href="#dom" class="header-anchor">#</a> DOM</h1> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202161202020.png" alt="image-20220216120202858" style="zoom:80%;"> <p>​		浏览器本身解析<code>html</code>代码是不需要JavaScript的。浏览器提供了DOM对象让JavaScript可以以DOM为媒介操作文档。之所以可以对dom进行监听是因为dom标签元素也是继承自<code>EeventTarget</code>的。</p> <h2 id="常见方法"><a href="#常见方法" class="header-anchor">#</a> 常见方法</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//创建元素</span>
<span class="token keyword">const</span> el <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;strong&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
el<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'strong元素'</span>
divEl<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="事件冒泡"><a href="#事件冒泡" class="header-anchor">#</a> 事件冒泡</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	&lt;div&gt;
		&lt;ul&gt;
			&lt;li&gt;&lt;/li&gt;
		&lt;ul&gt;
	&lt;/div&gt;
*/</span>
<span class="token comment">//在以上html结构下，如果div、ul、li都有添加点击监听事件 ，当点击li标签时，也会导致ul、div标签触发响应事件（这种现象叫事件冒泡），但点击父标签不会触发子标签的同类事件</span>


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>事件捕获</strong></p> <p><font color="orange">可以改变事件冒泡的执行顺序，第三个参数置为<code>true</code></font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="事件对象"><a href="#事件对象" class="header-anchor">#</a> 事件对象</h2> <p>​		监听事件触发时，第二个参数的回调函数可以传入一个参数，获取相关信息</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span><span class="token punctuation">,</span> boolObj<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//为true捕获，为fasle冒泡</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>阻止默认行为</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">//阻止a标签默认打开新网页</span>
   event<span class="token punctuation">.</span>preventDefault<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>阻止冒泡</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> aEl

el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//阻止事件捕获和事件冒泡的传入</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="迭代器"><a href="#迭代器" class="header-anchor">#</a> 迭代器</h1> <h1 id="js代码的执行"><a href="#js代码的执行" class="header-anchor">#</a> JS代码的执行</h1> <p>​		JavaScript是解释性语言/动态语言。因此JS代码无法直接编译成可执行文件让CPU直接执行。因此需要一个JS引擎对代码进行解析成可编译文件。再让编译器将文件生成可执行文件（就是CPU可识别的机器指令）。</p> <ul><li><p>浏览器的渲染引擎（<code>Blink</code>）在解析到JS代码时</p></li> <li><p>JS引擎会先对JS源码进行编码转化成UTF-16编码</p></li> <li><p>接着是进行词法分析</p> <ul><li>词法分析会将JS代码打断成有意义的<code>token</code>片段</li></ul></li> <li><p>语法分析：词法分析后拿到<code>token</code>流，引擎会对这些流进行语法分析生成抽象语法树</p> <ul><li><p><font color="orange">V8引擎对这个过程进行了优化，有了个预解析过程，因为并非所有JavaScript代码都会立即执行，如果每次都全部解析势必会影响执行效率。因此对那些没必要的函数只会进行预解析（即解析必需的内容，而非全量解析）。</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">function</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>		<span class="token comment">//会对inner进行预解析</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p>生成抽象语法树后，V8的<code>Ingition</code>（解释器）会解释抽象语法树的内容生成字节码（字节码随后生成汇编指令，由汇编指令生成机器码执行）。与此同时，<code>Ignition</code>会进行信息收集，将执行频率高的代码标记成<code>hot</code>函数，将其生成的字节码直接交由一个叫<code>TurboFan</code>的编译器直接执行，它会对字节码优化形成机器码，提高执行效率。但如果热点函数发生了编码，编译器无法顺利执行会重反编译转成字节码，反而影响了执行效率。</p></li> <li></li></ul> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201141744686.png" alt="image-20220114174453565" style="zoom:57%;"> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202111518019.png" alt="image-20220114162400488" style="zoom:60%;"> <h2 id="作用域"><a href="#作用域" class="header-anchor">#</a> 作用域</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// index.js</span>
<span class="token comment">//一个js文件的全局作用域在浏览器表现为window</span>
<span class="token comment">//函数内部自己是一个作用域</span>
<span class="token function">funciton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>

<span class="token comment">//不管obj内套了几层对象，都没有自己的作用域，除法定义了函数</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'mike'</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span><span class="token punctuation">{</span>
    name<span class="token punctuation">,</span>		<span class="token comment">//简写 name: name </span>
    <span class="token function-variable function">foo</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'foo'</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> 		<span class="token comment">//this指向函数自身</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">bar</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'bar'</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>	<span class="token comment">//this指向上层的作用域，obj没有自己的作用域，this指向window</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//箭头函数内的this指向当前作用域的上层</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'a'</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//a</span>
obj<span class="token punctuation">.</span><span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//window,  a的上层是window</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="参数作用域"><a href="#参数作用域" class="header-anchor">#</a> 参数作用域</h3> <p><font color="orange">当函数内部定义了一个与参数同名的变量时，函数内部优先访问自己内部定义的同名变量</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	当函数的参数类型是一个函数且具有默认值，那么参数自身会生成一个新的作用域，这个作用域包含函数作用域
	因此执行y函数改变的x是参数作用域的x，不影响函数作用域的x
	
*/</span>

<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token function-variable function">y</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> x<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
	undefined
	3
	2
	0
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h1 id=""><a href="#" class="header-anchor">#</a></h1> <h1 id="装箱-拆箱"><a href="#装箱-拆箱" class="header-anchor">#</a> 装箱&amp;拆箱</h1> <h3 id="装箱"><a href="#装箱" class="header-anchor">#</a> 装箱</h3> <p>​		所谓的<strong>装箱</strong>，是指将基本数据类型转换为对应的引用类型的操作。装箱又分为隐式和显式装箱。我们之所以能够在基本数据类型上引用方法是因为JavaScript为我们自动执行了装箱操作。<font color="orange">基本类型是不能添加属性和方法的，添加会报错。</font>因为它只存在于方法调用那一行代码执行的瞬间，执行方法后立即被销毁。这也是在基本类型上添加属性和方法会不识别或报错的原因。<font color="orange">显示装箱是通过基本包装类型对象进行装箱：<code>new a = new String(a)</code>,通过new操作符创建的引用类型的实例，在执行流离开当前作用域之前一直保留在内存中`。</font></p> <p>​		在《javascript高级程序设计》中有这样一句话：</p> <p><font color="orange">每当读取一个基本类型的时候，js引擎就会创建一个对应的基本包装类型对象，从而让我们能够调用一些方法来操作这些数据。</font></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span>	<span class="token comment">//此行代码就是隐式装箱，读取了一个值，引擎自动转化</span>
<span class="token comment">//变量s1是一个基本类型值，它不是对象，它不应该有方法。但是js内部为我们完成了一系列处理（即装箱），使得它能够调用方法,实现的机制如下：</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol><li>创建String类型的一个实例；</li> <li>在实例上调用指定的方法；</li> <li>销毁这个实例；</li></ol> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> s1  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">&quot;some text&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s1 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="拆箱"><a href="#拆箱" class="header-anchor">#</a> 拆箱</h3> <p>​		将引用类型对象转换为对应的值类型对象</p> <p>​		它是通过引用类型的valueOf()或者toString()方法来实现的。如果是自定义的对象，你也可以自定义它的valueOf()/tostring()方法，实现对这个对象的拆箱。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//更改对象的 toString() 和 valueOf() 两个方法：</span>
<span class="token keyword">var</span> web <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string-property property">'name'</span><span class="token operator">:</span><span class="token string">'html'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;valueOf&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">toString</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>web<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//toString undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>web<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//valueOf NaN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h1 id="object-prototype-tostring"><a href="#object-prototype-tostring" class="header-anchor">#</a> Object.prototype.toString</h1> <p><code>[Symbol.toStringTag]</code> 属性值</p> <p>​		根据 ECMAScript 规范，这个符号作为一个属性表示一个字符串，该字符串用于创建对象的<font color="orange">默认字符串描述（<strong>即属性值需要是字符串类型，否则会被忽略，通过此字符串声名对象类型</strong>）</font>。<font color="orange">由内置方法 <code>Object.prototype.toString()</code> 使用。</font></p> <p>​		<font color=":orange">通过 <code>Object.prototypet.toString()</code> 方法获取对象标识时（想要获取变量的类型），会检索由 Symbol.toStringTag 指定的实例标识符，默认为 <code>Object</code>（对于自定义类创建的对象统一返回（<code>[Obejct, Object]</code>）。内置类型已经指定了这个值，但自定义类实例还需要明确定义：</font></p> <h3 id="自定义类"><a href="#自定义类" class="header-anchor">#</a> 自定义类</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">add</span><span class="token punctuation">{</span>
    <span class="token keyword">get</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'class-add'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1. '</span><span class="token punctuation">,</span> num<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//1.  [object class-add]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2. '</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	 <span class="token comment">//2.  [object class-add]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="自定义对象"><a href="#自定义对象" class="header-anchor">#</a> 自定义对象</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'my-Object'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="object-prototype-tostring原理"><a href="#object-prototype-tostring原理" class="header-anchor">#</a> Object.prototype.toString原理</h3> <p>​		对于 <code>Object.prototype.toString.call(arg)</code>，若参数为 <code>null</code> 或 <code>undefined</code>，直接返回结果。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// =&gt; &quot;[object Null]&quot;</span>

<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; &quot;[object Undefined]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>​		<font color="orange">若参数不为 <code>null</code> 或 <code>undefined</code>，则将参数转为对象，再作判断。对于原始类型，转为对象的方法即装箱。转为对象后，取得该对象的 <code>[Symbol.toStringTag]</code> 属性值（可能会遍历原型链）作为 <code>tag</code>，如无该属性，或该属性值不为字符串类型，则根据具体参数类型返回对应的<code>tag</code>, 然后返回 <code>&quot;[object &quot; + tag + &quot;]&quot;</code> 形式的字符串。（<code>tag：Boolean、Number、String、Array、Arguments、Function、Error</code>）</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// RegExp 类型，tag 为 &quot;RegExp&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// =&gt; &quot;[object RegExp]&quot;</span>

<span class="token comment">// Date 类型，tag 为 &quot;Date&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; &quot;[object Date]&quot;</span>

<span class="token comment">// 其他类型，tag 为 &quot;Object&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">class</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// =&gt; &quot;[object Object]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果<code>Symbol.toStringTag</code>属性值不是字符串会被忽略，<code>Symbol.toStringTag</code> 也可以部署在原型链上：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; &quot;[object A]&quot;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; &quot;[object Object]&quot;</span>
<span class="token comment">//部署在原型链</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">;</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// =&gt; &quot;[object A]&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <blockquote><h3 id="为什么-object-prototype-tostring-call-null-输出-object-null"><a href="#为什么-object-prototype-tostring-call-null-输出-object-null" class="header-anchor">#</a> 为什么 Object.prototype.toString.call(null) 输出 '[object Null]'</h3> <p><code>toString()</code> 是 <code>Object</code> 的原型方法，调用该方法，默认返回当前对象的 <code>[[Class]]</code> 。这是一个内部属性，其格式为 <code>[object Xxx]</code> ，其中 <code>Xxx</code> 就是对象的类型。</p> <h4 id="javascript-万物皆对象-为什么-xxx-tostring-不能返回变量类型"><a href="#javascript-万物皆对象-为什么-xxx-tostring-不能返回变量类型" class="header-anchor">#</a> JavaScript 万物皆对象，为什么 xxx.toString() 不能返回变量类型？</h4> <p>这是因为 各个类中重写了 <code>toString</code> 的方法，因此需要调用 <code>Object</code> 中的 <code>toString</code> 方法，必须使用 <code>toString.call()</code> 的方式调用。
对于 <code>Object</code> 对象，直接调用 <code>toString()</code> 就能返回 <code>'[object Object]'</code> 。而对于其他对象，则需要通过 <code>call / apply</code> 来调用才能返回正确的类型信息。</p></blockquote> <hr> <h1 id="null-undefined"><a href="#null-undefined" class="header-anchor">#</a> null &amp; undefined</h1> <h3 id="表现形式"><a href="#表现形式" class="header-anchor">#</a> 表现形式</h3> <h4 id="typeof"><a href="#typeof" class="header-anchor">#</a> typeof</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">typeof</span> <span class="token keyword">null</span>  <span class="token comment">// 'object'</span>
<span class="token keyword">typeof</span> <span class="token keyword">undefined</span>  <span class="token comment">// 'undefined'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="object-prototype-tostring-call"><a href="#object-prototype-tostring-call" class="header-anchor">#</a> Object.prototype.toString.call</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 对于null和undefined返回参数值</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// '[object Null]'</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// '[object Undefined]'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="与"><a href="#与" class="header-anchor">#</a> == 与 ===</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span>  <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token operator">===</span> <span class="token keyword">undefined</span>  <span class="token comment">// false</span>
<span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">null</span> <span class="token operator">===</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">undefined</span>  <span class="token comment">// true</span>
<span class="token comment">//JavaScript` 中第一个对象的原型指向 `null` 。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>			<span class="token comment">//使用undefined</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="问题-2"><a href="#问题-2" class="header-anchor">#</a> 问题</h3> <blockquote><h3 id="为什么-typeof-null-是-object"><a href="#为什么-typeof-null-是-object" class="header-anchor">#</a> 为什么 typeof null 是 object？</h3> <p><code>typeof null</code> 输出为 <code>'object'</code> 其实是一个底层的错误，但直到现阶段都无法被修复。原因是，在 <code>JavaScript</code> 初始版本中，值以 <code>32位</code> 存储。前 <code>3位</code> 表示数据类型的标记，其余位则是值。
<font color="orange">对于所有的对象，它的前 <code>3位</code> 都以 <code>000</code> 作为类型标记位。在 <code>JavaScript</code> 早期版本中， <code>null</code> 被认为是一个特殊的值，用来对应 <code>C</code> 中的 <code>空指针</code> 。但 <code>JavaScript</code> 中没有 <code>C</code> 中的指针，所以 <code>null</code> 意味着什么都没有或者 <code>void</code> 并以 <code>全0(32个)</code> 表示。因此每当 <code>JavaScript</code> 读取 <code>null</code> 时，它前端的 <code>3位</code> 将它视为 <code>对象类型</code> ，这也是为什么 <code>typeof null</code> 返回 <code>'object'</code> 的原因。</font></p> <h3 id="为什么-和-对比会出现-true-和-false"><a href="#为什么-和-对比会出现-true-和-false" class="header-anchor">#</a> 为什么 == 和 === 对比会出现 true 和 false ？</h3> <p>很多文章说：<code>undefined</code> 的布尔值是 <code>false</code> ， <code>null</code> 的布尔值也是 <code>false</code> ，所以它们在比较时都转化为了 <code>false</code> ，所以 <code>undefined == null</code> 。
实际上并不是这样的。</p> <h3 id="为什么-null-1-和-undefined-1-表现不同"><a href="#为什么-null-1-和-undefined-1-表现不同" class="header-anchor">#</a> 为什么 <code>null + 1</code> 和 <code>undefined + 1</code> 表现不同？</h3> <p>这涉及到 <code>JavaScript</code> 中的隐式类型转换，在执行 <code>加法运算</code> 前，隐式类型转换会尝试将表达式中的变量转换为 <code>number</code> 类型。如：<code>'1' + 1</code> 会得到结果 <code>11</code>。</p> <ul><li><code>null</code> 转化为 <code>number</code> 时，会转换成 <code>0</code></li> <li><code>undefined</code> 转换为 <code>number</code> 时，会转换为 <code>NaN</code></li></ul></blockquote> <h3 id="参考-https-zhuanlan-zhihu-com-p-118793721"><a href="#参考-https-zhuanlan-zhihu-com-p-118793721" class="header-anchor">#</a> 参考：https://zhuanlan.zhihu.com/p/118793721</h3> <h1 id="javascript支持块级作用域方法"><a href="#javascript支持块级作用域方法" class="header-anchor">#</a> JavaScript支持块级作用域方法</h1> <p>ES6新出了let 和 const 实现了对块级作用域的支持，其具体实现方式如下。</p> <p>词法环境跟函数上下文，都是通过栈结构实现的。函数内部通过 var 声明的变量，在编译阶段全都被存放到变量环境(函数上下文)中，而通过let和const申明的变量会被追加到词法环境中，当这个块执行结束之后，追加到词法作用域的内容又会销毁掉。</p> <p>在变量还未赋值之前，访问词法环境的变量会报错</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203101614973.webp" alt="GitHub" style="zoom:67%;"></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/ccyblog/blogs/javascript/javascriptde-ji-cheng.html">
            组合式继承
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#学前" class="sidebar-link reco-side-学前" data-v-70334359>学前</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#typescript与javascript" class="sidebar-link reco-side-typescript与javascript" data-v-70334359>typescript与JavaScript</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#javascript是一门编程语言" class="sidebar-link reco-side-javascript是一门编程语言" data-v-70334359>JavaScript是一门编程语言</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#浏览器工作原理与v8引擎" class="sidebar-link reco-side-浏览器工作原理与v8引擎" data-v-70334359>浏览器工作原理与V8引擎</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#浏览器内核" class="sidebar-link reco-side-浏览器内核" data-v-70334359>浏览器内核</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#浏览器渲染过程" class="sidebar-link reco-side-浏览器渲染过程" data-v-70334359>浏览器渲染过程</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#javascript引擎" class="sidebar-link reco-side-javascript引擎" data-v-70334359>JavaScript引擎</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#浏览器内核和javascript引擎的区别" class="sidebar-link reco-side-浏览器内核和javascript引擎的区别" data-v-70334359></a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#v8引擎" class="sidebar-link reco-side-v8引擎" data-v-70334359></a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数指执行-作用域链-内存管理" class="sidebar-link reco-side-函数指执行-作用域链-内存管理" data-v-70334359>函数指执行-作用域链-内存管理</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#v8解析javascript代码过程" class="sidebar-link reco-side-v8解析javascript代码过程" data-v-70334359>v8解析JavaScript代码过程</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数执行上下文" class="sidebar-link reco-side-函数执行上下文" data-v-70334359>函数执行上下文</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数执行上下文fec" class="sidebar-link reco-side-函数执行上下文fec" data-v-70334359>函数执行上下文FEC</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#变量环境和记录" class="sidebar-link reco-side-变量环境和记录" data-v-70334359>变量环境和记录</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#作用域提升题" class="sidebar-link reco-side-作用域提升题" data-v-70334359>作用域提升题</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#内存管理" class="sidebar-link reco-side-内存管理" data-v-70334359>内存管理</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#js的内存管理" class="sidebar-link reco-side-js的内存管理" data-v-70334359></a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#js的垃圾回收" class="sidebar-link reco-side-js的垃圾回收" data-v-70334359></a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#闭包" class="sidebar-link reco-side-闭包" data-v-70334359>闭包</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#闭包的定义" class="sidebar-link reco-side-闭包的定义" data-v-70334359></a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#闭包的内存泄露" class="sidebar-link reco-side-闭包的内存泄露" data-v-70334359>闭包的内存泄露</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#闭包内存回收和this的四个绑定规则" class="sidebar-link reco-side-闭包内存回收和this的四个绑定规则" data-v-70334359>闭包内存回收和this的四个绑定规则</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#this" class="sidebar-link reco-side-this" data-v-70334359>this</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#箭头函数" class="sidebar-link reco-side-箭头函数" data-v-70334359>箭头函数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#简写" class="sidebar-link reco-side-简写" data-v-70334359>简写</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#箭头函数的this" class="sidebar-link reco-side-箭头函数的this" data-v-70334359>箭头函数的this</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#apply-call-bind实现" class="sidebar-link reco-side-apply-call-bind实现" data-v-70334359>apply-call-bind实现</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#实现call" class="sidebar-link reco-side-实现call" data-v-70334359>实现call</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#实现apply" class="sidebar-link reco-side-实现apply" data-v-70334359>实现apply</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#实现bind" class="sidebar-link reco-side-实现bind" data-v-70334359>实现bind</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es6剩余参数" class="sidebar-link reco-side-es6剩余参数" data-v-70334359>ES6剩余参数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#arguments-参数-基本使用" class="sidebar-link reco-side-arguments-参数-基本使用" data-v-70334359>arguments(参数)基本使用</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#纯函数-柯里化实现" class="sidebar-link reco-side-纯函数-柯里化实现" data-v-70334359>纯函数-柯里化实现</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#纯函数" class="sidebar-link reco-side-纯函数" data-v-70334359>纯函数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数柯里化" class="sidebar-link reco-side-函数柯里化" data-v-70334359>函数柯里化</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#柯里化作用" class="sidebar-link reco-side-柯里化作用" data-v-70334359>柯里化作用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#组合函数" class="sidebar-link reco-side-组合函数" data-v-70334359>组合函数</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#with-eval-严格模式-面向对象" class="sidebar-link reco-side-with-eval-严格模式-面向对象" data-v-70334359>with-eval-严格模式-面向对象</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#with语句" class="sidebar-link reco-side-with语句" data-v-70334359>with语句</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#eval函数" class="sidebar-link reco-side-eval函数" data-v-70334359>eval函数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#严格模式" class="sidebar-link reco-side-严格模式" data-v-70334359>严格模式</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#面向对象一" class="sidebar-link reco-side-面向对象一" data-v-70334359>面向对象一</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#创建对象方式" class="sidebar-link reco-side-创建对象方式" data-v-70334359>创建对象方式</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#数据属性描述符" class="sidebar-link reco-side-数据属性描述符" data-v-70334359>数据属性描述符</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#存取属性描述符" class="sidebar-link reco-side-存取属性描述符" data-v-70334359></a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#同时定义多个属性描述符" class="sidebar-link reco-side-同时定义多个属性描述符" data-v-70334359>同时定义多个属性描述符</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#获取对象属性描述符" class="sidebar-link reco-side-获取对象属性描述符" data-v-70334359>获取对象属性描述符</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#object的方法对对象限制" class="sidebar-link reco-side-object的方法对对象限制" data-v-70334359>Object的方法对对象限制</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#面向对象二" class="sidebar-link reco-side-面向对象二" data-v-70334359>面向对象二</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#创建对象方案" class="sidebar-link reco-side-创建对象方案" data-v-70334359>创建对象方案</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#js的构造函数" class="sidebar-link reco-side-js的构造函数" data-v-70334359>JS的构造函数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#构造函数的缺点" class="sidebar-link reco-side-构造函数的缺点" data-v-70334359>构造函数的缺点</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#对象原型" class="sidebar-link reco-side-对象原型" data-v-70334359>对象原型</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数原型" class="sidebar-link reco-side-函数原型" data-v-70334359>函数原型</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#获取函数的显示原型" class="sidebar-link reco-side-获取函数的显示原型" data-v-70334359>获取函数的显示原型</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#原型链的尽头" class="sidebar-link reco-side-原型链的尽头" data-v-70334359>原型链的尽头</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#原型链直接继承的弊端" class="sidebar-link reco-side-原型链直接继承的弊端" data-v-70334359>原型链直接继承的弊端</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#借用构造函数实现继承-组合" class="sidebar-link reco-side-借用构造函数实现继承-组合" data-v-70334359>（组合）</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#面向对象三" class="sidebar-link reco-side-面向对象三" data-v-70334359>面向对象三</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#原型式继承函数-寄生" class="sidebar-link reco-side-原型式继承函数-寄生" data-v-70334359>原型式继承函数(寄生)</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#实现继承的最终方案" class="sidebar-link reco-side-实现继承的最终方案" data-v-70334359>实现继承的最终方案</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#判断方法的补充" class="sidebar-link reco-side-判断方法的补充" data-v-70334359>判断方法的补充</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数与对象" class="sidebar-link reco-side-函数与对象" data-v-70334359>函数与对象</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#面向对象演变" class="sidebar-link reco-side-面向对象演变" data-v-70334359>面向对象演变</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es6类的使用" class="sidebar-link reco-side-es6类的使用" data-v-70334359>ES6类的使用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#具体使用" class="sidebar-link reco-side-具体使用" data-v-70334359>具体使用</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es6" class="sidebar-link reco-side-es6" data-v-70334359>ES6</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#字面量增强" class="sidebar-link reco-side-字面量增强" data-v-70334359>字面量增强</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#解构" class="sidebar-link reco-side-解构" data-v-70334359>解构</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#let-const的基本使用" class="sidebar-link reco-side-let-const的基本使用" data-v-70334359>let/const的基本使用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#块级作用域" class="sidebar-link reco-side-块级作用域" data-v-70334359>块级作用域</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#模板字符串" class="sidebar-link reco-side-模板字符串" data-v-70334359>模板字符串</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#标签模板字符串" class="sidebar-link reco-side-标签模板字符串" data-v-70334359>标签模板字符串</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数默认参数" class="sidebar-link reco-side-函数默认参数" data-v-70334359>函数默认参数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数的剩余参数" class="sidebar-link reco-side-函数的剩余参数" data-v-70334359>函数的剩余参数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#展开语法" class="sidebar-link reco-side-展开语法" data-v-70334359>展开语法</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es6数值表示" class="sidebar-link reco-side-es6数值表示" data-v-70334359>ES6数值表示</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#symbol" class="sidebar-link reco-side-symbol" data-v-70334359>Symbol</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#set的基本使用" class="sidebar-link reco-side-set的基本使用" data-v-70334359>Set的基本使用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#map的基本使用" class="sidebar-link reco-side-map的基本使用" data-v-70334359>Map的基本使用</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es-2" class="sidebar-link reco-side-es-2" data-v-70334359>ES+</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es7" class="sidebar-link reco-side-es7" data-v-70334359>ES7</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es8" class="sidebar-link reco-side-es8" data-v-70334359>ES8</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es9" class="sidebar-link reco-side-es9" data-v-70334359>ES9</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es10" class="sidebar-link reco-side-es10" data-v-70334359>ES10</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es11" class="sidebar-link reco-side-es11" data-v-70334359>ES11</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es12-2021" class="sidebar-link reco-side-es12-2021" data-v-70334359>ES12   2021</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#proxy-reflect" class="sidebar-link reco-side-proxy-reflect" data-v-70334359>Proxy-Reflect</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#监听对象的操作方法" class="sidebar-link reco-side-监听对象的操作方法" data-v-70334359>监听对象的操作方法</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#proxy" class="sidebar-link reco-side-proxy" data-v-70334359>Proxy</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#reflect" class="sidebar-link reco-side-reflect" data-v-70334359>Reflect</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#receiver参数的作用" class="sidebar-link reco-side-receiver参数的作用" data-v-70334359>Receiver参数的作用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#reflect-constructor" class="sidebar-link reco-side-reflect-constructor" data-v-70334359>Reflect.constructor</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#响应式-2" class="sidebar-link reco-side-响应式-2" data-v-70334359>响应式</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#promise" class="sidebar-link reco-side-promise" data-v-70334359>Promise</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#promise的三个状态" class="sidebar-link reco-side-promise的三个状态" data-v-70334359>Promise的三个状态</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#resolve的参数" class="sidebar-link reco-side-resolve的参数" data-v-70334359>resolve的参数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#then方法" class="sidebar-link reco-side-then方法" data-v-70334359>then方法</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#catch" class="sidebar-link reco-side-catch" data-v-70334359>catch</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#finally" class="sidebar-link reco-side-finally" data-v-70334359>finally</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#promise的类方法" class="sidebar-link reco-side-promise的类方法" data-v-70334359>promise的类方法</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#浏览器的进程" class="sidebar-link reco-side-浏览器的进程" data-v-70334359>浏览器的进程</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#宏任务和微任务" class="sidebar-link reco-side-宏任务和微任务" data-v-70334359>宏任务和微任务</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#事件队列" class="sidebar-link reco-side-事件队列" data-v-70334359>事件队列</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#node的事件循环" class="sidebar-link reco-side-node的事件循环" data-v-70334359>Node的事件循环</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#函数错误处理" class="sidebar-link reco-side-函数错误处理" data-v-70334359>函数错误处理</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#抛出异常处理" class="sidebar-link reco-side-抛出异常处理" data-v-70334359>抛出异常处理</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#什么是模块化" class="sidebar-link reco-side-什么是模块化" data-v-70334359>什么是模块化</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#为什么需要模块化" class="sidebar-link reco-side-为什么需要模块化" data-v-70334359>为什么需要模块化</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#模块化规范" class="sidebar-link reco-side-模块化规范" data-v-70334359>模块化规范</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#js模块化" class="sidebar-link reco-side-js模块化" data-v-70334359>JS模块化</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#commonjs和node" class="sidebar-link reco-side-commonjs和node" data-v-70334359>CommonJS和NODE</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#amd" class="sidebar-link reco-side-amd" data-v-70334359>AMD</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#cmd" class="sidebar-link reco-side-cmd" data-v-70334359>CMD</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es-module" class="sidebar-link reco-side-es-module" data-v-70334359></a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#与commonjs的区别" class="sidebar-link reco-side-与commonjs的区别" data-v-70334359>与CommonJS的区别</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#基本使用" class="sidebar-link reco-side-基本使用" data-v-70334359>基本使用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#导出方式" class="sidebar-link reco-side-导出方式" data-v-70334359>导出方式</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#导入方式" class="sidebar-link reco-side-导入方式" data-v-70334359>导入方式</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#结合使用" class="sidebar-link reco-side-结合使用" data-v-70334359>结合使用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#默认导入导出" class="sidebar-link reco-side-默认导入导出" data-v-70334359>默认导入导出</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#import函数" class="sidebar-link reco-side-import函数" data-v-70334359>import函数</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es-module解析流程" class="sidebar-link reco-side-es-module解析流程" data-v-70334359>ES Module解析流程</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#es-module-和-common-js相互调用" class="sidebar-link reco-side-es-module-和-common-js相互调用" data-v-70334359>ES Module 和 Common JS相互调用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#浏览器" class="sidebar-link reco-side-浏览器" data-v-70334359>浏览器</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#node环境" class="sidebar-link reco-side-node环境" data-v-70334359>NODE环境</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#webpack下" class="sidebar-link reco-side-webpack下" data-v-70334359>webpack下</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#作用域提升" class="sidebar-link reco-side-作用域提升" data-v-70334359>作用域提升</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#数组" class="sidebar-link reco-side-数组" data-v-70334359>数组</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#call、apply和bind区别" class="sidebar-link reco-side-call、apply和bind区别" data-v-70334359>call、apply和bind区别</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#细节" class="sidebar-link reco-side-细节" data-v-70334359>细节</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#数字在v8下占据的的内存大小" class="sidebar-link reco-side-数字在v8下占据的的内存大小" data-v-70334359>数字在v8下占据的的内存大小</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#settimeout" class="sidebar-link reco-side-settimeout" data-v-70334359>setTimeOut</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#prototype-property" class="sidebar-link reco-side-prototype-property" data-v-70334359>prototype &amp; property</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#json序列化" class="sidebar-link reco-side-json序列化" data-v-70334359>JSON序列化</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#json序列化深拷贝" class="sidebar-link reco-side-json序列化深拷贝" data-v-70334359>JSON序列化深拷贝</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#location" class="sidebar-link reco-side-location" data-v-70334359>location</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#history" class="sidebar-link reco-side-history" data-v-70334359>history</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#常见方法" class="sidebar-link reco-side-常见方法" data-v-70334359>常见方法</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#事件冒泡" class="sidebar-link reco-side-事件冒泡" data-v-70334359>事件冒泡</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#事件对象" class="sidebar-link reco-side-事件对象" data-v-70334359>事件对象</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#作用域" class="sidebar-link reco-side-作用域" data-v-70334359>作用域</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#参数作用域" class="sidebar-link reco-side-参数作用域" data-v-70334359>参数作用域</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#装箱" class="sidebar-link reco-side-装箱" data-v-70334359>装箱</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#拆箱" class="sidebar-link reco-side-拆箱" data-v-70334359>拆箱</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#自定义类" class="sidebar-link reco-side-自定义类" data-v-70334359>自定义类</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#自定义对象" class="sidebar-link reco-side-自定义对象" data-v-70334359>自定义对象</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#object-prototype-tostring原理" class="sidebar-link reco-side-object-prototype-tostring原理" data-v-70334359>Object.prototype.toString原理</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#问题" class="sidebar-link reco-side-问题" data-v-70334359>问题</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#为什么-object-prototype-tostring-call-null-输出-object-null" class="sidebar-link reco-side-为什么-object-prototype-tostring-call-null-输出-object-null" data-v-70334359>为什么 Object.prototype.toString.call(null) 输出 '[object Null]'</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#表现形式" class="sidebar-link reco-side-表现形式" data-v-70334359>表现形式</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#使用" class="sidebar-link reco-side-使用" data-v-70334359>使用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#问题-2" class="sidebar-link reco-side-问题-2" data-v-70334359>问题</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#为什么-typeof-null-是-object" class="sidebar-link reco-side-为什么-typeof-null-是-object" data-v-70334359>为什么 typeof null 是 object？</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#为什么-和-对比会出现-true-和-false" class="sidebar-link reco-side-为什么-和-对比会出现-true-和-false" data-v-70334359>为什么 == 和 === 对比会出现 true 和 false ？</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#为什么-null-1-和-undefined-1-表现不同" class="sidebar-link reco-side-为什么-null-1-和-undefined-1-表现不同" data-v-70334359>为什么 null + 1 和 undefined + 1 表现不同？</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/javascript/javascript.html#参考-https-zhuanlan-zhihu-com-p-118793721" class="sidebar-link reco-side-参考-https-zhuanlan-zhihu-com-p-118793721" data-v-70334359>参考：https://zhuanlan.zhihu.com/p/118793721</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-6e863240><div class="banniang-container" style="display:;" data-v-6e863240><div class="messageBox" style="right:88px;bottom:270px;display:none;" data-v-6e863240></div> <div class="operation" style="right:15px;bottom:100px;" data-v-6e863240><i class="kbnfont kbn-ban-home ban-home" data-v-6e863240></i> <i class="kbnfont kbn-ban-message message" data-v-6e863240></i> <i class="kbnfont kbn-ban-info info" data-v-6e863240></i> <i class="kbnfont kbn-ban-close close" data-v-6e863240></i></div> <div id="L2dCanvas" class="Canvas" style="position: absolute; bottom: -50px;z-index:100000" data-v-6e863240></div></div> <div class="showBanNiang" style="display:none;" data-v-6e863240>看板娘</div></div><!----></div></div>
    <script src="/ccyblog/assets/js/app.61cc9ff9.js" defer></script><script src="/ccyblog/assets/js/3.897744a6.js" defer></script><script src="/ccyblog/assets/js/1.371d3697.js" defer></script><script src="/ccyblog/assets/js/13.8010945d.js" defer></script><script src="/ccyblog/assets/js/8.b19724a0.js" defer></script>
  </body>
</html>
