<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | ccy&#39;s blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/ccyblog/favicon.ico">
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/UsernameFull/l2d@0.2/js/frame/live2dcubismcore.min.js"></script>
    <script src="https://pixijs.download/v4.8.4/pixi.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/litstronger/live2d-moc3@master/js/live2dcubismframework.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/litstronger/live2d-moc3@master/js/live2dcubismpixi.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/litstronger/live2d-moc3@master/js/l2d.js"></script>
    <meta name="description" content="个人技术博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/ccyblog/assets/css/0.styles.79d32354.css" as="style"><link rel="preload" href="/ccyblog/assets/js/app.61cc9ff9.js" as="script"><link rel="preload" href="/ccyblog/assets/js/3.897744a6.js" as="script"><link rel="preload" href="/ccyblog/assets/js/1.371d3697.js" as="script"><link rel="preload" href="/ccyblog/assets/js/75.a8f3a837.js" as="script"><link rel="preload" href="/ccyblog/assets/js/8.b19724a0.js" as="script"><link rel="prefetch" href="/ccyblog/assets/js/10.a51d9fc9.js"><link rel="prefetch" href="/ccyblog/assets/js/11.8d124275.js"><link rel="prefetch" href="/ccyblog/assets/js/12.a334a46b.js"><link rel="prefetch" href="/ccyblog/assets/js/13.8010945d.js"><link rel="prefetch" href="/ccyblog/assets/js/14.8e3c3ac4.js"><link rel="prefetch" href="/ccyblog/assets/js/15.81bd0ba2.js"><link rel="prefetch" href="/ccyblog/assets/js/16.232611db.js"><link rel="prefetch" href="/ccyblog/assets/js/17.667dde35.js"><link rel="prefetch" href="/ccyblog/assets/js/18.71e79375.js"><link rel="prefetch" href="/ccyblog/assets/js/19.f10b5e62.js"><link rel="prefetch" href="/ccyblog/assets/js/20.dd05ecdc.js"><link rel="prefetch" href="/ccyblog/assets/js/21.4a07e2cf.js"><link rel="prefetch" href="/ccyblog/assets/js/22.29c735e7.js"><link rel="prefetch" href="/ccyblog/assets/js/23.04beb3f2.js"><link rel="prefetch" href="/ccyblog/assets/js/24.e4efbb4f.js"><link rel="prefetch" href="/ccyblog/assets/js/25.63de8752.js"><link rel="prefetch" href="/ccyblog/assets/js/26.1a8c82ca.js"><link rel="prefetch" href="/ccyblog/assets/js/27.47678a4d.js"><link rel="prefetch" href="/ccyblog/assets/js/28.4d87f639.js"><link rel="prefetch" href="/ccyblog/assets/js/29.d613dcd8.js"><link rel="prefetch" href="/ccyblog/assets/js/30.610dbdf4.js"><link rel="prefetch" href="/ccyblog/assets/js/31.c4817f6d.js"><link rel="prefetch" href="/ccyblog/assets/js/32.7af520a4.js"><link rel="prefetch" href="/ccyblog/assets/js/33.5ce06274.js"><link rel="prefetch" href="/ccyblog/assets/js/34.b2117dfb.js"><link rel="prefetch" href="/ccyblog/assets/js/35.377603e6.js"><link rel="prefetch" href="/ccyblog/assets/js/36.883e88a6.js"><link rel="prefetch" href="/ccyblog/assets/js/37.872a7cdf.js"><link rel="prefetch" href="/ccyblog/assets/js/38.18f351f9.js"><link rel="prefetch" href="/ccyblog/assets/js/39.0487dd57.js"><link rel="prefetch" href="/ccyblog/assets/js/4.9b4181ee.js"><link rel="prefetch" href="/ccyblog/assets/js/40.abacd655.js"><link rel="prefetch" href="/ccyblog/assets/js/41.abf116df.js"><link rel="prefetch" href="/ccyblog/assets/js/42.7f9de919.js"><link rel="prefetch" href="/ccyblog/assets/js/43.d41da37b.js"><link rel="prefetch" href="/ccyblog/assets/js/44.7c2519a6.js"><link rel="prefetch" href="/ccyblog/assets/js/45.29a6bc83.js"><link rel="prefetch" href="/ccyblog/assets/js/46.5f6478d4.js"><link rel="prefetch" href="/ccyblog/assets/js/47.631bdc1f.js"><link rel="prefetch" href="/ccyblog/assets/js/48.6df6dfd4.js"><link rel="prefetch" href="/ccyblog/assets/js/49.8fdfb49c.js"><link rel="prefetch" href="/ccyblog/assets/js/5.bd4235cd.js"><link rel="prefetch" href="/ccyblog/assets/js/50.88f2f8bf.js"><link rel="prefetch" href="/ccyblog/assets/js/51.f502157e.js"><link rel="prefetch" href="/ccyblog/assets/js/52.9bf27ff9.js"><link rel="prefetch" href="/ccyblog/assets/js/53.56ba7eeb.js"><link rel="prefetch" href="/ccyblog/assets/js/54.212c55f1.js"><link rel="prefetch" href="/ccyblog/assets/js/55.6fc8672f.js"><link rel="prefetch" href="/ccyblog/assets/js/56.8cbf943d.js"><link rel="prefetch" href="/ccyblog/assets/js/57.8b84c069.js"><link rel="prefetch" href="/ccyblog/assets/js/58.df9fd31e.js"><link rel="prefetch" href="/ccyblog/assets/js/59.4a889f7f.js"><link rel="prefetch" href="/ccyblog/assets/js/6.1ebcf0d6.js"><link rel="prefetch" href="/ccyblog/assets/js/60.045b3756.js"><link rel="prefetch" href="/ccyblog/assets/js/61.4e8f609c.js"><link rel="prefetch" href="/ccyblog/assets/js/62.4fe15d75.js"><link rel="prefetch" href="/ccyblog/assets/js/63.e9ac2545.js"><link rel="prefetch" href="/ccyblog/assets/js/64.083e8d2c.js"><link rel="prefetch" href="/ccyblog/assets/js/65.b6e595bc.js"><link rel="prefetch" href="/ccyblog/assets/js/66.26689277.js"><link rel="prefetch" href="/ccyblog/assets/js/67.60ccd17c.js"><link rel="prefetch" href="/ccyblog/assets/js/68.42b6df4a.js"><link rel="prefetch" href="/ccyblog/assets/js/69.1d5ac1c5.js"><link rel="prefetch" href="/ccyblog/assets/js/7.58212ba9.js"><link rel="prefetch" href="/ccyblog/assets/js/70.6b794575.js"><link rel="prefetch" href="/ccyblog/assets/js/71.09fac264.js"><link rel="prefetch" href="/ccyblog/assets/js/72.ee6a2190.js"><link rel="prefetch" href="/ccyblog/assets/js/73.da9be3f4.js"><link rel="prefetch" href="/ccyblog/assets/js/74.d901de2d.js"><link rel="prefetch" href="/ccyblog/assets/js/76.26405b7a.js"><link rel="prefetch" href="/ccyblog/assets/js/77.abe05554.js"><link rel="prefetch" href="/ccyblog/assets/js/78.6fd39cf3.js"><link rel="prefetch" href="/ccyblog/assets/js/79.5a5a23fb.js"><link rel="prefetch" href="/ccyblog/assets/js/80.5de6685c.js"><link rel="prefetch" href="/ccyblog/assets/js/81.452915be.js"><link rel="prefetch" href="/ccyblog/assets/js/82.04c6cc59.js"><link rel="prefetch" href="/ccyblog/assets/js/83.8288a3e4.js"><link rel="prefetch" href="/ccyblog/assets/js/84.e49e3728.js"><link rel="prefetch" href="/ccyblog/assets/js/85.8ad8ef5d.js"><link rel="prefetch" href="/ccyblog/assets/js/86.1d4c8e78.js"><link rel="prefetch" href="/ccyblog/assets/js/87.fc6b54da.js"><link rel="prefetch" href="/ccyblog/assets/js/88.1e7cf8b0.js"><link rel="prefetch" href="/ccyblog/assets/js/9.a8e5976d.js">
    <link rel="stylesheet" href="/ccyblog/assets/css/0.styles.79d32354.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>ccy's blogs</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>个人技术博客</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>月夕花辰</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ccyblog/" class="home-link router-link-active"><img src="/ccyblog/avatar.png" alt="ccy's blogs" class="logo"> <span class="site-name">ccy's blogs</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ccyblog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ccyblog/categories/配置/" class="nav-link"><i class="undefined"></i>
  配置
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/手写题/" class="nav-link"><i class="undefined"></i>
  手写题
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/直播/" class="nav-link"><i class="undefined"></i>
  直播
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/网络/" class="nav-link"><i class="undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/CSS/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/优化/" class="nav-link"><i class="undefined"></i>
  优化
</a></li></ul></div></div><div class="nav-item"><a href="/ccyblog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/ccyblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/FrancisSaber" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="./public/avatar.png"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/ccyblog/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    月夕花辰
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>72</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>19</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/ccyblog/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ccyblog/categories/配置/" class="nav-link"><i class="undefined"></i>
  配置
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/手写题/" class="nav-link"><i class="undefined"></i>
  手写题
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/直播/" class="nav-link"><i class="undefined"></i>
  直播
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/笔记/" class="nav-link"><i class="undefined"></i>
  笔记
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/网络/" class="nav-link"><i class="undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/面试/" class="nav-link"><i class="undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/Webpack/" class="nav-link"><i class="undefined"></i>
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/CSS/" class="nav-link"><i class="undefined"></i>
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/ccyblog/categories/优化/" class="nav-link"><i class="undefined"></i>
  优化
</a></li></ul></div></div><div class="nav-item"><a href="/ccyblog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/ccyblog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/FrancisSaber" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="./public/avatar.png"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>面试</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ccyblog/blogs/mian-shi/httpqing-qiu.html" class="sidebar-link">http请求</a></li><li><a href="/ccyblog/blogs/mian-shi/javascriptbian-yi-zhi-xing.html" class="sidebar-link">JavaScript代码的执行</a></li><li><a href="/ccyblog/blogs/mian-shi/vite.html" class="sidebar-link">Vite</a></li><li><a href="/ccyblog/blogs/mian-shi/vuexiang-ying-shi.html" class="sidebar-link">过程</a></li><li><a href="/ccyblog/blogs/mian-shi/vuezheng-li.html" class="sidebar-link">Vue整理</a></li><li><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html" aria-current="page" class="active sidebar-link">Webpack</a></li><li><a href="/ccyblog/blogs/mian-shi/webpack.html" class="sidebar-link">流程</a></li><li><a href="/ccyblog/blogs/mian-shi/csszheng-li.html" class="sidebar-link">CSS整理</a></li><li><a href="/ccyblog/blogs/mian-shi/dan-dian-deng-lu.html" class="sidebar-link">单点登录</a></li><li><a href="/ccyblog/blogs/mian-shi/chang-jian-jsti-mu.html" class="sidebar-link">作用域和this指向</a></li><li><a href="/ccyblog/blogs/mian-shi/pai-xu-suan-fa-ji-shi-jian-fu-za-du.html" class="sidebar-link">希尔排序</a></li><li><a href="/ccyblog/blogs/mian-shi/liu-lan-qi-xuan-ran-ji-zhi.html" class="sidebar-link">HTML解析</a></li><li><a href="/ccyblog/blogs/mian-shi/xuan-ran-ceng-he-bing.html" class="sidebar-link">渲染层合并</a></li><li><a href="/ccyblog/blogs/mian-shi/ji-suan-ji-wang-luo.html" class="sidebar-link">计算机网络</a></li><li><a href="/ccyblog/blogs/mian-shi/she-ji-mo-shi.html" class="sidebar-link">装饰器模式</a></li><li><a href="/ccyblog/blogs/mian-shi/mian-shi-ti-bi-ji.html" class="sidebar-link">面试题目</a></li><li><a href="/ccyblog/blogs/mian-shi/ye-mian-you-hua.html" class="sidebar-link">页面优化</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>Webpack</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>月夕花辰</span>
            
          <span data-v-4e82dffc>2021 - </span>
          2022
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">Webpack</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>月夕花辰</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2022/2/24</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>Webpack</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <p><font color="orange">		Webpack是一个开源的JavaScript模块打包工具，其最核心的功能是解决模块之间的依赖，把各个模块按照特定的规则和顺序组织在一起，最终合并为一个JS文件</font>(有时会有多个，这里讨论的只是最基本的情况)。这个过程就叫作模块打包。</p> <h2 id="核心流程"><a href="#核心流程" class="header-anchor">#</a> 核心流程</h2> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202201232224153.png" alt="image-20220123222401479" style="zoom:67%;"> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202241200186.webp" alt="img" style="zoom:67%;"> <h2 id="具体流程"><a href="#具体流程" class="header-anchor">#</a> 具体流程</h2> <p>​		webpack的运行是一个串行的过程：首先会从<code>webpack.config.js</code>和<code>shell</code>中读取合并参数，并初始化需要使用的插件和配置插件所需要等执行环境所需要的参数；初始化后会调用<code>Compiler</code>的run来真正启动<code>webpack</code>的编译构建过程。<code>webpack</code>的构建流程包括compile、make、build、seal、emit阶段</p> <h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <p>​		收集配置文件和shell的参数进行合并，根据参数示例化<code>compiler</code>对象，注入内置插件，配置插件环境。执行<code>compiler.run</code>开始编译，根据配置文件的<code>enrty</code>找出所有入口文件，调用<code>compilation.addEntrty</code>方法，将入口文件转为dependence(依赖)对象。</p> <p>​		根据<code>entry</code>对应的依赖对象调用<code>hanleModuleCreate</code>创建模块(module)对象，调用loader-runner仓库将各类资源转为标准JavaScript内容，通过<code>acorn</code>将内容转为抽象语法树，遍历语法树，监听导入语句，将模块（module）依赖对象加入到依赖列表，抽象语法树遍历完成后，调用handleParseResult处理模块依赖。不断调用<code>hanleModuleCreate</code>递归以上步骤直到没有新的模块依赖。（这个过程还会构建依赖关系图）。</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203242325494.png" alt="图片" style="zoom:50%;"> <p>​</p> <h3 id="run实例化"><a href="#run实例化" class="header-anchor">#</a> <font color="orange">run实例化</font></h3> <p>​		<font color="orange">根据上一步合并的参数实例化<code>Compiler</code>对象，注册所有插件和配置插件所需执行环境的参数，监听webpack构建生命周期的事件节点，执行实例对象的run方法开始编译。</font></p> <h3 id="编译构建"><a href="#编译构建" class="header-anchor">#</a> 编译构建</h3> <p><font color="orange"><strong>entry确认入口</strong></font></p> <p>​		根据配置文件的<code>entry</code>获取依赖入口文件</p> <p><font color="orange"><strong>make编译模块</strong></font></p> <p>​		<font color="orange">从入口文件出发，对模块路径进行解析，根据文件类型调用所匹配的loader对模块进行翻译，再找出该模块依赖的模块，递归执行直到处理完所有文件。</font>（同时构建<code>ModuleDependencyGraph</code>来确定不会重复处理）模块依赖关系图</p> <p><font color="orange"><strong>build module  完成模块编译</strong></font></p> <p>​		每个模块翻译处理完后，可以得到每个模块翻译后的最终内容和它们的依赖关系。</p> <p><font color="orange"><strong>seal 输出资源</strong></font></p> <p>​		根据模块间的依赖关系，将翻译处理后的模块组成一个个包含多个模块的（chunk）代码块，再把每个chunk转换成单独的文件加入到输出列表，这是能够修改输出内容的最后机会。</p> <p><strong><font color="orange">emit 输出完成</font></strong></p> <p>​		在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统</p> <h1 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h1> <h2 id="作用"><a href="#作用" class="header-anchor">#</a> 作用</h2> <p>​		<code>Loader</code> 本质就是一个函数，在该函数中对接收到的内容进行转换，返回转换后的结果。 因为 Webpack 只认识 JavaScript，所以 Loader 就成了翻译官，对其他类型的资源进行转译的预处理工作。<code>Loader</code> 在 module.rules 中配置，作为模块的解析规则，类型为数组。每一项都是一个 <code>Object</code>，内部包含了 <code>test</code>(类型文件)、loader、options (参数)等属性。</p> <p>​		<code>enforce</code>可以控制<code>loader</code>的执行顺序：pre、normal、inline、post</p> <h3 id="loader链式调用"><a href="#loader链式调用" class="header-anchor">#</a> <code>loader</code>链式调用</h3> <p>前一个<code>loader</code>的输出作为下一个<code>loader</code>的输入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
   <span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>			<span class="token comment">//配置loader别名</span>
        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./loaders&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token string-property property">&quot;per-loader&quot;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./loaders/per-loader.js&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;less-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><code>less-loader</code>：实现 less =&gt; css 的转换，输出 css 内容，无法被直接应用在 Webpack 体系下</li> <li><code>css-loader</code>：将 css 内容包装成类似 <code>module.exports = &quot;${css}&quot;</code> 的内容，包装后的内容符合 JavaScript 语法</li> <li><code>style-loader</code>：做的事情非常简单，就是将 css 模块包进 require 语句，并在运行时调用 injectStyle 等函数将内容注入到页面的 style 标签</li></ul> <h2 id="哪些常用loader及其作用"><a href="#哪些常用loader及其作用" class="header-anchor">#</a> 哪些常用loader及其作用</h2> <p>style-loader、less-loader、css-loader、vue-loader、file-loader、eslint-loader、babel-loader、ts-loader、cache-loader</p> <h3 id="babel-loader"><a href="#babel-loader" class="header-anchor">#</a> babel-loader</h3> <p>​		webpack不支持自动<code>ployfll</code>,可以通过<code>babel-loader</code>实现</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">rules</span><span class="token operator">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token string">'/\.js?$/'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token string">'pre'</span> 			
        <span class="token literal-property property">options</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span><span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">false</span>		<span class="token comment">//关闭模块化转译</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="file-loader"><a href="#file-loader" class="header-anchor">#</a> file-loader</h3> <p>把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件 (处理图片和字体)</p> <h3 id="url-loader"><a href="#url-loader" class="header-anchor">#</a> url-loader</h3> <p>​		可以将项目的图片转为base64编码并载入浏览器，可以减少<code>http</code>请求。但会增加<code>html</code>文件的体积，且如果图片的复用度高，由于base64无法缓存。每张图片都会生成base64编码，造成冗余，而<code>http</code>请求的图片是可以缓存的，因此要平衡考虑。</p> <p>​		不能对项目的所有图片都转成base64编码，因为图片越大，生成的字符串就会越长，因此需要设置limit，当超过limit图片就交由<code>file-loader</code>处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(gif|jpg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>			   <span class="token comment">//需要处理的图片内容</span>
    <span class="token comment">// 当小于limit时，会将图片编译成base64格式字符串</span>
    <span class="token comment">//当大于limit时，需要使用file-loader模块进行加载</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'url-loader?limit=30000'</span><span class="token punctuation">,</span>	
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'[name].[ext]?[hash]'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="cache-loader"><a href="#cache-loader" class="header-anchor">#</a> cache-loader</h3> <p>​		如果项目需要经常二次打包的，可以使用此loader。</p> <p>​		在一些性能开销较大的loader之前调用，可以将结果存储到磁盘里面，提高二次打包速度。但保存和读取缓存文件有一定的时间开销，所以只在开销大的loader调用</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>module.exports = {
  module: {
    rules: [
      {
        test: /\.ext$/,
        use: ['cache-loader', 'style-loader','css-loader'],
        include: path.resolve('src'),
      },
    ],
  },
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="怎么写"><a href="#怎么写" class="header-anchor">#</a> 怎么写</h2> <p>​		<code>loader</code>通常是一个函数</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*	
	loader接收三个参数
		1.source：资源输入，对于第一个loader为资源文件内容，后续执行的loader为前一个loader的结果
		2.sourceMap: 可选参数，代码的源文件映射
		3.data：可选参数，其他需要在loader链中传递的信息，如
*/</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> sourceMap<span class="token operator">?</span><span class="token punctuation">,</span> data<span class="token operator">?</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="返回结果"><a href="#返回结果" class="header-anchor">#</a> 返回结果</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> sourceMap<span class="token operator">?</span><span class="token punctuation">,</span> data<span class="token operator">?</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//1.通过return 返回结果</span>
    <span class="token comment">//2.通过callback返回更多信息</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//callback完整签名</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    <span class="token comment">// 异常信息，Loader 正常运行时传递 null 值即可</span>
    <span class="token literal-property property">err</span><span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">// 转译结果</span>
    <span class="token literal-property property">content</span><span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
    <span class="token comment">// 源码的 sourcemap 信息</span>
    sourceMap<span class="token operator">?</span><span class="token operator">:</span> SourceMap<span class="token punctuation">,</span>
    <span class="token comment">// 任意需要在 Loader 间传递的值</span>
    <span class="token comment">// 经常用来传递 ast 对象，避免重复解析</span>
    data<span class="token operator">?</span><span class="token operator">:</span> any
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="loader缓存"><a href="#loader缓存" class="header-anchor">#</a> loader缓存</h3> <p>webpack默认会缓存所有的<code>loader</code>,可以如下方式关闭
<code>this.cacheable(false)</code></p> <h3 id="less-loader"><a href="#less-loader" class="header-anchor">#</a> less-loader</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> less <span class="token keyword">from</span> <span class="token string">'less'</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">lessLoader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>implementation <span class="token operator">||</span> less<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> lessOptins<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...捕获错误</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在 less-loader 中，逻辑分三步：</p> <ul><li><font color="orange">调用 <code>this.async</code> 获取异步回调函数，此时 Webpack 会将该 Loader 标记为异步加载器，会挂起当前执行队列直到 <code>callback</code> 被触发</font></li> <li>调用 <code>less</code> 库将 less 资源转译为标准 css</li> <li>调用异步回调 <code>callback</code> 返回处理结果</li></ul> <h3 id="pitch"><a href="#pitch" class="header-anchor">#</a> pitch</h3> <p>Webpack 允许在这个函数上挂载名为 <code>pitch</code> 的函数，运行时 pitch 会比 Loader 本身更早执行，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">loader</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'后执行'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

loader<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">requestString</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'先执行'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">pitch</span><span class="token punctuation">(</span>
    <span class="token literal-property property">remainingRequest</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">previousRequest</span><span class="token operator">:</span> string<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>包含三个参数：</p> <ul><li><code>remainingRequest</code> : 当前 loader 之后的资源请求字符串</li> <li><code>previousRequest</code> : 在执行当前 loader 之前经历过的 loader 列表</li> <li><code>data</code> : 与 Loader 函数的 <code>data</code> 相同，用于传递需要在 Loader 传播的信息</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// css-loader 之后的 loader 列表及资源路径</span>
remainingRequest <span class="token operator">=</span> less<span class="token operator">-</span>loader<span class="token operator">!</span><span class="token punctuation">.</span><span class="token operator">/</span>xxx<span class="token punctuation">.</span>less
<span class="token comment">// css-loader 之前的 loader 列表</span>
previousRequest <span class="token operator">=</span> style<span class="token operator">-</span>loader
<span class="token comment">// 默认值</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><font color="orange">Loader 链条执行过程分三个阶段：<code>pitch</code>、解析资源、执行</font></p> <p>如果<code>pitch</code>有返回值，就不会走之后的loader，可以起到熔断的作用，如style-loader的pitch有返回值，就无需执行css-loader</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202202242310593.png" alt="图片" style="zoom:67%;"> <h3 id="处理二进制数据"><a href="#处理二进制数据" class="header-anchor">#</a> 处理二进制数据</h3> <p>想file-loader，处理的是二进制数据，需要如下设置通知webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> sourceMap<span class="token operator">?</span><span class="token punctuation">,</span> data<span class="token operator">?</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token keyword">instanceof</span> <span class="token class-name">Buffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 一系列操作</span>
        <span class="token keyword">return</span> source<span class="token punctuation">;</span> <span class="token comment">//当然我本身也可以返回二进制数据提供给下一个loader</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
moudle<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>自定义loader例子二</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//使用nodeSass依赖，读取scss文件</span>
<span class="token keyword">const</span> nodeSass <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;node-sass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> result <span class="token operator">=</span> nodeSass<span class="token punctuation">.</span><span class="token function">renderSync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../src/scss/index.scss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outputStyle</span><span class="token operator">:</span> <span class="token string">'expanded'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span>css<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="开发工具"><a href="#开发工具" class="header-anchor">#</a> 开发工具</h3> <p><font color="orange">在 Loader 内部，需要使用 <code>loader-utils</code> 库的 <code>getOptions</code> 函数获取用户配置，用 <code>schema-utils</code> 库的 <code>validate</code> 函数校验参数合法性，例如 css-loader：</font></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// css-loader/src/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> validate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;schema-utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> schema <span class="token keyword">from</span> <span class="token string">&quot;./options.json&quot;</span><span class="token punctuation">;</span>


<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> map<span class="token punctuation">,</span> meta</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rawOptions <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">validate</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> rawOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;CSS Loader&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">baseDataPath</span><span class="token operator">:</span> <span class="token string">&quot;options&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h1 id="plugin插件"><a href="#plugin插件" class="header-anchor">#</a> Plugin插件</h1> <h2 id="作用-2"><a href="#作用-2" class="header-anchor">#</a> 作用</h2> <p>​		<code>Plugin</code> 就是插件，基于事件流框架 <code>Tapable</code>，插件可以扩展 Webpack 的功能，在 Webpack 运行的生命周期中会广播出许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。<code>Plugin</code> 在 plugins 中单独配置，类型为数组，每一项是一个 Plugin 的实例，参数都通过构造函数传入。</p> <h2 id="哪些常用插件"><a href="#哪些常用插件" class="header-anchor">#</a> 哪些常用插件</h2> <h3 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="header-anchor">#</a> html-webpack-plugin</h3> <p>可在打包后生成html文件，通过<code>script</code>标签引入bundle文件</p> <h3 id="terser-webpack-plugin"><a href="#terser-webpack-plugin" class="header-anchor">#</a> terser-webpack-plugin</h3> <p>压缩JavaScript代码，支持ES6，可删除deadcode</p> <h3 id="webpack-bundle-analyzer"><a href="#webpack-bundle-analyzer" class="header-anchor">#</a> webpack-bundle-analyzer</h3> <p>可视化输出文件体积 (业务组件、依赖第三方模块)</p> <h3 id="speed-measure-webpack-plugin-提高效率"><a href="#speed-measure-webpack-plugin-提高效率" class="header-anchor">#</a> speed-measure-webpack-plugin        -提高效率</h3> <p>简称 SMP，分析出 Webpack 打包过程中 Loader 和 Plugin 的耗时，有助于找到构建过程中的性能瓶颈。</p> <h2 id="怎么写-2"><a href="#怎么写-2" class="header-anchor">#</a> 怎么写</h2> <p>​		<font color="orange">webpack的本质是一个事件流机制，内部使用了一个<code>tapable</code>的可用于发布订阅执行的插件架构，webpack在合并参数实例化一个<code>compiler</code>对象，这个对象配置好了所有可操作的设置，包括options、loader、和<code>plugin</code>。插件就是通过对这个实例化对象的引用，来监听webpack生命周期的广播的一些事件，通过事件钩子对打包的结果进行干涉。</font></p> <h3 id="如何监听对应生命周期事件广播"><a href="#如何监听对应生命周期事件广播" class="header-anchor">#</a> 如何监听对应生命周期事件广播</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	如何触发监听
	可以通过compiler实例对象上的hook来触发不同的钩子 如
        compiler.hook.entryOptions:	在webpack的entry配置处理过后触发
        compiler.hook.afterPlugins:	在初始化插件后触发
        compiler.hook.compilation: 在编译创建之后触发
        compiler.hook.emit:	在生成资源到指定目录前乘除法
        compiler.hook.done: 编译完成触发
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="选择好对应生命周期如何触发"><a href="#选择好对应生命周期如何触发" class="header-anchor">#</a> 选择好对应生命周期如何触发</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	1.同步触发
	compiler.hook.compilationn.tap(eventName, handler);	
	2.异步触发
	compiler.hook.compilation.tapAsync()
	3.异步触发返回promise
	compiler.hook.compilation.tapPromise()
	
	钩子函数的第一次参数是事件名，第二个是回调函数
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="具体实现"><a href="#具体实现" class="header-anchor">#</a> 具体实现</h3> <ul><li><p>每个插件的本质是一个类，也是可以在实例化时接收配置参数</p></li> <li><p><code>compilation</code>继承于<code>compiler</code>，包含<code>compiler</code>的所有内容，也是有<code>plugin</code>函数接入点任务</p></li> <li><p>compiler暴露了和webpack整个生命周期向的钩子，compilation暴露了与模块和依赖有关的粒度更小的钩子</p></li> <li><p>不同插件的<code>compilation</code>都是对同一个对象的引用，对其进行修改会影响后续操作</p></li> <li><p>插件函数需要在其原型上绑定apply方法才能访问到<code>compiler</code>实例，根据官方可以如下实现绑定</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//1.</span>
funciton <span class="token function">Plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Plugin</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hook<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//2.</span>
<span class="token keyword">class</span> <span class="token class-name">MyPlugin</span> <span class="token punctuation">{</span>
    <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        compiler<span class="token punctuation">.</span>hook<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>	
        <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> args<span class="token punctuation">;</span>		<span class="token comment">//constructor接收插件传入参数挂载到options上</span>
    <span class="token punctuation">}</span>
	<span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		compiler<span class="token punctuation">.</span>hook<span class="token punctuation">.</span><span class="token punctuation">[</span>hookEvent<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;My plugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//通过plugin函数接入点任务进行处理</span>
            compilation<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin-before-html-processing&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">htmlPluginData<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
               	<span class="token comment">//接收回调函数内容htmlPluginData处理</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">//钩子所触发回调函数</span>
            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
	此插件是对输出的html进行处理，html文件本身是通过html-webpack-plugin插件进行生成的，这个插件也提供了一些事件，compilation也提供了plugin方法让其他插件可以监听到插件事件进行拦截处理
*/</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span>
<span class="token comment">//使用</span>
<span class="token keyword">var</span> MyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'MyPlugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...其他配置</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span><span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">fileName</span><span class="token operator">:</span><span class="token string">'plugin-test'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">MyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token class-name">MyPlugin</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>pluginCwebpackEventHook
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//功能完成调用webpack提供的回调函数通知webpack进入下一流程</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>https://blog.csdn.net/qq_36380426/article/details/104471422</p> <h1 id="loader和plugin的区别"><a href="#loader和plugin的区别" class="header-anchor">#</a> loader和plugin的区别</h1> <p>​		<code>Loader</code> 本质就是一个函数，在该函数中对接收到的内容进行转换，返回转换后的结果。 因为 Webpack 只认识 JavaScript，所以 Loader 就成了翻译官，对其他类型的资源进行转译的预处理工作。</p> <p><code>Plugin</code> 就是插件，基于事件流框架 <code>Tapable</code>，插件可以扩展 Webpack 的功能，在 Webpack 运行的生命周期中会广播出许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。</p> <h1 id="文件指纹"><a href="#文件指纹" class="header-anchor">#</a> 文件指纹</h1> <p>​		文件指纹是指打包输出的文件名后缀</p> <ul><li>hash</li> <li>ChunkHash</li> <li>ContentHash</li></ul> <h1 id="webpack的模块"><a href="#webpack的模块" class="header-anchor">#</a> webpack的模块</h1> <p>​		webpack同时支持CommonJS和ES6 Module的模块导入导出方式。</p> <h1 id="webpack构建流程"><a href="#webpack构建流程" class="header-anchor">#</a> webpack构建流程</h1> <ul><li></li></ul> <h1 id="文件监听原理"><a href="#文件监听原理" class="header-anchor">#</a> 文件监听原理</h1> <p>​		<font color="orange">文件监听就是webpack发现源码发生变化时，自动重新构建输出新文件。通过webpack启动命令带上 --watch参数或者在<code>webpack.config.js</code>中设置<code>watch：true</code>。但是需要手动刷新浏览器才能看到效果。可配合WDS实现热模块更新。</font></p> <p>​		原理：轮询判断文件的最后编辑时间是否变化，如果某个文件发生了变化，并不会立刻告诉监听者，而是先缓存起来，等 <code>aggregateTimeout</code> 后再执行。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>    
    <span class="token comment">// 默认false,也就是不开启    </span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    
    <span class="token comment">// 只有开启监听模式时，watchOptions才有意义    </span>
    <span class="token literal-property property">watchOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>        
        <span class="token comment">// 默认为空，不监听的文件或者文件夹，支持正则匹配        </span>
        <span class="token literal-property property">ignored</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>        
        <span class="token comment">// 监听到变化发生后会等300ms再去执行，默认300ms        </span>
        <span class="token literal-property property">aggregateTimeout</span><span class="token operator">:</span><span class="token number">300</span><span class="token punctuation">,</span>        
        <span class="token comment">// 判断文件是否发生变化是通过不停询问系统指定文件有没有变化实现的，默认每秒问1000次        </span>
        <span class="token literal-property property">poll</span><span class="token operator">:</span><span class="token number">1000</span>    
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h1 id="热模块更新"><a href="#热模块更新" class="header-anchor">#</a> 热模块更新</h1> <p>​		webpack的HMR可以实现不用刷新浏览器就能够在浏览器看到模块替换的效果。</p> <h2 id="实现原理"><a href="#实现原理" class="header-anchor">#</a> 实现原理</h2> <ol><li><p><strong>注入HMR客户端运行时</strong>：执行启动命令时，WDS会通过HMR插件向主要代码块注入一些运用于客户端的运行时，包括建立Websocket、加载热更新资源的接口、module.hot.accept接口</p></li> <li><p><strong>增量构建</strong>：HMR插件会借用Webpack的文件监听能力，当代码文件变更时，Webpack会增量构建一个JSON格式的文件<code>[hash].hot-update.json</code>,包含所有发生变更的模块列表。并触发complation.hook.done钩子函数,传递本次构建的统计信息对象 <code>stats</code>。WDS 则监听 <code>done</code> 钩子，在回调中通过 WebSocket 发送模块更新消息。</p></li> <li><p><strong>加载更新</strong>：客户端根据hash值请求文件模块更新清单的JSON文件，根据文件清单再去下载相应文件；当客户端下载完更新文件后，调用<code>module.hot.accept</code>接口，拦截对应的更新模块，将最新代码运用于当前环境，如果某个模块没有注册对应环境，浏览器通常会刷新浏览器获取最新代码。</p></li></ol> <h1 id="优化打包速度"><a href="#优化打包速度" class="header-anchor">#</a> 优化打包速度</h1> <h2 id="影响打包速度的因素"><a href="#影响打包速度的因素" class="header-anchor">#</a> 影响打包速度的因素</h2> <p>​		<font color="orange">webpack的核心流程是从<code>entry</code>入口文件开始，收集依赖，解析依赖，资源打包。可从后面三个步骤进行优化。</font></p> <h2 id="收集优化"><a href="#收集优化" class="header-anchor">#</a> 收集优化</h2> <p>​		webpack 打包时，会从配置的 <code>entry</code> 触发，解析入口文件的导入语句，再递归的解析，在遇到导入语句时 webpack 会做两件事情：</p> <ul><li>根据导入语句去寻找对应的要导入的文件。例如 <code>require('react')</code> 导入语句对应的文件是 <code>./node_modules/react/react.js</code>，<code>require('./util')</code> 对应的文件是 <code>./util.js</code>。</li> <li>根据找到的要导入文件的后缀，使用配置中的 <code>Loader</code> 去处理文件。例如使用 ES6 开发的 JavaScript 文件需要使用 babel-loader 去处理。</li></ul> <h3 id="_1-优化loader配置"><a href="#_1-优化loader配置" class="header-anchor">#</a> 1.优化loader配置</h3> <p>​		使用 Loader 时可以通过 <code>test</code> 、 <code>include</code> 、 <code>exclude</code> 三个配置项来命中 Loader 要应用规则的文件</p> <h3 id="_4-优化-resolve-extensions-配置"><a href="#_4-优化-resolve-extensions-配置" class="header-anchor">#</a> 4. 优化 resolve.extensions 配置</h3> <p>​		在导入语句没带文件后缀时，webpack 会根据 resolve.extension 自动带上后缀后去尝试询问文件是否存在，所以在配置 <code>resolve.extensions</code>。把项目没用到可能会被询问的文件后缀去除。</p> <h3 id="_6-优化-module-noparse-配置"><a href="#_6-优化-module-noparse-配置" class="header-anchor">#</a> 6. 优化 module.noParse 配置</h3> <p>​		<code>module.noParse</code> 配置项可以让 Webpack 忽略对部分没采用模块化的文件的递归解析处理，这样做的好处是能提高构建性能。 原因是一些库，例如 jQuery 、ChartJS， 它们庞大又没有采用模块化标准，让 Webpack 去解析这些文件耗时又没有意义。</p> <h3 id="详细配置"><a href="#详细配置" class="header-anchor">#</a> 详细配置</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 编译代码的基础配置</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 项目中使用的 jquery 并没有采用模块化标准，webpack 忽略它</span>
    <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 这里编译 js、jsx</span>
        <span class="token comment">// 注意：如果项目源码中没有 jsx 文件就不要写 /\.jsx?$/，提升正则表达式性能</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(js|jsx)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// babel-loader 支持缓存转换出的结果，通过 cacheDirectory 选项开启</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader?cacheDirectory'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 排除 node_modules 目录下的文件</span>
        <span class="token comment">// node_modules 目录下的文件都是采用的 ES5 语法，没必要再通过 Babel 去转换</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 设置模块导入规则，import/require时会直接在这些目录找文件</span>
    <span class="token comment">// 可以指明存放第三方模块的绝对路径，以减少寻找</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>project<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/client/components</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'h5_commonr/components'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
      <span class="token string">'node_modules'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// import导入时省略后缀</span>
    <span class="token comment">// 注意：尽可能的减少后缀尝试的可能性</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">,</span> <span class="token string">'.react.js'</span><span class="token punctuation">,</span> <span class="token string">'.css'</span><span class="token punctuation">,</span> <span class="token string">'.json'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// import导入时别名，减少耗时的递归解析操作</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'@compontents'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>project<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/compontents</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="解析优化-将非js转为js"><a href="#解析优化-将非js转为js" class="header-anchor">#</a> 解析优化 - 将非js转为js</h2> <h3 id="thread-loader"><a href="#thread-loader" class="header-anchor">#</a> thread-loader</h3> <p>开启多进程解析，可在一些性能开销大的loader前放置thread-loader，将耗性能的loader在一个单独的工作池（nodeJS进程）运行。如babel-loader。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token comment">// 创建一个 js worker 池</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
          <span class="token string">'thread-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'babel-loader'</span>
        <span class="token punctuation">]</span> 
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="打包优化"><a href="#打包优化" class="header-anchor">#</a> 打包优化</h2> <p>​		当所有的资源解析成JavaScript代码后，就需要将代码进行压缩打包。压缩需要先将JavaScript代码转成抽象语法树，处理后还原成<code>js</code>代码。（压缩是为了对代码进行优化）</p> <p>​		运行在 Node.js 之上的 webpack 是单线程模式的，也就是说，webpack 打包只能逐个文件处理，当 webpack 需要打包大量文件时，打包时间就会比较漫长。</p> <h3 id="terser启动多进程压缩"><a href="#terser启动多进程压缩" class="header-anchor">#</a> terser启动多进程压缩</h3> <p>​		<code>Terser</code>是一个新起的代码压缩工具，支持<code>ES6+</code>语法，因此被很多构建工具内置使用。<code>webpack</code>安装后会内置<code>Terser</code>，当启用生产环境后即可用其进行代码压缩。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 是否要启用压缩，默认情况下，生产环境会自动开启</span>
    <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 压缩时使用的插件，可以有多个</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span>			<span class="token comment">//开启多进程并行压缩</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// 压缩js代码</span>
      <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 压缩css代码</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="gzip压缩文本"><a href="#gzip压缩文本" class="header-anchor">#</a> gzip压缩文本</h3> <ul><li><p>优点：传输效率可能得到大幅提升</p></li> <li><p>缺点：服务器的压缩需要时间，客户端的解压需要时间</p></li> <li><p>可以通过使用<code>compression-webpack-plugin</code>插件对打包结果进行预压缩，可以移除服务器的压缩时间</p></li> <li><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//webpack.config.js配置</span>
<span class="token keyword">const</span> CompressionPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'compression-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CmpressionWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>   <span class="token comment">//只针对匹配到的文件进行压缩</span>
      <span class="token literal-property property">minRatio</span><span class="token operator">:</span> <span class="token number">0.8</span> <span class="token comment">//压缩后是原来体积的0.8,才会进行压缩（只有压缩率比这个值小的资源才会被处理）</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ul> <h1 id="tree-shaking"><a href="#tree-shaking" class="header-anchor">#</a> tree-shaking</h1> <p>​		树摇，就是去除项目中没有使用的死代码，从而实现减小项目体积的作用。（Webpack 跟踪整个应用程序的 import/export 语句，因此，如果它看到导入的东西最终没有被使用，它会认为那是“死代码”，并会对其进行 tree-shaking 。）</p> <p>​		Tree-Shaking 是一种基于 ES <a href="https://so.csdn.net/so/search?q=Module&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 规范的 Dead Code Elimination 技术，它会在运<font color="orange">行过程中静态分析模块之间的导入导出，确定 ESM 模块中哪些导出值未曾其它模块使用，并将其删除，以此实现打包产物的优化。</font></p> <p>​		在 Webpack 中，启动 Tree Shaking 功能必须同时满足三个条件：</p> <blockquote><ul><li>使用 ESM 规范编写模块代码配置</li> <li>optimization.usedExports 为 true，启动标记功能，运用于Seal阶段</li> <li>启动代码优化功能，可以通过如下方式实现：
<ul><li>配置 mode = production配置</li> <li>optimization.minimize = true</li> <li>提供 optimization.minimizer 数组</li></ul></li></ul> <p>在生产模式下，webpack才会对代码进行压缩，这是才会启动树摇。启动标记功能。在引用依赖库时，不要一次导入整个库，而是导入一个库中我们需要的模块，否则树摇不会对这个库生效。树摇是基于ESM的静态分析过程，因此不适用CommonJS等模块化方式。</p> <p>支持删除死代码的压缩器。这种压缩器将识别出 Webpack 是如何标记它认为没有被使用的代码，并将其剥离。TerserPlugin 支持这个功能，推荐使用。</p></blockquote> <h2 id="基本配置"><a href="#基本配置" class="header-anchor">#</a> 基本配置</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 是否要启用压缩，默认情况下，生产环境会自动开启</span>
    <span class="token literal-property property">minimize</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 压缩时使用的插件，可以有多个</span>
      <span class="token keyword">new</span> <span class="token class-name">TerserPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// 压缩js代码,删除死代码，支持ES6语法</span>
      <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 压缩css代码</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="实现原理-2"><a href="#实现原理-2" class="header-anchor">#</a> 实现原理</h2> <ul><li>收集模块导出变量并记录到模块依赖关系图 ModuleGraph 变量中（ModuleGraph可以避免重复依赖收集）</li> <li>Seal 阶段，遍历 ModuleGraph 标记模块导出变量有没有被使用</li> <li>生成产物时，若变量没有被其它模块使用则删除对应的导出语句</li></ul> <h2 id="支持tree-shaking的手段"><a href="#支持tree-shaking的手段" class="header-anchor">#</a> 支持tree-shaking的手段</h2> <p>​		树摇不会因为</p> <ul><li><p>优化导出值粒度，不使用默认导出，而使用<code>exports</code>导出</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	即使实际上只用到 default 导出值的其中一个属性，整个 default 对象依然会被完整保留。所以实际开发中，应该尽量保持导出值颗粒度和原子性，上例代码的优化版本：
*/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">,</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>不导入整个库的，而是导入一个库的某个具体模块</p></li> <li><p>关闭<code>babel-loader</code>的转译功能，babel可以将高版本的JavaScript代码转为兼容性更强的代码，但babel默认会将ESM转为CommonJS的格式导致树摇失效。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// es2015 模块的基本 Babel 配置</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span>
            <span class="token string">'[@babel/preset-env](http://twitter.com/babel/preset-env)'</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
            	<span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>告诉webpack代码无副作用</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">/*
	webpack不会因为一个文件的代码没有使用就会删去，因为可能会误删一些配置文件如样式文件，因此webpack默认将所有代码视为有副作用，树摇将无效。通过package.json文件的sideEffects属性可以修改。这个属性可以是布尔类型会一个数组。
*/</span>
<span class="token comment">// 所有文件都有副作用，全都不可 tree-shaking</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token comment">// 没有文件有副作用，全都可以 tree-shaking</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
<span class="token comment">// 只有这些文件有副作用，所有其他文件都可以 tree-shaking，但会保留这些文件</span>
<span class="token punctuation">{</span>
 <span class="token string-property property">&quot;sideEffects&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;./src/file1.js&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;./src/file2.js&quot;</span>
 <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul> <p>https://blog.csdn.net/frontend_frank/article/details/120073004</p> <p>https://zhuanlan.zhihu.com/p/372721645</p> <p>https://mp.weixin.qq.com/s/SbJNbSVzSPSKBe2YStn2Zw</p> <h1 id="webpack的代码块分包"><a href="#webpack的代码块分包" class="header-anchor">#</a> Webpack的代码块分包</h1> <p>在Webpack中，chunk是输出产物的基组织单位</p> <p><strong>在构建阶段</strong>，webpack会在处理模块的过程中逐渐构建出模块依赖关系图，根据关系图相互引用的先后顺序推断哪些模块应该先执行，哪些可以打包在一起，哪些可以异步加载；</p> <p><strong>到了生成(seal) 阶段</strong>，webpack 会根据模块依赖图的内容组织分包 —— Chunk 对象，默认的分包规则有：</p> <ul><li>同一个 <code>entry</code> 下触达到的模块组织成一个 chunk</li> <li>异步模块单独组织为一个 chunk</li> <li><code>entry.runtime</code> 单独组织成一个 chunk</li></ul> <p>在生成阶段，Webpack 首先根据遍历用户提供的 entry 属性值，为每一个 entry 创建 Chunk 对象，通过模块依赖关系，将 entry 所对应的内容塞入对应的 chunk，在分析模块依赖关系图时，遇到异步引入语句时（<code>import、require.ensure</code>）会为该模块单独生成一个 <code>chunk</code> 对象，并将其子模块都加入这个 chunk 中。<img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203111137735.png" alt="图片" style="zoom:67%;"></p> <p>根据entry产出的chunk相互独立，但是同一个entry的同步异步模块是存在依赖关系的；运行时，webpack 在 index.js 中使用 promise 及 <code>__webpack_require__.e</code> 方法异步载入并运行异步文件从而实现动态加载。</p> <p><strong>基于异步模块的 chunk 在 webpack 官方文档中，通常称之为</strong> <strong>「Async chunk」</strong></p> <p>Webpack 编译产物中还需要包含一些用于支持 webpack 模块化、异步加载等特性的支撑性代码，这类代码在 webpack 中被统称为 <code>runtime</code>。对于多入口应用，webpack提供了entry.runtime配置项用于声明如何打包运行时代码，实现运行时代码共享。例如两个entry配置，最终生成3个chunk，一个runtimechunk、两个enrtychunk，entrychunk（包含同步和异步chunk）</p> <img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203111152127.png" alt="图片" style="zoom:50%;"> <h2 id="分包规则"><a href="#分包规则" class="header-anchor">#</a> 分包规则</h2> <p>默认分包规则无法解决依赖重复的问题，webpack3通过基于简单关系链的commonchunkplugin提取公共模块，但效果不好；webpack4使用了chunkgroup实现专门的关系链管理</p> <h2 id="runtime"><a href="#runtime" class="header-anchor">#</a> runtime</h2> <p>webpack不仅要打包模块文件，还要将如何调用这些代码的运行时一起打包（比如实现异步加载模块、HMR）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// a.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'a module'</span><span class="token punctuation">;</span>

<span class="token comment">// index.js</span>
<span class="token keyword">import</span> name <span class="token keyword">from</span> <span class="token string">'./a'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203111201857.png" alt="image-20220311120103769" style="zoom:80%;"> <p>落到 Webpack 源码实现上，运行时的生成逻辑可以划分为两个步骤：</p> <ol><li><strong>「依赖收集」</strong>：遍历业务代码模块收集模块的特性依赖，从而确定整个项目对 Webpack runtime 的依赖列表</li> <li><strong>「生成」</strong>：合并 runtime 的依赖列表，打包到最终输出的 bundle</li></ol> <p>两个步骤都发生在打包阶段，即 Webpack(v5) 源码的 <code>compilation.seal</code> 函数中</p> <ul><li>第一次循环遍历所有 <code>module</code>，收集所有 <code>module</code> 的 runtime 依赖</li> <li>第二次循环遍历所有 <code>chunk</code>，将 <code>chunk</code> 下所有 <code>module</code> 的 runtime 统一收录到 <code>chunk</code> 中</li> <li>第三次循环遍历所有 runtime chunk，收集其对应的子 <code>chunk</code> 下所有 runtime 依赖，之后遍历所有依赖并发布 <code>runtimeRequirementInTree</code> 钩子，(主要是) <code>RuntimePlugin</code> 插件订阅该钩子并根据依赖类型创建对应的 <code>RuntimeModule</code> 子类实例</li></ul> <p>Webpack 5 之后，如果 entry 配置中包含 runtime 值，则在 entry 之外再增加一个专门容纳 runtime 的 chunk 对象，此时可以称之为 runtime chunk</p> <p><img src="https://cdn.jsdelivr.net/gh/FrancisSaber/image/markdown-Image202203111207964.png" alt="图片"></p> <h1 id="webpack相比其他打包工具的优势"><a href="#webpack相比其他打包工具的优势" class="header-anchor">#</a> webpack相比其他打包工具的优势</h1> <ul><li><p><code>webpack</code>生态成熟、兼容性强</p></li> <li><p><code>vite</code>对开发环境友好、生产环境兼容性差</p></li> <li><p><code>rollup</code>更适合构建npm包，扩展性弱</p></li></ul> <h1 id="resolveloader"><a href="#resolveloader" class="header-anchor">#</a> resolveLoader</h1> <p>通过配置别名的方式使用loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token literal-property property">resolveLoader</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token string-property property">'a-loader'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'loaders/a.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
              <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
              <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token string">'a-loader'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h1 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h1> <ul><li>相对于 grant、gulp 等流式构建工具，为什么 webpack 会被认为是新一代的构建工具？
<font color="orange">Grant、Gulp 仅执行开发者预定义的任务流；而 webpack 则深入处理资源的内容，功能上更强大</font></li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/ccyblog/blogs/mian-shi/vuezheng-li.html" class="prev">
            Vue整理
          </a></span> <span class="next"><a href="/ccyblog/blogs/mian-shi/webpack.html">
            流程
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#核心流程" class="sidebar-link reco-side-核心流程" data-v-70334359>核心流程</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#具体流程" class="sidebar-link reco-side-具体流程" data-v-70334359>具体流程</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#初始化" class="sidebar-link reco-side-初始化" data-v-70334359>初始化</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#run实例化" class="sidebar-link reco-side-run实例化" data-v-70334359></a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#编译构建" class="sidebar-link reco-side-编译构建" data-v-70334359>编译构建</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#作用" class="sidebar-link reco-side-作用" data-v-70334359>作用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#loader链式调用" class="sidebar-link reco-side-loader链式调用" data-v-70334359>loader链式调用</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#哪些常用loader及其作用" class="sidebar-link reco-side-哪些常用loader及其作用" data-v-70334359>哪些常用loader及其作用</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#babel-loader" class="sidebar-link reco-side-babel-loader" data-v-70334359>babel-loader</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#file-loader" class="sidebar-link reco-side-file-loader" data-v-70334359>file-loader</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#url-loader" class="sidebar-link reco-side-url-loader" data-v-70334359>url-loader</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#cache-loader" class="sidebar-link reco-side-cache-loader" data-v-70334359>cache-loader</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#怎么写" class="sidebar-link reco-side-怎么写" data-v-70334359>怎么写</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#返回结果" class="sidebar-link reco-side-返回结果" data-v-70334359>返回结果</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#loader缓存" class="sidebar-link reco-side-loader缓存" data-v-70334359>loader缓存</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#less-loader" class="sidebar-link reco-side-less-loader" data-v-70334359>less-loader</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#pitch" class="sidebar-link reco-side-pitch" data-v-70334359>pitch</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#处理二进制数据" class="sidebar-link reco-side-处理二进制数据" data-v-70334359>处理二进制数据</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#开发工具" class="sidebar-link reco-side-开发工具" data-v-70334359>开发工具</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#作用-2" class="sidebar-link reco-side-作用-2" data-v-70334359>作用</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#哪些常用插件" class="sidebar-link reco-side-哪些常用插件" data-v-70334359>哪些常用插件</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#html-webpack-plugin" class="sidebar-link reco-side-html-webpack-plugin" data-v-70334359>html-webpack-plugin</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#terser-webpack-plugin" class="sidebar-link reco-side-terser-webpack-plugin" data-v-70334359>terser-webpack-plugin</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#webpack-bundle-analyzer" class="sidebar-link reco-side-webpack-bundle-analyzer" data-v-70334359>webpack-bundle-analyzer</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#speed-measure-webpack-plugin-提高效率" class="sidebar-link reco-side-speed-measure-webpack-plugin-提高效率" data-v-70334359>speed-measure-webpack-plugin        -提高效率</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#怎么写-2" class="sidebar-link reco-side-怎么写-2" data-v-70334359>怎么写</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#如何监听对应生命周期事件广播" class="sidebar-link reco-side-如何监听对应生命周期事件广播" data-v-70334359>如何监听对应生命周期事件广播</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#选择好对应生命周期如何触发" class="sidebar-link reco-side-选择好对应生命周期如何触发" data-v-70334359>选择好对应生命周期如何触发</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#具体实现" class="sidebar-link reco-side-具体实现" data-v-70334359>具体实现</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#实现原理" class="sidebar-link reco-side-实现原理" data-v-70334359>实现原理</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#影响打包速度的因素" class="sidebar-link reco-side-影响打包速度的因素" data-v-70334359>影响打包速度的因素</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#收集优化" class="sidebar-link reco-side-收集优化" data-v-70334359>收集优化</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#_1-优化loader配置" class="sidebar-link reco-side-_1-优化loader配置" data-v-70334359>1.优化loader配置</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#_4-优化-resolve-extensions-配置" class="sidebar-link reco-side-_4-优化-resolve-extensions-配置" data-v-70334359>4. 优化 resolve.extensions 配置</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#_6-优化-module-noparse-配置" class="sidebar-link reco-side-_6-优化-module-noparse-配置" data-v-70334359>6. 优化 module.noParse 配置</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#详细配置" class="sidebar-link reco-side-详细配置" data-v-70334359>详细配置</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#解析优化-将非js转为js" class="sidebar-link reco-side-解析优化-将非js转为js" data-v-70334359>解析优化 - 将非js转为js</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#thread-loader" class="sidebar-link reco-side-thread-loader" data-v-70334359>thread-loader</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#打包优化" class="sidebar-link reco-side-打包优化" data-v-70334359>打包优化</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#terser启动多进程压缩" class="sidebar-link reco-side-terser启动多进程压缩" data-v-70334359>terser启动多进程压缩</a></li><li class="level-3" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#gzip压缩文本" class="sidebar-link reco-side-gzip压缩文本" data-v-70334359>gzip压缩文本</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#基本配置" class="sidebar-link reco-side-基本配置" data-v-70334359>基本配置</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#实现原理-2" class="sidebar-link reco-side-实现原理-2" data-v-70334359>实现原理</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#支持tree-shaking的手段" class="sidebar-link reco-side-支持tree-shaking的手段" data-v-70334359>支持tree-shaking的手段</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#分包规则" class="sidebar-link reco-side-分包规则" data-v-70334359>分包规则</a></li><li class="level-2" data-v-70334359><a href="/ccyblog/blogs/mian-shi/wbepackliu-cheng.html#runtime" class="sidebar-link reco-side-runtime" data-v-70334359>runtime</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-6e863240><div class="banniang-container" style="display:;" data-v-6e863240><div class="messageBox" style="right:88px;bottom:270px;display:none;" data-v-6e863240></div> <div class="operation" style="right:15px;bottom:100px;" data-v-6e863240><i class="kbnfont kbn-ban-home ban-home" data-v-6e863240></i> <i class="kbnfont kbn-ban-message message" data-v-6e863240></i> <i class="kbnfont kbn-ban-info info" data-v-6e863240></i> <i class="kbnfont kbn-ban-close close" data-v-6e863240></i></div> <div id="L2dCanvas" class="Canvas" style="position: absolute; bottom: -50px;z-index:100000" data-v-6e863240></div></div> <div class="showBanNiang" style="display:none;" data-v-6e863240>看板娘</div></div><!----></div></div>
    <script src="/ccyblog/assets/js/app.61cc9ff9.js" defer></script><script src="/ccyblog/assets/js/3.897744a6.js" defer></script><script src="/ccyblog/assets/js/1.371d3697.js" defer></script><script src="/ccyblog/assets/js/75.a8f3a837.js" defer></script><script src="/ccyblog/assets/js/8.b19724a0.js" defer></script>
  </body>
</html>
